import{a as qe,q as ke,Q as xe,c as ut,e as J}from"./useStationQuery-ClAZEJp_.js";import{f as Se,g as me,u as ee,a5 as ht,d as pt,T as mt,s as te,m as Ve,r as ft,ad as vt,a8 as bt,ae as G}from"./layout-CUzOT8aY.js";import{_ as gt}from"./Loading-CQdAiB8R.js";import{J as _e,d as z,K as fe,q as Y,r as q,B as X,g as j,c as R,o as C,a as l,t as x,u,b as _,l as K,F as B,D as ve,w as ae,H as Fe,y as $e,i as Z,m as F,e as O,s as Ge,n as Qe,f as Q,h as yt,ag as _t,I as wt,z as Xe,af as Ct,A as $t,G as kt,j as xt,L as St,p as Dt}from"./vue-BsfewpWM.js";import{_ as Ye}from"./DataTable-BhAO7RbG.js";import{D as Et}from"./bootstrap.esm-30QIU_ZL.js";import{_ as H,ae as Mt,af as Pt,ac as Tt,ag as Rt,ah as be,ai as Lt,m as At,q as It,$ as Ot,aj as Wt}from"./icons-BAjd3tML.js";import{f as se}from"./forEach-BFcv9GyE.js";import{m as ie,f as Ft}from"./map-Caxea7Kw.js";import{A as Nt,B as zt,C as Ut,i as Bt}from"./estoolkit-DCzBkaPJ.js";import{i as Ke}from"./isArrayLike-DknTMkCU.js";import{_ as jt}from"./FlowUpload-BbQl79KV.js";import{u as De,r as Ee}from"./regle-hGsoY2W9.js";import{_ as U}from"./FormGroupField-K9S4Sadl.js";import{u as Me,_ as Pe}from"./useHasModal-Bq3QxExQ.js";import{I as Je}from"./InvisibleSubmitButton-NGv_v7G8.js";import{u as pe}from"./useResettableRef-BwkDrsai.js";import{u as Ht}from"./useQueryItemProvider-RNAxJE6j.js";import{u as Ze}from"./useFormTabClass-DgI07GN4.js";import{_ as ne,a as qt}from"./Tabs-DMTPhsiO.js";import{_ as Vt}from"./FormGroup-DXDHSoyc.js";import{_ as Gt}from"./FormFile-B5B3WV6y.js";import{_ as Qt}from"./FormMarkup-DqBjuQjX.js";import{_ as Xt}from"./FormGroupMultiCheck-z3kTFzdV.js";import{_ as Yt}from"./MuteButton-DdyYYuLG.js";import{_ as Kt}from"./ModalForm-D0z4l5nm.js";import{u as Jt}from"./useBaseEditModal-D4NDXa4y.js";import{m as Ne}from"./mergeExisting-B6FvxI3v.js";import{_ as Zt}from"./Quota-6Uls-2Ar.js";import{A as ze}from"./AlbumArt-CcCTgtsV.js";import{_ as es}from"./PlayButton-Dbj4ENWk.js";import{f as ts}from"./formatFileSize--9DaIXge.js";import{_ as ss}from"./InfoCard-D5Q671bF.js";import{b as is,u as ns}from"./vue-router-Cafqdr3I.js";import{u as os}from"./useStationDateTimeFormatter-CkmvkIuo.js";import{u as rs}from"./useApiItemProvider-DAIhDonu.js";import{i as as}from"./iteratee-DJRL6CbS.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./FormMultiCheck-RiRcopXY.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./defaultsDeep-B9v54JJt.js";import"./zxcvbn-Bgw4VUEj.js";import"./ValidationError-DsAp6Fjg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useClientItemProvider-Ds0yxtsG.js";import"./useSlotsExcept-Dp0PSXNw.js";import"./lightbox-B9nVyWr-.js";import"./luxon-m3VuE4xT.js";import"./luxon-F75Z0klY.js";function Ue(c){return Nt(c)&&Ke(c)}function ls(...c){if(c.length===0)return[];if(!Ue(c[0]))return[];let e=zt(Array.from(c[0]));for(let t=1;t<c.length;t++){const s=c[t];if(!Ue(s))return[];e=Ut(e,Array.from(s))}return e}function ds(c,e=Bt){if(!c)return[[],[]];const t=Ke(c)?c:Object.values(c);e=as(e);const s=[],i=[];for(let n=0;n<t.length;n++){const o=t[n];e(o)?s.push(o):i.push(o)}return[s,i]}function et(){const{notifySuccess:c,notifyError:e}=Se();return{handleBatchResponse:(s,i,n)=>{if(s.success){const o=[];se(s.dirs,r=>{o.push(_e("div",{},r))}),se(s.files,r=>{o.push(_e("div",{},r))}),c(o,{title:i})}else{const o=[];se(s.errors,r=>{o.push(_e("div",{},r))}),e(o,{title:n})}}}}const cs={id:"app-toolbar",class:"d-flex pt-4"},us={class:"flex-fill buttons d-flex align-items-center"},hs={class:"btn-group btn-group-sm dropdown allow-focus"},ps={class:"dropdown"},ms=["disabled"],fs={class:"dropdown-menu",style:{"min-width":"300px"}},vs={class:"custom-control custom-checkbox"},bs=["id","value"],gs=["for"],ys={class:"form-group mt-3 mb-4"},_s={class:"input-group custom-control custom-checkbox"},ws={class:"input-group-text"},Cs=["placeholder"],$s={class:"buttons"},ks={class:"btn btn-primary",type:"submit"},xs=["disabled"],Ss={class:"btn-group btn-group-sm dropdown allow-focus"},Ds={class:"dropdown"},Es=["disabled"],Ms={class:"dropdown-menu"},Ps=["title"],Ts=["title"],Rs=["title"],Ls=["title"],As=["disabled"],Is={class:"flex-shrink-0"},Os=z({__name:"MediaToolbar",props:{currentDirectory:{},selectedItems:{},playlists:{},batchUrl:{},supportsImmediateQueue:{type:Boolean}},emits:["relist","add-playlist","move-files","create-directory"],setup(c,{emit:e}){const t=c,s=e,i=fe(t,"selectedItems"),n=Y(()=>i.value.all.length>0),o=q([]),r=q("");X(i,D=>{const P=ie(D.all,L=>{const V=L.dir?.playlists??L.media?.playlists??[];return ie(Ft(V,ge=>ge.folder===null),"id")});o.value=ls(...P)}),X(r,D=>{D!==""&&(o.value.includes("new")||o.value.push("new"))});const{$gettext:a}=me(),{axios:d}=ee(),{handleBatchResponse:h}=et(),{notifyError:p}=Se(),g=()=>{p(a("No files selected."))},b=async(D,P,L)=>{if(n.value){const{data:V}=await d.put(t.batchUrl,{do:D,current_directory:t.currentDirectory,files:i.value.files,dirs:i.value.directories});h(V,P,L),s("relist")}else g()},k=()=>{b("immediate",a("Files played immediately:"),a("Error queueing files:"))},$=()=>{b("queue",a("Files queued for playback:"),a("Error queueing files:"))},w=()=>{b("reprocess",a("Files marked for reprocessing:"),a("Error reprocessing files:"))},f=()=>{b("clear-extra",a("Extra metadata cleared for files:"),a("Error reprocessing files:"))},{confirmDelete:v}=ht(),S=async()=>{const D=i.value.all.length,P=a("Delete %{num} media files?",{num:String(D)}),{value:L}=await v({title:P,confirmButtonText:a("Delete")});L&&await b("delete",a("Files removed:"),a("Error removing files:"))},m=j("$playlistDropdown"),y=async()=>{if(m.value&&Et.getInstance(m.value)?.hide(),n.value){const{data:D}=await d.put(t.batchUrl,{do:"playlist",playlists:o.value,new_playlist_name:r.value,currentDirectory:t.currentDirectory,files:i.value.files,dirs:i.value.directories});h(D,o.value.length>0?a("Playlists updated for selected files:"):a("Playlists cleared for selected files:"),a("Error updating playlists:")),D.success&&(D.record&&s("add-playlist",D.record),o.value=[],r.value=""),s("relist")}else g()},M=()=>{o.value=[],r.value="",y()},T=()=>{s("move-files")},I=()=>{s("create-directory")};return(D,P)=>(C(),R("div",cs,[l("div",us,[l("span",null,x(u(a)("With selected:")),1),l("div",hs,[l("div",ps,[l("button",{ref_key:"$playlistDropdown",ref:m,class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false",disabled:!n.value},[_(H,{icon:u(Mt)},null,8,["icon"]),l("span",null,x(u(a)("Playlists")),1),P[4]||(P[4]=l("span",{class:"caret"},null,-1))],8,ms),l("div",fs,[l("form",{class:"px-4 py-3",onSubmit:K(y,["prevent"])},[(C(!0),R(B,null,ve(D.playlists,L=>(C(),R("div",{key:L.id,class:"form-group"},[l("div",vs,[ae(l("input",{id:"chk_playlist_"+L.id,"onUpdate:modelValue":P[0]||(P[0]=V=>o.value=V),type:"checkbox",class:"custom-control-input",name:"playlists[]",value:L.id},null,8,bs),[[Fe,o.value]]),l("label",{class:"custom-control-label",for:"chk_playlist_"+L.id},x(L.name),9,gs)])]))),128)),P[6]||(P[6]=l("hr",{class:"dropdown-divider"},null,-1)),l("div",ys,[l("div",_s,[l("div",ws,[ae(l("input",{id:"chk_playlist_new","onUpdate:modelValue":P[1]||(P[1]=L=>o.value=L),type:"checkbox",class:"custom-control-input",value:"new"},null,512),[[Fe,o.value]]),P[5]||(P[5]=l("label",{class:"custom-control-label",for:"chk_playlist_new"},null,-1))]),ae(l("input",{id:"new_playlist_name","onUpdate:modelValue":P[2]||(P[2]=L=>r.value=L),type:"text",class:"form-control p-2",name:"new_playlist_name",style:{"min-width":"150px"},placeholder:u(a)("New Playlist")},null,8,Cs),[[$e,r.value]])])]),l("div",$s,[l("button",ks,x(u(a)("Save")),1),l("button",{class:"btn btn-warning",type:"button",onClick:P[3]||(P[3]=L=>M())},x(u(a)("Clear")),1)])],32)])])]),l("button",{type:"button",class:"btn btn-sm btn-primary",disabled:!n.value,onClick:T},[_(H,{icon:u(Pt)},null,8,["icon"]),l("span",null,x(u(a)("Move")),1)],8,xs),l("div",Ss,[l("div",Ds,[l("button",{class:"btn btn-sm btn-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",disabled:!n.value},[_(H,{icon:u(Tt)},null,8,["icon"]),l("span",null,x(u(a)("More")),1),P[7]||(P[7]=l("span",{class:"caret"},null,-1))],8,Es),l("ul",Ms,[l("li",null,[l("button",{type:"button",title:u(a)("Queue the selected media to play next"),class:"dropdown-item",onClick:$},x(u(a)("Queue")),9,Ps)]),l("li",null,[D.supportsImmediateQueue?(C(),R("button",{key:0,type:"button",class:"dropdown-item",title:u(a)("Make the selected media play immediately, interrupting existing media"),onClick:k},x(u(a)("Play Now")),9,Ts)):Z("",!0)]),l("li",null,[l("button",{type:"button",class:"dropdown-item",title:u(a)("Analyze and reprocess the selected media"),onClick:w},x(u(a)("Reprocess")),9,Rs)]),l("li",null,[l("button",{type:"button",class:"dropdown-item",title:u(a)("Remove any extra metadata (fade points, cue points, etc.) from the selected media"),onClick:f},x(u(a)("Clear Extra Metadata")),9,Ls)])])])]),l("button",{type:"button",class:"btn btn-sm btn-danger",disabled:!n.value,onClick:S},[_(H,{icon:u(Rt)},null,8,["icon"]),l("span",null,x(u(a)("Delete")),1)],8,As)]),l("div",Is,[l("button",{type:"button",class:"btn btn-sm btn-primary",onClick:I},[_(H,{icon:u(be)},null,8,["icon"]),l("span",null,x(u(a)("New Folder")),1)])])]))}}),Ws={"aria-label":"breadcrumb"},Fs={class:"breadcrumb"},Ns={class:"breadcrumb-item"},zs=["onClick"],Us=z({__name:"Breadcrumb",props:{currentDirectory:{}},emits:["change-directory"],setup(c,{emit:e}){const t=c,s=e,i=Y(()=>{const o=[];if(t.currentDirectory==="")return o;let r="";return t.currentDirectory.split("/").forEach(d=>{r===""?r+=d:r+="/"+d,o.push({dir:r,display:d})}),o}),n=o=>{s("change-directory",o)};return(o,r)=>(C(),R(B,null,[l("nav",Ws,[l("ol",Fs,[l("li",Ns,[l("a",{href:"#",onClick:r[0]||(r[0]=K(a=>n(""),["prevent"]))},x(o.$gettext("Home")),1)]),(C(!0),R(B,null,ve(i.value,a=>(C(),R("li",{key:a.dir,class:"breadcrumb-item"},[l("a",{href:"#",onClick:K(d=>n(a.dir),["prevent"])},x(a.display),9,zs)]))),128))])]),r[1]||(r[1]=l("h3",{id:"breadcrumb",class:"card-subtitle mt-0 mb-2"},null,-1))],64))}}),Bs=z({__name:"FileUpload",props:{uploadUrl:{},currentDirectory:{},searchPhrase:{},validMimeTypes:{default:()=>["audio/*"]}},emits:["relist"],setup(c,{emit:e}){const t=c,s=e,i=Y(()=>{const o=new URL(t.uploadUrl,document.location.href);return o.searchParams.set("currentDirectory",t.currentDirectory),o.searchParams.set("searchPhrase",t.searchPhrase),o.toString()}),n=()=>{s("relist")};return(o,r)=>(C(),F(jt,{"target-url":i.value,"valid-mime-types":o.validMimeTypes,"allow-multiple":"",onComplete:n,onError:n},null,8,["target-url","valid-mime-types"]))}}),js=z({__name:"NewDirectoryModal",props:{currentDirectory:{},mkdirUrl:{}},emits:["relist"],setup(c,{expose:e,emit:t}){const s=c,i=t,{record:n,reset:o}=pe({newDirectory:""}),{r$:r}=De(n,{newDirectory:{required:Ee}},{}),a=j("$modal"),{hide:d,show:h}=Me(a),p=()=>{o(),r.$reset()},g=j("$field"),b=()=>{Qe(()=>{g.value?.focus()})},{notifySuccess:k}=Se(),{axios:$}=ee(),{$gettext:w}=me(),f=async()=>{const{valid:v}=await r.$validate();if(v)try{await $.post(s.mkdirUrl,{currentDirectory:s.currentDirectory,name:n.value.newDirectory}),k(w("New directory created."))}finally{i("relist"),d()}};return e({open:h}),(v,S)=>(C(),F(Pe,{id:"create_directory",ref_key:"$modal",ref:a,centered:"",title:u(w)("New Directory"),onHidden:p,onShown:b},{"modal-footer":O(()=>[l("button",{type:"button",class:"btn btn-secondary",onClick:S[0]||(S[0]=(...m)=>u(d)&&u(d)(...m))},x(u(w)("Close")),1),l("button",{type:"button",class:Ge(["btn",u(r).$invalid?"btn-danger":"btn-primary"]),onClick:f},x(u(w)("Create Directory")),3)]),default:O(()=>[l("form",{onSubmit:K(f,["prevent"])},[_(U,{id:"new_directory_name",ref_key:"$field",ref:g,field:u(r).newDirectory,label:u(w)("Directory Name")},null,8,["field","label"]),_(Je)],32)]),_:1},8,["title"]))}}),Hs={class:"d-flex flex-column flex-md-row mb-3 align-items-center"},qs={class:"flex-shrink m-2 m-md-0 me-md-3"},Vs=["disabled"],Gs={class:"flex-fill m-2 m-md-0 text-end"},Qs={class:"m-0"},Xs={class:"row"},Ys={class:"col-md-12"},Ks={class:"is_dir d-flex align-items-center"},Js={class:"file-icon me-2"},Zs=["onClick"],ei=["disabled"],ti=z({__name:"MoveFilesModal",props:{selectedItems:{},currentDirectory:{},batchUrl:{},listDirectoriesUrl:{}},emits:["relist"],setup(c,{expose:e,emit:t}){const s=c,i=t,n=q(""),o=q([]),r=q(!1),{$gettext:a}=me(),d=[{key:"name",label:a("Directory"),sortable:!0}],h=Y(()=>a("Move %{num} File(s) to",{num:String(s.selectedItems.all.length)})),p=j("$modal"),{show:g,hide:b}=Me(p),k=()=>{o.value=[],n.value="",r.value=!1},{axios:$}=ee(),{handleBatchResponse:w}=et(),f=qe({queryKey:ke([xe.StationMedia,"directories",n]),queryFn:async({signal:T})=>{const{data:I}=await $.get(s.listDirectoriesUrl,{signal:T,params:{currentDirectory:n.value}});return I.rows},staleTime:60*1e3,enabled:r}),v=Ht(f),S=async()=>{try{const{data:T}=await $.put(s.batchUrl,{do:"move",currentDirectory:s.currentDirectory,directory:n.value,files:s.selectedItems.files,dirs:s.selectedItems.directories});w(T,a("Files moved:"),a("Error moving files:"))}finally{b(),i("relist")}},m=T=>{o.value.push(T),n.value=T},y=()=>{o.value.pop();let T=o.value.slice(-1)[0];(typeof T>"u"||T===null)&&(T=""),n.value=T};return e({open:()=>{r.value=!0,g()}}),(T,I)=>(C(),F(Pe,{id:"move_file",ref_key:"$modal",ref:p,size:"xl",centered:"",title:h.value,onHidden:I[1]||(I[1]=D=>k())},{"modal-footer":O(()=>[l("button",{type:"button",class:"btn btn-secondary",onClick:I[0]||(I[0]=(...D)=>u(b)&&u(b)(...D))},x(u(a)("Close")),1),l("button",{type:"button",class:"btn btn-primary",disabled:s.selectedItems.all.length===0,onClick:S},x(u(a)("Move to Directory")),9,ei)]),default:O(()=>[l("div",Hs,[l("div",qs,[l("button",{type:"button",class:"btn btn-sm btn-primary",disabled:o.value.length===0,onClick:y},[_(H,{icon:u(Lt)},null,8,["icon"]),l("span",null,x(u(a)("Back")),1)],8,Vs)]),l("div",Gs,[l("h5",Qs,[l("small",null,x(u(a)("Selected directory:")),1),I[2]||(I[2]=l("br",null,null,-1)),n.value?(C(),R(B,{key:0},[Q(x(n.value),1)],64)):(C(),R(B,{key:1},[Q(x(u(a)("Base Directory")),1)],64))])])]),l("div",Xs,[l("div",Ys,[_(Ye,{id:"station_media_directories","show-toolbar":"",paginated:"",fields:d,provider:u(v)},{"cell(name)":O(({item:D})=>[l("div",Ks,[l("span",Js,[_(H,{icon:u(be)},null,8,["icon"])]),l("a",{href:"#",onClick:K(P=>m(D.path),["prevent"])},x(D.name),9,Zs)])]),_:1},8,["provider"])])])]),_:1},8,["title"]))}}),si=z({__name:"RenameModal",props:{renameUrl:{}},emits:["relist"],setup(c,{expose:e,emit:t}){const s=c,i=t,n=q(null),{record:o,reset:r}=pe({newPath:""}),{r$:a}=De(o,{newPath:{required:Ee}},{}),d=j("$modal"),{show:h,hide:p}=Me(d),g=v=>{n.value=v,o.value.newPath=v,h()},b=j("$field"),k=()=>{Qe(()=>{b.value?.focus()})},$=()=>{r(),a.$reset(),n.value=null},{axios:w}=ee(),f=async()=>{const{valid:v}=await a.$validate();if(v)try{await w.put(s.renameUrl,{file:n.value,...o.value})}finally{p(),i("relist")}};return e({open:g}),(v,S)=>(C(),F(Pe,{id:"rename_file",ref_key:"$modal",ref:d,centered:"",title:v.$gettext("Rename File/Directory"),onShown:k,onHidden:$},{"modal-footer":O(()=>[l("button",{type:"button",class:"btn btn-secondary",onClick:S[0]||(S[0]=(...m)=>u(p)&&u(p)(...m))},x(v.$gettext("Close")),1),l("button",{type:"button",class:Ge(["btn",u(a).$invalid?"btn-danger":"btn-primary"]),onClick:f},x(v.$gettext("Rename")),3)]),default:O(()=>[l("form",{onSubmit:K(f,["prevent"])},[_(U,{id:"new_directory_name",ref_key:"$field",ref:b,field:u(a).newPath,label:v.$gettext("New File Name")},null,8,["field","label"]),_(Je)],32)]),_:1},8,["title"]))}}),tt=Symbol(),de=pt("form-stations-media",()=>{const c=mt(tt),{record:e,reset:t}=pe({length:0,length_text:"",links:{art:"",waveform:"",waveform_cache:"",play:""}}),{record:s,reset:i}=pe(()=>{const r={path:"",title:null,artist:null,album:null,genre:null,lyrics:null,isrc:null,custom_fields:{},extra_metadata:{amplify:null,cross_start_next:null,fade_in:null,fade_out:null,cue_in:null,cue_out:null},playlists:[]};return se(c.value.slice(),a=>{a.short_name&&(r.custom_fields[a.short_name]=null)}),r}),{r$:n}=De(s,{path:{required:Ee}},{validationGroups:r=>({basicInfoTab:[r.path,r.title,r.artist,r.album,r.genre,r.lyrics,r.isrc],advancedSettingsTab:[r.extra_metadata.amplify,r.extra_metadata.cross_start_next,r.extra_metadata.fade_in,r.extra_metadata.fade_out,r.extra_metadata.cue_in,r.extra_metadata.cue_out]})});return{customFields:c,record:e,form:s,r$:n,$reset:()=>{i(),t(),n.$reset()}}}),ii={class:"row g-3"},ni=z({__name:"BasicInfo",setup(c){const{r$:e}=te(de()),t=Ze(Y(()=>e.value.$groups.basicInfoTab));return(s,i)=>(C(),F(ne,{label:s.$gettext("Basic Information"),"item-header-class":u(t)},{default:O(()=>[l("div",ii,[_(U,{id:"edit_form_path",class:"col-md-6",field:u(e).path,label:s.$gettext("File Name"),description:s.$gettext("The relative path of the file in the station's media directory.")},null,8,["field","label","description"]),_(U,{id:"edit_form_title",class:"col-md-6",field:u(e).title,label:s.$gettext("Song Title")},null,8,["field","label"]),_(U,{id:"edit_form_artist",class:"col-md-6",field:u(e).artist,label:s.$gettext("Song Artist")},null,8,["field","label"]),_(U,{id:"edit_form_genre",class:"col-md-6",field:u(e).genre,label:s.$gettext("Song Genre")},null,8,["field","label"]),_(U,{id:"edit_form_album",class:"col-md-6",field:u(e).album,label:s.$gettext("Song Album")},null,8,["field","label"]),_(U,{id:"edit_form_lyrics",class:"col-md-6",field:u(e).lyrics,"input-type":"textarea",label:s.$gettext("Song Lyrics")},null,8,["field","label"]),_(U,{id:"edit_form_isrc",class:"col-md-6",field:u(e).isrc,label:s.$gettext("ISRC"),description:s.$gettext("International Standard Recording Code, used for licensing reports.")},null,8,["field","label","description"])])]),_:1},8,["label","item-header-class"]))}}),oi={class:"row g-3"},ri={class:"col-md-4"},ai=["src"],li={class:"block-buttons mt-2"},di={class:"col-md-8"},ci=z({__name:"AlbumArt",props:{albumArtUrl:{}},setup(c){const e=c,t=q(e.albumArtUrl),s=()=>{t.value=e.albumArtUrl+"?"+Math.floor(Date.now()/1e3)};X(fe(e,"albumArtUrl"),s);const{axios:i}=ee(),n=r=>{if(r===null)return;const a=new FormData;a.append("art",r),i.post(e.albumArtUrl,a).finally(()=>{s()})},o=()=>{i.delete(e.albumArtUrl).finally(()=>{s()})};return(r,a)=>(C(),R("div",oi,[l("div",ri,[l("img",{src:t.value,class:"rounded img-fluid",alt:"Album Art"},null,8,ai),l("div",li,[l("button",{type:"button",class:"btn btn-link btn-block btn-danger",onClick:o},x(r.$gettext("Delete Album Art")),1)])]),l("div",di,[_(Vt,{id:"edit_form_art"},{label:O(()=>[Q(x(r.$gettext("Replace Album Cover Art")),1)]),default:O(({id:d})=>[_(Gt,{id:d,accept:"image/*",onUploaded:n},null,8,["id"])]),_:1})])]))}}),ui={class:"row"},hi=z({__name:"CustomFields",props:{customFields:{}},setup(c){const{r$:e}=te(de()),t=s=>e.value.custom_fields[s.short_name];return(s,i)=>(C(),F(ne,{label:s.$gettext("Custom Fields")},{default:O(()=>[l("div",ui,[(C(!0),R(B,null,ve(s.customFields,n=>(C(),F(U,{id:"edit_form_custom_"+n.short_name,key:n.short_name,class:"col-md-6",field:t(n),label:n.name},null,8,["id","field","label"]))),128))])]),_:1},8,["label"]))}}),pi={class:"row g-3"},mi=z({__name:"AdvancedSettings",props:{songLength:{}},setup(c){const{r$:e}=te(de()),t=Ze(Y(()=>e.value.$groups.advancedSettingsTab));return(s,i)=>(C(),F(ne,{label:s.$gettext("Advanced"),"item-header-class":u(t)},{default:O(()=>[l("div",pi,[_(Qt,{id:"form_song_length",label:s.$gettext("Song Length")},{default:O(()=>[Q(x(s.songLength),1)]),_:1},8,["label"]),_(U,{id:"edit_form_amplify",class:"col-md-6",field:u(e).extra_metadata.amplify,"input-type":"number","input-attrs":{step:"any"},label:s.$gettext("Amplify: Amplification (dB)"),description:s.$gettext("The volume in decibels to amplify the track with. Leave blank to use the system default."),clearable:""},null,8,["field","label","description"]),_(U,{id:"edit_form_cross_start_next",class:"col-md-6",field:u(e).extra_metadata.cross_start_next,"input-type":"number","input-attrs":{step:"any"},label:s.$gettext("Custom Fading: Start Next (seconds)"),description:s.$gettext("Seconds from the start of the song that the next song should begin when fading. Leave blank to use the system default."),clearable:""},null,8,["field","label","description"]),_(U,{id:"edit_form_fade_in",class:"col-md-6",field:u(e).extra_metadata.fade_in,"input-type":"number","input-attrs":{step:"any"},label:s.$gettext("Custom Fading: Fade-In Time (seconds)"),description:s.$gettext("The time period that the song should fade in. Leave blank to use the system default."),clearable:""},null,8,["field","label","description"]),_(U,{id:"edit_form_fade_out",class:"col-md-6",field:u(e).extra_metadata.fade_out,"input-type":"number","input-attrs":{step:"any"},label:s.$gettext("Custom Fading: Fade-Out Time (seconds)"),description:s.$gettext("The time period that the song should fade out. Leave blank to use the system default."),clearable:""},null,8,["field","label","description"]),_(U,{id:"edit_form_cue_in",class:"col-md-6",field:u(e).extra_metadata.cue_in,"input-type":"number","input-attrs":{step:"any"},label:s.$gettext("Custom Cues: Cue-In Point (seconds)"),description:s.$gettext("Seconds from the start of the song that the AutoDJ should start playing."),clearable:""},null,8,["field","label","description"]),_(U,{id:"edit_form_cue_out",class:"col-md-6",field:u(e).extra_metadata.cue_out,"input-type":"number","input-attrs":{step:"any"},label:s.$gettext("Custom Cues: Cue-Out Point (seconds)"),description:s.$gettext("Seconds from the start of the song that the AutoDJ should stop playing."),clearable:""},null,8,["field","label","description"])])]),_:1},8,["label","item-header-class"]))}}),fi={class:"row"},vi=z({__name:"Playlists",props:{playlists:{}},setup(c){const e=c,{r$:t}=te(de()),s=Y(()=>ie(e.playlists,function(i){return{text:i.name,value:i.id}}));return(i,n)=>(C(),F(ne,{label:i.$gettext("Playlists")},{default:O(()=>[l("div",fi,[_(Xt,{id:"edit_form_playlists",class:"col-md-12",field:u(t).playlists,options:s.value,stacked:"",label:i.$gettext("Playlists")},null,8,["field","options","label"])])]),_:1},8,["label"]))}});function N(c,e,t,s){return new(t||(t=Promise))((function(i,n){function o(d){try{a(s.next(d))}catch(h){n(h)}}function r(d){try{a(s.throw(d))}catch(h){n(h)}}function a(d){var h;d.done?i(d.value):(h=d.value,h instanceof t?h:new t((function(p){p(h)}))).then(o,r)}a((s=s.apply(c,e||[])).next())}))}let ce=class{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),s?.once){const i=()=>{this.un(e,i),this.un(e,t)};return this.on(e,i),i}return()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((s=>s(...t)))}};const ue={decode:function(c,e){return N(this,void 0,void 0,(function*(){const t=new AudioContext({sampleRate:e});return t.decodeAudioData(c).finally((()=>t.close()))}))},createBuffer:function(c,e){return typeof c[0]=="number"&&(c=[c]),(function(t){const s=t[0];if(s.some((i=>i>1||i<-1))){const i=s.length;let n=0;for(let o=0;o<i;o++){const r=Math.abs(s[o]);r>n&&(n=r)}for(const o of t)for(let r=0;r<i;r++)o[r]/=n}})(c),{duration:e,length:c[0].length,sampleRate:c[0].length/e,numberOfChannels:c.length,getChannelData:t=>c?.[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function st(c,e){const t=e.xmlns?document.createElementNS(e.xmlns,c):document.createElement(c);for(const[s,i]of Object.entries(e))if(s==="children"&&i)for(const[n,o]of Object.entries(i))o instanceof Node?t.appendChild(o):typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(st(n,o));else s==="style"?Object.assign(t.style,i):s==="textContent"?t.textContent=i:t.setAttribute(s,i.toString());return t}function Be(c,e,t){const s=st(c,e||{});return t?.appendChild(s),s}var bi=Object.freeze({__proto__:null,createElement:Be,default:Be});const gi={fetchBlob:function(c,e,t){return N(this,void 0,void 0,(function*(){const s=yield fetch(c,t);if(s.status>=400)throw new Error(`Failed to fetch ${c}: ${s.status} (${s.statusText})`);return(function(i,n){N(this,void 0,void 0,(function*(){if(!i.body||!i.headers)return;const o=i.body.getReader(),r=Number(i.headers.get("Content-Length"))||0;let a=0;const d=p=>N(this,void 0,void 0,(function*(){a+=p?.length||0;const g=Math.round(a/r*100);n(g)})),h=()=>N(this,void 0,void 0,(function*(){let p;try{p=yield o.read()}catch{return}p.done||(d(p.value),yield h())}));h()}))})(s.clone(),e),s.blob()}))}};class yi extends ce{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onMediaEvent("canplay",(()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)}),{once:!0})}onMediaEvent(e,t,s){return this.media.addEventListener(e,t,s),()=>this.media.removeEventListener(e,t,s)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return this.media.canPlayType(e)!==""}setSrc(e,t){const s=this.getSrc();if(e&&s===e)return;this.revokeSrc();const i=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;if(s&&this.media.removeAttribute("src"),i||e)try{this.media.src=i}catch{this.media.src=e}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load())}setMediaElement(e){this.media=e}play(){return N(this,void 0,void 0,(function*(){try{return yield this.media.play()}catch(e){if(e instanceof DOMException&&e.name==="AbortError")return;throw e}}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=Math.max(0,Math.min(e,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}class oe extends ce{constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=e;const s=this.parentFromOptionsContainer(e.container);this.parent=s;const[i,n]=this.initHtml();s.appendChild(i),this.container=i,this.scrollContainer=n.querySelector(".scroll"),this.wrapper=n.querySelector(".wrapper"),this.canvasWrapper=n.querySelector(".canvases"),this.progressWrapper=n.querySelector(".progress"),this.cursor=n.querySelector(".cursor"),t&&n.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){const e=t=>{const s=this.wrapper.getBoundingClientRect(),i=t.clientX-s.left,n=t.clientY-s.top;return[i/s.width,n/s.height]};if(this.wrapper.addEventListener("click",(t=>{const[s,i]=e(t);this.emit("click",s,i)})),this.wrapper.addEventListener("dblclick",(t=>{const[s,i]=e(t);this.emit("dblclick",s,i)})),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:t,scrollWidth:s,clientWidth:i}=this.scrollContainer,n=t/s,o=(t+i)/s;this.emit("scroll",n,o,t,t+i)})),typeof ResizeObserver=="function"){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{t().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const e=this.parent.clientWidth;e===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=e,this.reRender())}initDrag(){this.subscriptions.push((function(e,t,s,i,n=3,o=0,r=100){if(!e)return()=>{};const a=matchMedia("(pointer: coarse)").matches;let d=()=>{};const h=p=>{if(p.button!==o)return;p.preventDefault(),p.stopPropagation();let g=p.clientX,b=p.clientY,k=!1;const $=Date.now(),w=y=>{if(y.preventDefault(),y.stopPropagation(),a&&Date.now()-$<r)return;const M=y.clientX,T=y.clientY,I=M-g,D=T-b;if(k||Math.abs(I)>n||Math.abs(D)>n){const P=e.getBoundingClientRect(),{left:L,top:V}=P;k||(s?.(g-L,b-V),k=!0),t(I,D,M-L,T-V),g=M,b=T}},f=y=>{if(k){const M=y.clientX,T=y.clientY,I=e.getBoundingClientRect(),{left:D,top:P}=I;i?.(M-D,T-P)}d()},v=y=>{y.relatedTarget&&y.relatedTarget!==document.documentElement||f(y)},S=y=>{k&&(y.stopPropagation(),y.preventDefault())},m=y=>{k&&y.preventDefault()};document.addEventListener("pointermove",w),document.addEventListener("pointerup",f),document.addEventListener("pointerout",v),document.addEventListener("pointercancel",v),document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("click",S,{capture:!0}),d=()=>{document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",f),document.removeEventListener("pointerout",v),document.removeEventListener("pointercancel",v),document.removeEventListener("touchmove",m),setTimeout((()=>{document.removeEventListener("click",S,{capture:!0})}),10)}};return e.addEventListener("pointerdown",h),()=>{d(),e.removeEventListener("pointerdown",h)}})(this.wrapper,((e,t,s)=>{this.emit("drag",Math.max(0,Math.min(1,s/this.wrapper.getBoundingClientRect().width)))}),(e=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))}),(e=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))})))}getHeight(e,t){var s;const i=((s=this.audioData)===null||s===void 0?void 0:s.numberOfChannels)||1;if(e==null)return 128;if(!isNaN(Number(e)))return Number(e);if(e==="auto"){const n=this.parent.clientHeight||128;return t?.every((o=>!o.overlay))?n/i:n}return 128}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"}),s=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML=`
      <style${s?` nonce="${s}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){const{scrollWidth:t}=this.scrollContainer,s=t*e;this.setScroll(s)}destroy(){var e,t;this.subscriptions.forEach((s=>s())),this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.unsubscribeOnScroll)===null||t===void 0||t.forEach((s=>s())),this.unsubscribeOnScroll=[]}createDelay(e=10){let t,s;const i=()=>{t&&clearTimeout(t),s&&s()};return this.timeouts.push(i),()=>new Promise(((n,o)=>{i(),s=o,t=setTimeout((()=>{t=void 0,s=void 0,n()}),e)}))}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const t=document.createElement("canvas"),s=t.getContext("2d"),i=t.height*(window.devicePixelRatio||1),n=s.createLinearGradient(0,0,0,i),o=1/(e.length-1);return e.forEach(((r,a)=>{const d=a*o;n.addColorStop(d,r)})),n}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(e,t,s,i){const n=e[0],o=e[1]||e[0],r=n.length,{width:a,height:d}=s.canvas,h=d/2,p=this.getPixelRatio(),g=t.barWidth?t.barWidth*p:1,b=t.barGap?t.barGap*p:t.barWidth?g/2:0,k=t.barRadius||0,$=a/(g+b)/r,w=k&&"roundRect"in s?"roundRect":"rect";s.beginPath();let f=0,v=0,S=0;for(let m=0;m<=r;m++){const y=Math.round(m*$);if(y>f){const I=Math.round(v*h*i),D=I+Math.round(S*h*i)||1;let P=h-I;t.barAlign==="top"?P=0:t.barAlign==="bottom"&&(P=d-D),s[w](f*(g+b),P,g,D,k),f=y,v=0,S=0}const M=Math.abs(n[m]||0),T=Math.abs(o[m]||0);M>v&&(v=M),T>S&&(S=T)}s.fill(),s.closePath()}renderLineWaveform(e,t,s,i){const n=o=>{const r=e[o]||e[0],a=r.length,{height:d}=s.canvas,h=d/2,p=s.canvas.width/a;s.moveTo(0,h);let g=0,b=0;for(let k=0;k<=a;k++){const $=Math.round(k*p);if($>g){const f=h+(Math.round(b*h*i)||1)*(o===0?-1:1);s.lineTo(g,f),g=$,b=0}const w=Math.abs(r[k]||0);w>b&&(b=w)}s.lineTo(g,h)};s.beginPath(),n(0),n(1),s.fill(),s.closePath()}renderWaveform(e,t,s){if(s.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction)return void t.renderFunction(e,s);let i=t.barHeight||1;if(t.normalize){const n=Array.from(e[0]).reduce(((o,r)=>Math.max(o,Math.abs(r))),0);i=n?1/n:1}t.barWidth||t.barGap||t.barAlign?this.renderBarWaveform(e,t,s,i):this.renderLineWaveform(e,t,s,i)}renderSingleCanvas(e,t,s,i,n,o,r){const a=this.getPixelRatio(),d=document.createElement("canvas");d.width=Math.round(s*a),d.height=Math.round(i*a),d.style.width=`${s}px`,d.style.height=`${i}px`,d.style.left=`${Math.round(n)}px`,o.appendChild(d);const h=d.getContext("2d");if(this.renderWaveform(e,t,h),d.width>0&&d.height>0){const p=d.cloneNode(),g=p.getContext("2d");g.drawImage(d,0,0),g.globalCompositeOperation="source-in",g.fillStyle=this.convertColorValues(t.progressColor),g.fillRect(0,0,d.width,d.height),r.appendChild(p)}}renderMultiCanvas(e,t,s,i,n,o){const r=this.getPixelRatio(),{clientWidth:a}=this.scrollContainer,d=s/r;let h=Math.min(oe.MAX_CANVAS_WIDTH,a,d),p={};if(t.barWidth||t.barGap){const w=t.barWidth||.5,f=w+(t.barGap||w/2);h%f!=0&&(h=Math.floor(h/f)*f)}if(h===0)return;const g=w=>{if(w<0||w>=b||p[w])return;p[w]=!0;const f=w*h;let v=Math.min(d-f,h);if(t.barWidth||t.barGap){const m=t.barWidth||.5,y=m+(t.barGap||m/2);v=Math.floor(v/y)*y}if(v<=0)return;const S=e.map((m=>{const y=Math.floor(f/d*m.length),M=Math.floor((f+v)/d*m.length);return m.slice(y,M)}));this.renderSingleCanvas(S,t,v,i,f,n,o)},b=Math.ceil(d/h);if(!this.isScrollable){for(let w=0;w<b;w++)g(w);return}const k=this.scrollContainer.scrollLeft/d,$=Math.floor(k*b);if(g($-1),g($),g($+1),b>1){const w=this.on("scroll",(()=>{const{scrollLeft:f}=this.scrollContainer,v=Math.floor(f/d*b);Object.keys(p).length>oe.MAX_NODES&&(n.innerHTML="",o.innerHTML="",p={}),g(v-1),g(v),g(v+1)}));this.unsubscribeOnScroll.push(w)}}renderChannel(e,t,s,i){var{overlay:n}=t,o=(function(h,p){var g={};for(var b in h)Object.prototype.hasOwnProperty.call(h,b)&&p.indexOf(b)<0&&(g[b]=h[b]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var k=0;for(b=Object.getOwnPropertySymbols(h);k<b.length;k++)p.indexOf(b[k])<0&&Object.prototype.propertyIsEnumerable.call(h,b[k])&&(g[b[k]]=h[b[k]])}return g})(t,["overlay"]);const r=document.createElement("div"),a=this.getHeight(o.height,o.splitChannels);r.style.height=`${a}px`,n&&i>0&&(r.style.marginTop=`-${a}px`),this.canvasWrapper.style.minHeight=`${a}px`,this.canvasWrapper.appendChild(r);const d=r.cloneNode();this.progressWrapper.appendChild(d),this.renderMultiCanvas(e,o,s,a,r,d)}render(e){return N(this,void 0,void 0,(function*(){var t;this.timeouts.forEach((a=>a())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const s=this.getPixelRatio(),i=this.scrollContainer.clientWidth,n=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrollable=n>i;const o=this.options.fillParent&&!this.isScrollable,r=(o?i:n)*s;if(this.wrapper.style.width=o?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render"),this.options.splitChannels)for(let a=0;a<e.numberOfChannels;a++){const d=Object.assign(Object.assign({},this.options),(t=this.options.splitChannels)===null||t===void 0?void 0:t[a]);this.renderChannel([e.getChannelData(a)],d,r,a)}else{const a=[e.getChannelData(0)];e.numberOfChannels>1&&a.push(e.getChannelData(1)),this.renderChannel(a,this.options,r,0)}Promise.resolve().then((()=>this.emit("rendered")))}))}reRender(){if(this.unsubscribeOnScroll.forEach((s=>s())),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){const{right:s}=this.progressWrapper.getBoundingClientRect();let i=s-t;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{scrollLeft:s,scrollWidth:i,clientWidth:n}=this.scrollContainer,o=e*i,r=s,a=s+n,d=n/2;if(this.isDragging)o+30>a?this.scrollContainer.scrollLeft+=30:o-30<r&&(this.scrollContainer.scrollLeft-=30);else{(o<r||o>a)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?d:0));const h=o-s-d;t&&this.options.autoCenter&&h>0&&(this.scrollContainer.scrollLeft+=Math.min(h,10))}{const h=this.scrollContainer.scrollLeft,p=h/i,g=(h+n)/i;this.emit("scroll",p,g,h,h+n)}}renderProgress(e,t){if(isNaN(e))return;const s=100*e;this.canvasWrapper.style.clipPath=`polygon(${s}% 0%, 100% 0%, 100% 100%, ${s}% 100%)`,this.progressWrapper.style.width=`${s}%`,this.cursor.style.left=`${s}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${e*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(e,t)}exportImage(e,t,s){return N(this,void 0,void 0,(function*(){const i=this.canvasWrapper.querySelectorAll("canvas");if(!i.length)throw new Error("No waveform data");if(s==="dataURL"){const n=Array.from(i).map((o=>o.toDataURL(e,t)));return Promise.resolve(n)}return Promise.all(Array.from(i).map((n=>new Promise(((o,r)=>{n.toBlob((a=>{a?o(a):r(new Error("Could not export image"))}),e,t)})))))}))}}oe.MAX_CANVAS_WIDTH=8e3,oe.MAX_NODES=10;class _i extends ce{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class we extends ce{constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return N(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then((t=>{if(t.status>=400)throw new Error(`Failed to fetch ${e}: ${t.status} (${t.statusText})`);return t.arrayBuffer()})).then((t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t))).then((t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}))}_play(){var e;if(!this.paused)return;this.paused=!1,(e=this.bufferNode)===null||e===void 0||e.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;(t>=this.duration||t<0)&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return N(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){const t=e-this.currentTime,s=this.bufferNode;s?.stop(this.audioContext.currentTime+t),s?.addEventListener("ended",(()=>{s===this.bufferNode&&(this.bufferNode=null,this.pause())}),{once:!0})}setSinkId(e){return N(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(e)}))}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){const t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return(e=this._duration)!==null&&e!==void 0?e:((t=this.buffer)===null||t===void 0?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){const e=[];if(!this.buffer)return e;const t=this.buffer.numberOfChannels;for(let s=0;s<t;s++)e.push(this.buffer.getChannelData(s));return e}removeAttribute(e){switch(e){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}const wi={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class le extends yi{static create(e){return new le(e)}constructor(e){const t=e.media||(e.backend==="WebAudio"?new we:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},wi,e),this.timer=new _i;const s=t?void 0:this.getMediaElement();this.renderer=new oe(this.options,s),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const i=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:n,duration:o}=this.options;(i||n&&o)&&this.load(i,n,o).catch((()=>null))}))}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e),this.stopAtPosition!=null&&this.isPlaying()&&e>=this.stopAtPosition&&this.pause()}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const e=this.updateProgress();this.emit("timeupdate",e)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("emptied",(()=>{this.timer.stop(),this.stopAtPosition=null})),this.onMediaEvent("ended",(()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(()=>{var e;this.emit("error",(e=this.getMediaElement().error)!==null&&e!==void 0?e:new Error("Media error")),this.stopAtPosition=null})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))})),this.renderer.on("dblclick",((e,t)=>{this.emit("dblclick",e,t)})),this.renderer.on("scroll",((e,t,s,i)=>{const n=this.getDuration();this.emit("scroll",e*n,t*n,s,i)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(e=>{this.emit("dragstart",e)})),this.renderer.on("dragend",(e=>{this.emit("dragend",e)})));{let e;this.subscriptions.push(this.renderer.on("drag",(t=>{if(!this.options.interact)return;let s;this.renderer.renderProgress(t),clearTimeout(e),this.isPlaying()?s=0:this.options.dragToSeek===!0?s=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(s=this.options.dragToSeek.debounceTime),e=setTimeout((()=>{this.seekTo(t)}),s),this.emit("interaction",t*this.getDuration()),this.emit("drag",t)})))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach((t=>{this.registerPlugin(t)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((e=>e())),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),e.duration&&!e.peaks&&(this.decodedData=ue.createBuffer(this.exportPeaks(),e.duration)),e.peaks&&e.duration&&(this.decodedData=ue.createBuffer(e.peaks,e.duration)),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){if(this.plugins.includes(e))return e;e._init(this),this.plugins.push(e);const t=e.once("destroy",(()=>{this.plugins=this.plugins.filter((s=>s!==e)),this.subscriptions=this.subscriptions.filter((s=>s!==t))}));return this.subscriptions.push(t),e}unregisterPlugin(e){this.plugins=this.plugins.filter((t=>t!==e)),e.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){const t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,t,s,i){return N(this,void 0,void 0,(function*(){var n;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,!t&&!s){const r=this.options.fetchParams||{};window.AbortController&&!r.signal&&(this.abortController=new AbortController,r.signal=(n=this.abortController)===null||n===void 0?void 0:n.signal);const a=h=>this.emit("loading",h);t=yield gi.fetchBlob(e,a,r);const d=this.options.blobMimeType;d&&(t=new Blob([t],{type:d}))}this.setSrc(e,t);const o=yield new Promise((r=>{const a=i||this.getDuration();a?r(a):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",(()=>r(this.getDuration())),{once:!0}))}));if(!e&&!t){const r=this.getMediaElement();r instanceof we&&(r.duration=o)}if(s)this.decodedData=ue.createBuffer(s,o||0);else if(t){const r=yield t.arrayBuffer();this.decodedData=yield ue.decode(r,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(e,t,s){return N(this,void 0,void 0,(function*(){try{return yield this.loadAudio(e,void 0,t,s)}catch(i){throw this.emit("error",i),i}}))}loadBlob(e,t,s){return N(this,void 0,void 0,(function*(){try{return yield this.loadAudio("",e,t,s)}catch(i){throw this.emit("error",i),i}}))}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:s=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const i=Math.min(e,this.decodedData.numberOfChannels),n=[];for(let o=0;o<i;o++){const r=this.decodedData.getChannelData(o),a=[],d=r.length/t;for(let h=0;h<t;h++){const p=r.slice(Math.floor(h*d),Math.ceil((h+1)*d));let g=0;for(let b=0;b<p.length;b++){const k=p[b];Math.abs(k)>Math.abs(g)&&(g=k)}a.push(Math.round(g*s)/s)}n.push(a)}return n}getDuration(){let e=super.getDuration()||0;return e!==0&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){this.stopAtPosition=null,super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}play(e,t){const s=Object.create(null,{play:{get:()=>super.play}});return N(this,void 0,void 0,(function*(){e!=null&&this.setTime(e);const i=yield s.play.call(this);return t!=null&&(this.media instanceof we?this.media.stopAt(t):this.stopAtPosition=t),i}))}playPause(){return N(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return N(this,arguments,void 0,(function*(e="image/png",t=1,s="dataURL"){return this.renderer.exportImage(e,t,s)}))}destroy(){var e;this.emit("destroy"),(e=this.abortController)===null||e===void 0||e.abort(),this.plugins.forEach((t=>t.destroy())),this.subscriptions.forEach((t=>t())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}le.BasePlugin=class extends ce{constructor(c){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=c}onInit(){}_init(c){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=c,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((c=>c())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},le.dom=bi;let Ci=class{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),s?.once){const i=()=>{this.un(e,i),this.un(e,t)};return this.on(e,i),i}return()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((s=>s(...t)))}},$i=class extends Ci{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((e=>e())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}};function it(c,e){const t=e.xmlns?document.createElementNS(e.xmlns,c):document.createElement(c);for(const[s,i]of Object.entries(e))if(s==="children"&&i)for(const[n,o]of Object.entries(i))o instanceof Node?t.appendChild(o):typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(it(n,o));else s==="style"?Object.assign(t.style,i):s==="textContent"?t.textContent=i:t.setAttribute(s,i.toString());return t}function Ce(c,e,t){return it(c,e||{})}const ki={height:20,timeOffset:0,formatTimeCallback:c=>c/60>1?`${Math.floor(c/60)}:${`${(c=Math.round(c%60))<10?"0":""}${c}`}`:`${Math.round(1e3*c)/1e3}`};let xi=class nt extends $i{constructor(e){super(e||{}),this.unsubscribeNotches=[],this.options=Object.assign({},ki,e),this.timelineWrapper=this.initTimelineWrapper()}static create(e){return new nt(e)}onInit(){var e;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let t=this.wavesurfer.getWrapper();if(this.options.container instanceof HTMLElement)t=this.options.container;else if(typeof this.options.container=="string"){const s=document.querySelector(this.options.container);if(!s)throw Error(`No Timeline container found matching ${this.options.container}`);t=s}this.options.insertPosition?(t.firstElementChild||t).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):t.appendChild(this.timelineWrapper),this.subscriptions.push(this.wavesurfer.on("redraw",(()=>this.initTimeline()))),(!((e=this.wavesurfer)===null||e===void 0)&&e.getDuration()||this.options.duration)&&this.initTimeline()}destroy(){this.unsubscribeNotches.forEach((e=>e())),this.unsubscribeNotches=[],this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){return Ce("div",{part:"timeline-wrapper",style:{pointerEvents:"none"}})}defaultTimeInterval(e){return e>=25?1:5*e>=25?5:15*e>=25?15:60*Math.ceil(.5/e)}defaultPrimaryLabelInterval(e){return e>=25?10:5*e>=25?6:4}defaultSecondaryLabelInterval(e){return e>=25?5:2}virtualAppend(e,t,s){let i=!1;const n=(a,d)=>{if(!this.wavesurfer)return;const h=s.clientWidth,p=e>=a&&e+h<d;p!==i&&(i=p,p?t.appendChild(s):s.remove())};if(!this.wavesurfer)return;const o=this.wavesurfer.getScroll(),r=o+this.wavesurfer.getWidth();n(o,r),this.unsubscribeNotches.push(this.wavesurfer.on("scroll",((a,d,h,p)=>{n(h,p)})))}initTimeline(){var e,t,s,i,n,o,r,a;this.unsubscribeNotches.forEach((S=>S())),this.unsubscribeNotches=[];const d=(s=(t=(e=this.wavesurfer)===null||e===void 0?void 0:e.getDuration())!==null&&t!==void 0?t:this.options.duration)!==null&&s!==void 0?s:0,h=(((i=this.wavesurfer)===null||i===void 0?void 0:i.getWrapper().scrollWidth)||this.timelineWrapper.scrollWidth)/d,p=(n=this.options.timeInterval)!==null&&n!==void 0?n:this.defaultTimeInterval(h),g=(o=this.options.primaryLabelInterval)!==null&&o!==void 0?o:this.defaultPrimaryLabelInterval(h),b=this.options.primaryLabelSpacing,k=(r=this.options.secondaryLabelInterval)!==null&&r!==void 0?r:this.defaultSecondaryLabelInterval(h),$=this.options.secondaryLabelSpacing,w=this.options.insertPosition==="beforebegin",f=Ce("div",{style:Object.assign({height:`${this.options.height}px`,overflow:"hidden",fontSize:this.options.height/2+"px",whiteSpace:"nowrap"},w?{position:"absolute",top:"0",left:"0",right:"0",zIndex:"2"}:{position:"relative"})});f.setAttribute("part","timeline"),typeof this.options.style=="string"?f.setAttribute("style",f.getAttribute("style")+this.options.style):typeof this.options.style=="object"&&Object.assign(f.style,this.options.style);const v=Ce("div",{style:{width:"0",height:"50%",display:"flex",flexDirection:"column",justifyContent:w?"flex-start":"flex-end",top:w?"0":"auto",bottom:w?"auto":"0",overflow:"visible",borderLeft:"1px solid currentColor",opacity:`${(a=this.options.secondaryLabelOpacity)!==null&&a!==void 0?a:.25}`,position:"absolute",zIndex:"1"}});for(let S=0,m=0;S<d;S+=p,m++){const y=v.cloneNode(),M=Math.round(100*S)%Math.round(100*g)==0||b&&m%b==0,T=Math.round(100*S)%Math.round(100*k)==0||$&&m%$==0;(M||T)&&(y.style.height="100%",y.style.textIndent="3px",y.textContent=this.options.formatTimeCallback(S),M&&(y.style.opacity="1"));const I=M?"primary":T?"secondary":"tick";y.setAttribute("part",`timeline-notch timeline-notch-${I}`);const D=Math.round(100*(S+this.options.timeOffset))/100*h;y.style.left=`${D}px`,this.virtualAppend(D,f,y)}this.timelineWrapper.innerHTML="",this.timelineWrapper.appendChild(f),this.emit("ready")}};class ot{constructor(){this.listeners={}}on(e,t,s){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),s?.once){const i=()=>{this.un(e,i),this.un(e,t)};return this.on(e,i),i}return()=>this.un(e,t)}un(e,t){var s;(s=this.listeners[e])===null||s===void 0||s.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((s=>s(...t)))}}class Si extends ot{constructor(e){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=e}onInit(){}_init(e){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((e=>e())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}function he(c,e,t,s,i=3,n=0,o=100){if(!c)return()=>{};const r=matchMedia("(pointer: coarse)").matches;let a=()=>{};const d=h=>{if(h.button!==n)return;h.preventDefault(),h.stopPropagation();let p=h.clientX,g=h.clientY,b=!1;const k=Date.now(),$=m=>{if(m.preventDefault(),m.stopPropagation(),r&&Date.now()-k<o)return;const y=m.clientX,M=m.clientY,T=y-p,I=M-g;if(b||Math.abs(T)>i||Math.abs(I)>i){const D=c.getBoundingClientRect(),{left:P,top:L}=D;b||(t?.(p-P,g-L),b=!0),e(T,I,y-P,M-L),p=y,g=M}},w=m=>{if(b){const y=m.clientX,M=m.clientY,T=c.getBoundingClientRect(),{left:I,top:D}=T;s?.(y-I,M-D)}a()},f=m=>{m.relatedTarget&&m.relatedTarget!==document.documentElement||w(m)},v=m=>{b&&(m.stopPropagation(),m.preventDefault())},S=m=>{b&&m.preventDefault()};document.addEventListener("pointermove",$),document.addEventListener("pointerup",w),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",S,{passive:!1}),document.addEventListener("click",v,{capture:!0}),a=()=>{document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",w),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",S),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return c.addEventListener("pointerdown",d),()=>{a(),c.removeEventListener("pointerdown",d)}}function rt(c,e){const t=e.xmlns?document.createElementNS(e.xmlns,c):document.createElement(c);for(const[s,i]of Object.entries(e))if(s==="children"&&i)for(const[n,o]of Object.entries(i))o instanceof Node?t.appendChild(o):typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(rt(n,o));else s==="style"?Object.assign(t.style,i):s==="textContent"?t.textContent=i:t.setAttribute(s,i.toString());return t}function re(c,e,t){const s=rt(c,e||{});return t?.appendChild(s),s}class je extends ot{constructor(e,t,s=0){var i,n,o,r,a,d,h,p,g,b;super(),this.totalDuration=t,this.numberOfChannels=s,this.element=null,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.isRemoved=!1,this.subscriptions=[],this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((i=e.end)!==null&&i!==void 0?i:e.start),this.drag=(n=e.drag)===null||n===void 0||n,this.resize=(o=e.resize)===null||o===void 0||o,this.resizeStart=(r=e.resizeStart)===null||r===void 0||r,this.resizeEnd=(a=e.resizeEnd)===null||a===void 0||a,this.color=(d=e.color)!==null&&d!==void 0?d:"rgba(0, 0, 0, 0.1)",this.minLength=(h=e.minLength)!==null&&h!==void 0?h:this.minLength,this.maxLength=(p=e.maxLength)!==null&&p!==void 0?p:this.maxLength,this.channelIdx=(g=e.channelIdx)!==null&&g!==void 0?g:-1,this.contentEditable=(b=e.contentEditable)!==null&&b!==void 0?b:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){var e;const t=this.start===this.end;(e=this.element)===null||e===void 0||e.setAttribute("part",`${t?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},s=re("div",{part:"region-handle region-handle-left",style:Object.assign(Object.assign({},t),{left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"})},e),i=re("div",{part:"region-handle region-handle-right",style:Object.assign(Object.assign({},t),{right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"})},e);this.subscriptions.push(he(s,(n=>this.onResize(n,"start")),(()=>null),(()=>this.onEndResizing()),1),he(i,(n=>this.onResize(n,"end")),(()=>null),(()=>this.onEndResizing()),1))}removeResizeHandles(e){const t=e.querySelector('[part*="region-handle-left"]'),s=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),s&&e.removeChild(s)}initElement(){if(this.isRemoved)return null;const e=this.start===this.end;let t=0,s=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(s=100/this.numberOfChannels,t=s*this.channelIdx);const i=re("div",{style:{position:"absolute",top:`${t}%`,height:`${s}%`,backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(i),i}renderPosition(){if(!this.element)return;const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}toggleCursor(e){var t;this.drag&&(!((t=this.element)===null||t===void 0)&&t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",(t=>this.emit("click",t))),e.addEventListener("mouseenter",(t=>this.emit("over",t))),e.addEventListener("mouseleave",(t=>this.emit("leave",t))),e.addEventListener("dblclick",(t=>this.emit("dblclick",t))),e.addEventListener("pointerdown",(()=>this.toggleCursor(!0))),e.addEventListener("pointerup",(()=>this.toggleCursor(!1))),this.subscriptions.push(he(e,(t=>this.onMove(t)),(()=>this.toggleCursor(!0)),(()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")}))),this.contentEditable&&this.content&&(this.content.addEventListener("click",(t=>this.onContentClick(t))),this.content.addEventListener("blur",(()=>this.onContentBlur()))))}_onUpdate(e,t){var s;if(!(!((s=this.element)===null||s===void 0)&&s.parentElement))return;const{width:i}=this.element.parentElement.getBoundingClientRect(),n=e/i*this.totalDuration,o=t&&t!=="start"?this.start:this.start+n,r=t&&t!=="end"?this.end:this.end+n,a=r-o;o>=0&&r<=this.totalDuration&&o<=r&&a>=this.minLength&&a<=this.maxLength&&(this.start=o,this.end=r,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||t!=="start")&&(this.resizeEnd||t!=="end")&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}getContent(e=!1){var t;return e?this.content||void 0:this.element instanceof HTMLElement?((t=this.content)===null||t===void 0?void 0:t.innerHTML)||void 0:""}setContent(e){var t;if(this.element)if((t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){const s=this.start===this.end;this.content=re("div",{style:{padding:`0.2em ${s?.2:.4}em`,display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content),this.emit("content-changed")}else this.content=void 0}setOptions(e){var t,s;if(this.element){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const i=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((s=e.end)!==null&&s!==void 0?s:i?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const i=this.start===this.end;this.resize=e.resize,this.resize&&!i?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}e.resizeStart!==void 0&&(this.resizeStart=e.resizeStart),e.resizeEnd!==void 0&&(this.resizeEnd=e.resizeEnd)}}remove(){this.isRemoved=!0,this.emit("remove"),this.subscriptions.forEach((e=>e())),this.element&&(this.element.remove(),this.element=null)}}class Te extends Si{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new Te(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",(t=>{const s=this.regions.filter((i=>i.start<=t&&(i.end===i.start?i.start+.05:i.end)>=t));s.forEach((i=>{e.includes(i)||this.emit("region-in",i)})),e.forEach((i=>{s.includes(i)||this.emit("region-out",i)})),e=s})))}initRegionsContainer(){return re("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout((()=>{const t=e.content,s=t.getBoundingClientRect(),i=this.regions.map((n=>{if(n===e||!n.content)return 0;const o=n.content.getBoundingClientRect();return s.left<o.left+o.width&&o.left<s.left+s.width?o.height:0})).reduce(((n,o)=>n+o),0);t.style.marginTop=`${i}px`}),10)}adjustScroll(e){var t,s;if(!e.element)return;const i=(s=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||s===void 0?void 0:s.parentElement;if(!i)return;const{clientWidth:n,scrollWidth:o}=i;if(o<=n)return;const r=i.getBoundingClientRect(),a=e.element.getBoundingClientRect(),d=a.left-r.left,h=a.right-r.left;d<0?i.scrollLeft+=d:h>n&&(i.scrollLeft+=h-n)}virtualAppend(e,t,s){const i=()=>{if(!this.wavesurfer)return;const n=this.wavesurfer.getWidth(),o=this.wavesurfer.getScroll(),r=t.clientWidth,a=this.wavesurfer.getDuration(),d=Math.round(e.start/a*r),h=d+(Math.round((e.end-e.start)/a*r)||1)>o&&d<o+n;h&&!s.parentElement?t.appendChild(s):!h&&s.parentElement&&s.remove()};setTimeout((()=>{if(!this.wavesurfer||!e.element)return;i();const n=this.wavesurfer.on("scroll",i),o=this.wavesurfer.on("zoom",i);this.subscriptions.push(e.once("remove",n),n),this.subscriptions.push(e.once("remove",o),o)}),0)}saveRegion(e){if(!e.element)return;this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update",(s=>{s||this.adjustScroll(e),this.emit("region-update",e,s)})),e.on("update-end",(()=>{this.avoidOverlapping(e),this.emit("region-updated",e)})),e.on("play",(s=>{var i;(i=this.wavesurfer)===null||i===void 0||i.play(e.start,s)})),e.on("click",(s=>{this.emit("region-clicked",e,s)})),e.on("dblclick",(s=>{this.emit("region-double-clicked",e,s)})),e.on("content-changed",(()=>{this.emit("region-content-changed",e)})),e.once("remove",(()=>{t.forEach((s=>s())),this.regions=this.regions.filter((s=>s!==e)),this.emit("region-removed",e)}))];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,s;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const i=this.wavesurfer.getDuration(),n=(s=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||s===void 0?void 0:s.numberOfChannels,o=new je(e,i,n);return this.emit("region-initialized",o),i?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once("ready",(r=>{o._setTotalDuration(r),this.saveRegion(o)}))),o}enableDragSelection(e,t=3){var s;const i=(s=this.wavesurfer)===null||s===void 0?void 0:s.getWrapper();if(!(i&&i instanceof HTMLElement))return()=>{};let n=null,o=0;return he(i,((r,a,d)=>{n&&n._onUpdate(r,d>o?"end":"start")}),(r=>{var a,d;if(o=r,!this.wavesurfer)return;const h=this.wavesurfer.getDuration(),p=(d=(a=this.wavesurfer)===null||a===void 0?void 0:a.getDecodedData())===null||d===void 0?void 0:d.numberOfChannels,{width:g}=this.wavesurfer.getWrapper().getBoundingClientRect(),b=r/g*h,k=(r+5)/g*h;n=new je(Object.assign(Object.assign({},e),{start:b,end:k}),h,p),this.emit("region-initialized",n),n.element&&this.regionsContainer.appendChild(n.element)}),(()=>{n&&(this.saveRegion(n),n=null)}),t)}clearRegions(){this.regions.slice().forEach((e=>e.remove())),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}}const Di={class:"waveform-controls"},Ei={class:"row mt-3 align-items-center"},Mi={class:"col-md-7"},Pi={class:"d-flex"},Ti={class:"flex-shrink-0"},Ri={for:"waveform-zoom"},Li={class:"flex-fill mx-3"},Ai={key:0,class:"col-md-5"},Ii={class:"inline-volume-controls d-flex align-items-center"},Oi={class:"flex-shrink-0 mx-2"},Wi={class:"flex-fill mx-1"},Fi=["title"],Ni=z({__name:"Waveform",props:{regions:{default:()=>[]},audioUrl:{},waveformUrl:{},waveformCacheUrl:{}},setup(c,{expose:e}){const t=c;let s=null,i=null;const n=Ve(),{showVolume:o,volume:r,logVolume:a,isMuted:d}=te(n),{toggle:h,toggleMute:p,setDuration:g,setCurrentTime:b}=n,k=q(0);X(k,m=>{s?.zoom(m)}),X(a,m=>{s?.setVolume(m)}),X(d,m=>{s?.setMuted(m)});const $=q(!1),{axiosSilent:w}=ee(),f=()=>{if(!t.waveformCacheUrl)return;const m=s?.getDecodedData()??null,y=s?.exportPeaks()??null;if(m===null||y===null)return;const M={source:"wavesurfer",channels:m.numberOfChannels,sample_rate:m.sampleRate,length:m.length,data:y};w.post(t.waveformCacheUrl,M)};return yt(async()=>{s=le.create({container:"#waveform_container",waveColor:"#2196f3",progressColor:"#4081CF"}),s.registerPlugin(xi.create()),i=s.registerPlugin(Te.create()),s.on("ready",m=>{h(),s?.setVolume(a.value),$.value||f(),g(m)}),s.on("decode",m=>{g(m)}),s.on("timeupdate",m=>{b(m)});try{const{data:m}=await w.get(t.waveformUrl),y=m?.data??null;y?($.value=!0,await s?.load(t.audioUrl,y)):($.value=!1,await s?.load(t.audioUrl))}catch{$.value=!1,await s?.load(t.audioUrl)}}),X(fe(t,"regions"),m=>{i?.clearRegions(),m.forEach(y=>{i?.addRegion({resize:!1,drag:!1,...y})})}),_t(()=>{s=null}),e({play:()=>{s?.play()},stop:()=>{s?.pause()}}),(m,y)=>(C(),R("div",Di,[y[2]||(y[2]=wt('<div class="row"><div class="col-md-12"><div id="waveform_container"><div id="waveform-timeline"></div><div id="waveform"></div></div></div></div>',1)),l("div",Ei,[l("div",Mi,[l("div",Pi,[l("div",Ti,[l("label",Ri,x(m.$gettext("Waveform Zoom")),1)]),l("div",Li,[ae(l("input",{id:"waveform-zoom","onUpdate:modelValue":y[0]||(y[0]=M=>k.value=M),type:"range",min:"0",max:"256",class:"w-100"},null,512),[[$e,k.value,void 0,{number:!0}]])])])]),u(o)?(C(),R("div",Ai,[l("div",Ii,[l("div",Oi,[_(Yt,{class:"p-0",volume:u(r),"is-muted":u(d),onToggleMute:u(p)},null,8,["volume","is-muted","onToggleMute"])]),l("div",Wi,[ae(l("input",{"onUpdate:modelValue":y[1]||(y[1]=M=>Xe(r)?r.value=M:null),type:"range",title:m.$gettext("Volume"),class:"player-volume-range form-range w-100",min:"0",max:"100",step:"1"},null,8,Fi),[[$e,u(r),void 0,{number:!0}]])])])])):Z("",!0)])]))}}),zi={class:"buttons mt-3"},Ui={class:"btn-group btn-group-sm"},Bi=["title"],ji=["title"],Hi={class:"btn-group btn-group-sm"},qi={class:"btn-group btn-group-sm"},Vi={class:"btn-group btn-group-sm"},Gi=z({__name:"WaveformEditor",props:Ct({duration:{},audioUrl:{},waveformUrl:{},waveformCacheUrl:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(c){const e=c,t=$t(c,"form"),s=j("$waveform"),{duration:i,currentTime:n}=te(Ve()),o=kt([]),r=ft(()=>{const f=t.value?.extra_metadata??{cue_in:null,cue_out:null,cross_start_next:null,fade_in:null,fade_out:null},v=i.value??e.duration??0;return{cue_in:f.cue_in??0,cue_out:f.cue_out??v,cross_start_next:f.cross_start_next??0,fade_in:f.fade_in??0,fade_out:f.fade_out??0}}),a=()=>{s.value?.play()},d=()=>{s.value?.stop()},h=()=>{const{cue_in:f,cue_out:v,cross_start_next:S,fade_in:m,fade_out:y}=r,M=[];M.push({start:f,end:v,color:"hsla(207,90%,54%,0.4)"}),S>f&&M.push({start:S,end:v,color:"hsla(29,100%,48%,0.4)"}),m&&M.push({start:f,end:m+f,color:"hsla(351,100%,48%,0.4)"}),y&&M.push({start:v-y,end:v,color:"hsla(351,100%,48%,0.4)"}),o.value=M};X(r,()=>{h()},{immediate:!0});const p=f=>Math.round(f*10)/10,g=()=>{t.value.extra_metadata.cue_in=p(n.value)},b=()=>{t.value.extra_metadata.cue_out=p(n.value)},k=()=>{t.value.extra_metadata.cross_start_next=p(n.value)},$=()=>{const f=n.value??0,v=t.value.extra_metadata.cue_in??0;t.value.extra_metadata.fade_in=p(f-v)},w=()=>{const f=n.value??0,v=i.value,S=t.value.extra_metadata.cue_out??v??0;t.value.extra_metadata.fade_out=p(S-f)};return(f,v)=>(C(),R(B,null,[l("p",null,x(f.$gettext("Set cue and fade points using the visual editor. The timestamps will be saved to the corresponding fields in the advanced playback settings.")),1),_(Ni,{ref_key:"$waveform",ref:s,regions:o.value,"audio-url":f.audioUrl,"waveform-url":f.waveformUrl,"waveform-cache-url":f.waveformCacheUrl},null,8,["regions","audio-url","waveform-url","waveform-cache-url"]),l("div",zi,[l("div",Ui,[l("button",{type:"button",class:"btn btn-light",title:f.$gettext("Play"),onClick:a},[_(H,{icon:u(At)},null,8,["icon"])],8,Bi),l("button",{type:"button",class:"btn btn-dark",title:f.$gettext("Stop"),onClick:d},[_(H,{icon:u(It)},null,8,["icon"])],8,ji)]),l("div",Hi,[l("button",{type:"button",class:"btn btn-primary",onClick:g},x(f.$gettext("Set Cue In")),1),l("button",{type:"button",class:"btn btn-primary",onClick:b},x(f.$gettext("Set Cue Out")),1)]),l("div",qi,[l("button",{type:"button",class:"btn btn-warning",onClick:k},x(f.$gettext("Set Fade Start Next")),1)]),l("div",Vi,[l("button",{type:"button",class:"btn btn-danger",onClick:$},x(f.$gettext("Set Fade In")),1),l("button",{type:"button",class:"btn btn-danger",onClick:w},x(f.$gettext("Set Fade Out")),1)])])],64))}}),Qi=z({__name:"EditModal",props:{customFields:{},playlists:{}},emits:["relist"],setup(c,{expose:e,emit:t}){const s=c,i=t,n=j("$modal");vt(tt,fe(s,"customFields"));const o=de(),{form:r,record:a,r$:d}=te(o),{$reset:h}=o,{loading:p,error:g,clearContents:b,edit:k,doSubmit:$}=Jt(null,i,n,h,v=>{a.value=Ne(a.value,v);const S=Ne(d.value.$value,v);S.playlists=ie(v.playlists,"id"),S.custom_fields={},se(s.customFields.slice(),m=>{S.custom_fields[m.short_name]=v.custom_fields&&v.custom_fields[m.short_name]?v.custom_fields[m.short_name]:null}),d.value.$reset({toState:S})},async()=>{const{valid:v}=await d.value.$validate();return{valid:v,data:r.value}}),w=v=>{k(v)},f=()=>{b()};return e({open:w}),(v,S)=>(C(),F(Kt,{ref_key:"$modal",ref:n,loading:u(p),title:v.$gettext("Edit Media"),error:u(g),"disable-save-button":u(d).$invalid,onSubmit:u($),onHidden:f},{default:O(()=>[_(qt,{"destroy-on-hide":""},{default:O(()=>[_(ni),_(vi,{playlists:v.playlists},null,8,["playlists"]),_(ne,{label:v.$gettext("Album Art")},{default:O(()=>[_(ci,{"album-art-url":u(a).links.art},null,8,["album-art-url"])]),_:1},8,["label"]),v.customFields.length>0?(C(),F(hi,{key:0,"custom-fields":v.customFields},null,8,["custom-fields"])):Z("",!0),_(ne,{label:v.$gettext("Visual Cue Editor")},{default:O(()=>[_(Gi,{form:u(r),"onUpdate:form":S[0]||(S[0]=m=>Xe(r)?r.value=m:null),duration:u(a).length,"audio-url":u(a).links.play,"waveform-url":u(a).links.waveform,"waveform-cache-url":u(a).links.waveform_cache},null,8,["form","duration","audio-url","waveform-url","waveform-cache-url"])]),_:1},8,["label"]),_(mi,{"song-length":u(a).length_text},null,8,["song-length"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit"]))}}),Xi=["title","onClick"],Yi={class:"text-wrap"},Ki=["title","onClick"],Ji={key:2},He=z({__name:"MediaPlaylists",props:{playlists:{}},emits:["filter"],setup(c,{emit:e}){const t=e;return(s,i)=>(C(!0),R(B,null,ve(s.playlists,(n,o)=>(C(),R(B,{key:n.id},[n.folder!==null?(C(),R("a",{key:0,class:"btn-search text-nowrap",href:"#",title:s.$gettext("This playlist is assigned from the folder %{folder}. Click to view tracks in playlist",{folder:n.folder}),onClick:K(r=>t("filter","playlist:"+n.short_name),["prevent"])},[_(H,{icon:u(be),class:"sm me-1"},null,8,["icon"]),l("span",Yi,x(n.name),1)],8,Xi)):(C(),R("a",{key:1,class:"btn-search",href:"#",title:s.$gettext("View tracks in playlist"),onClick:K(r=>t("filter","playlist:"+n.short_name),["prevent"])},x(n.name),9,Ki)),o+1<s.playlists.length?(C(),R("span",Ji,", ")):Z("",!0)],64))),128))}}),Zi={class:"card",role:"region","aria-labelledby":"hdr_music_files"},en={class:"card-header text-bg-primary"},tn={class:"row align-items-center"},sn={class:"col-md-7"},nn={id:"hdr_music_files",class:"card-title"},on={class:"col-md-5 text-end"},rn={class:"mb-0"},an={class:"card-body"},ln={class:"d-flex align-items-center"},dn={class:"flex-shrink-0 pe-2"},cn={key:0,class:"file-icon"},un={key:1,class:"file-icon"},hn={key:2,class:"file-icon"},pn={class:"flex-fill"},mn=["title","onClick"],fn=["href","title"],vn=["href","title"],bn={key:3},gn={key:4},yn=["onClick"],_n=["onClick"],wn=z({__name:"Media",props:{initialPlaylists:{},validMimeTypes:{},supportsImmediateQueue:{type:Boolean},customFields:{}},setup(c){const e=c,t=ut(),s=Y(()=>t.value.features.sftp??!1),i=J("/files/list"),n=J("/files/batch"),o=J("/files/upload"),r=J("/files/directories"),a=J("/files/mkdir"),d=J("/files/rename"),h=J(`/quota/${bt.StationMedia}`),p=q(""),g=A=>A.substring(0,9)==="playlist:"||A.substring(0,8)==="special:",b=is(),k=ns();X(()=>k.params,async A=>{let W=A.path??"";Array.isArray(W)&&(W=W.join("")),g(W)?(await b.push({name:"stations:files:index"}),D(W)):p.value=W},{immediate:!0});const{$gettext:$}=me(),{formatTimestampAsDateTime:w}=os(),f=rs(i,ke([xe.StationMedia,"files",p]),{staleTime:120*1e3},A=>(A.params.currentDirectory=p.value,A)),v=Y(()=>{const A=[{key:"path",isRowHeader:!0,label:$("Name"),sortable:!0},{key:"media.title",label:$("Title"),sortable:!0,selectable:!0,visible:!1},{key:"media.artist",label:$("Artist"),sortable:!0,selectable:!0,visible:!1},{key:"media.album",label:$("Album"),sortable:!0,selectable:!0,visible:!1},{key:"media.genre",label:$("Genre"),sortable:!0,selectable:!0,visible:!1},{key:"media.isrc",label:$("ISRC"),sortable:!0,selectable:!0,visible:!1},{key:"media.length",label:$("Length"),sortable:!0,selectable:!0,visible:!0}];return se({...e.customFields},W=>{A.push({key:"media.custom_fields["+W.short_name+"]",label:W.name,sortable:!0,selectable:!0,visible:!1})}),A.push({key:"size",label:$("Size"),sortable:!0,selectable:!0,visible:!0},{key:"timestamp",label:$("Modified"),sortable:!0,formatter:W=>w(W),selectable:!0,visible:!0},{key:"media.uploaded_at",label:$("Uploaded Time"),sortable:!0,formatter:W=>w(W),selectable:!0,visible:!1},{key:"media.mtime",label:$("Last Processed Time"),sortable:!0,formatter:W=>w(W),selectable:!0,visible:!1},{key:"playlists",label:$("Playlists"),sortable:!1,selectable:!0,visible:!0},{key:"commands",label:$("Actions"),sortable:!1,class:"shrink"}),A}),S=q(e.initialPlaylists),m=q({all:[],files:[],directories:[]}),y=q(""),M=A=>{const W=ds(A,ye=>ye.type===G.Directory);m.value={all:A,files:ie(W[1],"path"),directories:ie(W[0],"path")}},T=j("$dataTable"),I=()=>{T.value?.navigate()},D=A=>{T.value?.setFilter(A)},P=j("$quota"),L=()=>{f.refresh(!0),P.value?.update()},V=A=>{S.value.push(A)},ge=A=>{y.value=A},Re=j("$renameModal"),at=A=>{Re.value?.open(A)},Le=j("$editModal"),lt=A=>{Le.value?.open(A)},Ae=j("$newDirectoryModal"),dt=()=>{Ae.value?.open()},Ie=j("$moveFilesModal"),ct=()=>{Ie.value?.open()},Oe=A=>{b.push({name:"stations:files:index",params:{path:A}}),I()};return(A,W)=>{const ye=xt("router-link");return C(),R(B,null,[l("section",Zi,[l("div",en,[l("div",tn,[l("div",sn,[l("h2",nn,x(u($)("Music Files")),1)]),l("div",on,[_(Zt,{ref_key:"$quota",ref:P,"quota-url":u(h)},null,8,["quota-url"])])])]),s.value?(C(),F(ss,{key:0},{action:O(()=>[_(ye,{class:"btn btn-sm btn-info",to:{name:"stations:sftp_users:index"}},{default:O(()=>[Q(x(u($)("Manage SFTP Accounts")),1)]),_:1})]),default:O(()=>[l("p",rn,x(u($)("You can also upload files in bulk via SFTP.")),1)]),_:1})):Z("",!0),l("div",an,[_(Us,{"current-directory":p.value,onChangeDirectory:Oe},null,8,["current-directory"]),_(Bs,{"upload-url":u(o),"search-phrase":y.value,"valid-mime-types":A.validMimeTypes,"current-directory":p.value,onRelist:L},null,8,["upload-url","search-phrase","valid-mime-types","current-directory"]),_(Os,{"batch-url":u(n),"selected-items":m.value,"current-directory":p.value,"supports-immediate-queue":A.supportsImmediateQueue,playlists:S.value,onAddPlaylist:V,onRelist:L,onCreateDirectory:dt,onMoveFiles:ct},null,8,["batch-url","selected-items","current-directory","supports-immediate-queue","playlists"])]),_(Ye,{id:"station_media",ref_key:"$dataTable",ref:T,selectable:"",paginated:"","select-fields":"",fields:v.value,provider:u(f),onRowSelected:M,onFiltered:ge},{"cell(path)":O(({item:E})=>[l("div",ln,[l("div",dn,[E.type===u(G).Media?(C(),F(es,{key:0,class:"btn-lg",stream:{title:E.text,url:E.media.links.play}},null,8,["stream"])):(C(),R(B,{key:1},[E.type===u(G).Directory?(C(),R("span",cn,[_(H,{icon:u(be)},null,8,["icon"])])):E.type===u(G).CoverArt?(C(),R("span",un,[_(H,{icon:u(Ot)},null,8,["icon"])])):(C(),R("span",hn,[_(H,{icon:u(Wt)},null,8,["icon"])]))],64))]),l("div",pn,[E.type===u(G).Directory?(C(),R("a",{key:0,class:"name",href:"#",title:E.text,onClick:K(We=>Oe(E.path),["prevent"])},x(E.path_short),9,mn)):E.type===u(G).Media?(C(),R(B,{key:1},[E.media?(C(),R("a",{key:0,class:"name",href:E.media.links.play,target:"_blank",title:E.text},x(E.text),9,fn)):Z("",!0)],64)):(C(),R("a",{key:2,class:"name",href:E.links.download,target:"_blank",title:E.text},x(E.path_short),9,vn)),W[0]||(W[0]=l("br",null,null,-1)),E.type===u(G).Media?(C(),R("small",bn,x(E.path_short),1)):(C(),R("small",gn,x(E.text),1))]),E.media?.art?(C(),F(ze,{key:0,src:E.media.art,class:"flex-shrink-1 ps-2"},null,8,["src"])):E.type===u(G).CoverArt?(C(),F(ze,{key:1,src:E.links.download,class:"flex-shrink-1 ps-2"},null,8,["src"])):Z("",!0)])]),"cell(media.length)":O(({item:E})=>[Q(x(E.media?.length_text),1)]),"cell(size)":O(({item:E})=>[E.size?(C(),R(B,{key:1},[Q(x(u(ts)(E.size)),1)],64)):(C(),R(B,{key:0},[Q("   ")],64))]),"cell(playlists)":O(({item:E})=>[E.type===u(G).Media?(C(),F(He,{key:0,playlists:E.media?.playlists,onFilter:D},null,8,["playlists"])):E.type===u(G).Directory?(C(),F(He,{key:1,playlists:E.dir?.playlists,onFilter:D},null,8,["playlists"])):(C(),R(B,{key:2},[Q("   ")],64))]),"cell(commands)":O(({item:E})=>[E.media?.links?.self?(C(),R("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:We=>lt(E.media.links.self)},x(u($)("Edit")),9,yn)):(C(),R("button",{key:1,type:"button",class:"btn btn-sm btn-primary",onClick:We=>at(E.path)},x(u($)("Rename")),9,_n))]),_:1},8,["fields","provider"])]),_(js,{ref_key:"$newDirectoryModal",ref:Ae,"current-directory":p.value,"mkdir-url":u(a),onRelist:L},null,8,["current-directory","mkdir-url"]),_(ti,{ref_key:"$moveFilesModal",ref:Ie,"selected-items":m.value,"current-directory":p.value,"batch-url":u(n),"list-directories-url":u(r),onRelist:L},null,8,["selected-items","current-directory","batch-url","list-directories-url"]),_(si,{ref_key:"$renameModal",ref:Re,"rename-url":u(d),onRelist:L},null,8,["rename-url"]),_(Qi,{ref_key:"$editModal",ref:Le,"custom-fields":A.customFields,playlists:S.value,onRelist:L},null,8,["custom-fields","playlists"])],64)}}}),ko=z({__name:"MediaWrapper",setup(c){const e=J("/vue/files"),{axios:t}=ee(),{data:s,isLoading:i}=qe({queryKey:ke([xe.StationMedia,"props"]),queryFn:async({signal:n})=>{const{data:o}=await t.get(e.value,{signal:n});return o}});return(n,o)=>(C(),F(gt,{loading:u(i),lazy:""},{default:O(()=>[u(s)?(C(),F(wn,St(Dt({key:0},u(s))),null,16)):Z("",!0)]),_:1},8,["loading"]))}});export{ko as default};
