import{r as B,d as A,q as S,m as U,o as g,e as l,b as s,a as r,u as e,f as d,t as o,g as V,l as Y,s as Q,c as P,F as Z,i as F,h as ee,k as I,w as ae,v as se}from"./vue-BsfewpWM.js";import{_ as c}from"./FormGroupField-K9S4Sadl.js";import{_ as $}from"./FormFieldset-DUBDY7k3.js";import{_ as h}from"./FormGroupCheckbox-ZsJmXmB6.js";import{d as te,W as le,s as L,g as M,f as J,u as q}from"./layout-CUzOT8aY.js";import{_ as z,a as re}from"./Tabs-DMTPhsiO.js";import{_ as ie}from"./RadioWithCustomNumber-B3JRVqX_.js";import{u as X,r as N,e as oe}from"./regle-hGsoY2W9.js";import{u as O}from"./useFormTabClass-DgI07GN4.js";import{_ as ne}from"./FormMarkup-DqBjuQjX.js";import{u as de,_ as ce}from"./useHasModal-Bq3QxExQ.js";import{u as _e}from"./useResettableRef-BwkDrsai.js";import{g as E,a as me,Q as ue}from"./useStationQuery-ClAZEJp_.js";import{_ as G,x as pe,y as fe}from"./icons-BAjd3tML.js";import{_ as be}from"./StreamingLogModal-DW2-b89u.js";import{_ as W}from"./FormGroupMultiCheck-z3kTFzdV.js";import{m as ye}from"./mergeExisting-B6FvxI3v.js";import{_ as he}from"./Loading-CQdAiB8R.js";const D=te("form-admin-settings",()=>{const v=B({base_url:"",instance_name:"",prefer_browser_url:!0,use_radio_proxy:!0,history_keep_days:7,enable_static_nowplaying:!0,sync_disabled:!1,analytics:null,always_use_ssl:!1,ip_source:le.Local,api_access_control:"*",check_for_updates:!0,acme_email:"",acme_domains:"",mail_enabled:!1,mail_sender_name:"",mail_sender_email:"",mail_smtp_host:"",mail_smtp_port:0,mail_smtp_secure:!1,mail_smtp_username:"",mail_smtp_password:"",avatar_service:"gravatar",avatar_default_url:"",use_external_album_art_in_apis:!1,use_external_album_art_when_processing_media:!1,last_fm_api_key:""}),{r$:n}=X(v,{base_url:{required:N},history_keep_days:{required:N},analytics:{required:N}},{validationGroups:a=>({generalTab:[a.base_url,a.instance_name,a.prefer_browser_url,a.use_radio_proxy,a.history_keep_days,a.enable_static_nowplaying],securityPrivacyTab:[a.analytics,a.always_use_ssl,a.ip_source,a.api_access_control],servicesTab:[a.check_for_updates,a.acme_email,a.acme_domains,a.mail_enabled,a.mail_sender_name,a.mail_sender_email,a.mail_smtp_host,a.mail_smtp_port,a.mail_smtp_secure,a.mail_smtp_username,a.mail_smtp_password,a.avatar_service,a.avatar_default_url,a.use_external_album_art_in_apis,a.use_external_album_art_when_processing_media,a.last_fm_api_key],debuggingTab:[a.sync_disabled]})});return{form:v,r$:n,$reset:()=>{n.$reset({toOriginalState:!0})}}}),ge={class:"row g-3"},ve=A({__name:"GeneralTab",setup(v){const{r$:n}=L(D()),_=O(S(()=>n.value.$groups.generalTab)),{$gettext:a}=M(),i=S(()=>[{value:14,text:a("Last 14 Days")},{value:30,text:a("Last 30 Days")},{value:60,text:a("Last 60 Days")},{value:365,text:a("Last Year")},{value:730,text:a("Last 2 Years")},{value:0,text:a("Indefinitely")}]);return(m,t)=>(g(),U(z,{label:e(a)("Settings"),"item-header-class":e(_)},{default:l(()=>[s($,null,{default:l(()=>[r("div",ge,[s(c,{id:"edit_form_base_url",class:"col-md-6",field:e(n).base_url,"input-type":"url",label:e(a)("Site Base URL"),description:e(a)("The base URL where this service is located. Use either the external IP address or fully-qualified domain name (if one exists) pointing to this server.")},null,8,["field","label","description"]),s(c,{id:"edit_form_instance_name",class:"col-md-6",field:e(n).instance_name,label:e(a)("AzuraCast Instance Name"),description:e(a)("This name will appear as a sub-header next to the AzuraCast logo, to help identify this server.")},null,8,["field","label","description"]),s(h,{id:"edit_form_prefer_browser_url",class:"col-md-6",field:e(n).prefer_browser_url,label:e(a)("Prefer Browser URL (If Available)")},{description:l(()=>[d(o(e(a)(`If this setting is set to "Yes", the browser URL will be used instead of the base URL when it's available. Set to "No" to always use the base URL.`)),1)]),_:1},8,["field","label"]),s(h,{id:"edit_form_use_radio_proxy",class:"col-md-6",field:e(n).use_radio_proxy,label:e(a)("Use Web Proxy for Radio"),description:e(a)("By default, radio stations broadcast on their own ports (i.e. 8000). If you're using a service like CloudFlare or accessing your radio station by SSL, you should enable this feature, which routes all radio through the web ports (80 and 443).")},null,8,["field","label","description"]),s(c,{id:"edit_form_history_keep_days",class:"col-md-6",field:e(n).history_keep_days,label:e(a)("Days of Playback History to Keep"),description:e(a)("Set longer to preserve more playback history and listener metadata for stations. Set shorter to save disk space.")},{default:l(({id:u,model:w})=>[s(ie,{id:u,modelValue:w.$model,"onUpdate:modelValue":p=>w.$model=p,options:i.value},null,8,["id","modelValue","onUpdate:modelValue","options"])]),_:1},8,["field","label","description"]),s(h,{id:"edit_form_enable_static_nowplaying",class:"col-md-6",field:e(n).enable_static_nowplaying,label:e(a)("Use High-Performance Now Playing Updates"),description:e(a)("Uses either Websockets, Server-Sent Events (SSE) or static JSON files to serve Now Playing data on public pages. This improves performance, especially with large listener volume. Disable this if you are encountering problems with the service or use multiple URLs to serve your public pages.")},null,8,["field","label","description"])])]),_:1})]),_:1},8,["label","item-header-class"]))}}),we=A({__name:"TestMessageModal",setup(v,{expose:n}){const _=E("/admin/send-test-message"),{record:a,reset:i}=_e({emailAddress:""}),{r$:m}=X(a,{emailAddress:{required:N,email:oe}},{}),t=()=>{i(),m.$reset()},u=V("$modal"),{show:w,hide:p}=de(u),{notifySuccess:C}=J(),{axios:k}=q(),{$gettext:b}=M(),T=async()=>{const{valid:x}=await m.$validate();if(x)try{await k.post(_.value,{email:a.value.emailAddress}),C(b("Test message sent."))}finally{p()}};return n({open:w}),(x,y)=>(g(),U(ce,{id:"send_test_message",ref_key:"$modal",ref:u,centered:"",title:e(b)("Send Test Message"),onHidden:y[1]||(y[1]=R=>t())},{"modal-footer":l(()=>[r("button",{type:"button",class:"btn btn-secondary",onClick:y[0]||(y[0]=(...R)=>e(p)&&e(p)(...R))},o(e(b)("Close")),1),r("button",{type:"button",class:Q(["btn",e(m).$invalid?"btn-danger":"btn-primary"]),onClick:T},o(e(b)("Send Test Message")),3)]),default:l(()=>[r("form",{onSubmit:Y(T,["prevent"])},[s(c,{id:"email_address",field:e(m).emailAddress,autofocus:"",label:e(b)("E-mail Address")},null,8,["field","label"])],32)]),_:1},8,["title"]))}}),$e={class:"row g-3"},Se={href:"/docs/getting-started/updates/release-channels/",target:"_blank"},ke={class:"card-text font-weight-bold"},xe={class:"row g-3"},Ce={class:"form-group col"},Te=["disabled"],Ae={key:0},Pe={class:"row g-3"},Ue={key:0,class:"row g-3 mt-2"},Le={class:"form-group col"},Me=["disabled"],De={key:0},Re={class:"row g-3"},Ie={class:"row g-3"},Fe={href:"https://www.last.fm/api/account/create",target:"_blank"},Ne=A({__name:"ServicesTab",props:{releaseChannel:{}},setup(v){const n=v,_=E("/admin/acme"),{form:a,r$:i}=L(D()),m=O(S(()=>i.value.$groups.servicesTab)),{$gettext:t}=M(),u=S(()=>n.releaseChannel==="stable"?t("Stable"):t("Rolling Release")),w=S(()=>[{value:"libravatar",text:"Libravatar"},{value:"gravatar",text:"Gravatar"},{value:"disabled",text:t("Disabled")}]),p=V("$acmeModal"),{axios:C}=q(),k=async()=>{const{data:x}=await C.put(_.value);p.value?.show(x.logUrl)},b=V("$testMessageModal"),T=()=>{b.value?.open()};return(x,y)=>(g(),P(Z,null,[s(z,{label:e(t)("Services"),"item-header-class":e(m)},{default:l(()=>[s($,null,{label:l(()=>[d(o(e(t)("AzuraCast Update Checks")),1)]),default:l(()=>[r("div",$e,[s(ne,{id:"form_release_channel",class:"col-md-6",label:e(t)("Release Channel")},{description:l(()=>[r("a",Se,o(e(t)("Learn more about release channels in the AzuraCast docs.")),1)]),default:l(()=>[r("p",ke,o(u.value),1)]),_:1},8,["label"]),s(h,{id:"edit_form_check_for_updates",class:"col-md-6",field:e(i).check_for_updates,label:e(t)("Show Update Announcements"),description:e(t)("Show new releases within your update channel on the AzuraCast homepage.")},null,8,["field","label","description"])])]),_:1}),s($,null,{label:l(()=>[d(o(e(t)("LetsEncrypt")),1)]),description:l(()=>[d(o(e(t)("LetsEncrypt provides simple, free SSL certificates allowing you to secure traffic through your control panel and radio streams.")),1)]),default:l(()=>[r("div",xe,[s(c,{id:"edit_form_acme_domains",class:"col-md-6",field:e(i).acme_domains,label:e(t)("Domain Name(s)"),description:e(t)("All listed domain names should point to this AzuraCast installation. Separate multiple domain names with commas.")},null,8,["field","label","description"]),s(c,{id:"edit_form_acme_email",class:"col-md-6",field:e(i).acme_email,"input-type":"email",label:e(t)("E-mail Address (Optional)"),description:e(t)("Enter your e-mail address to receive updates about your certificate.")},null,8,["field","label","description"]),r("div",Ce,[r("button",{type:"button",class:"btn btn-primary btn-sm",disabled:e(i).$anyDirty,onClick:k},[s(G,{icon:e(pe)},null,8,["icon"]),r("span",null,[d(o(e(t)("Generate/Renew Certificate"))+" ",1),e(i).$anyDirty?(g(),P("span",Ae," ("+o(e(t)("Save Changes first"))+") ",1)):F("",!0)])],8,Te)])])]),_:1}),s($,null,{label:l(()=>[d(o(e(t)("E-mail Delivery Service")),1)]),description:l(()=>[d(o(e(t)('Used for "Forgot Password" functionality, web hooks and other functions.')),1)]),default:l(()=>[r("div",Pe,[s(h,{id:"edit_form_mail_enabled",class:"col-md-12",field:e(i).mail_enabled,label:e(t)("Enable Mail Delivery")},null,8,["field","label"])]),e(a).mail_enabled?(g(),P("div",Ue,[s(c,{id:"edit_form_mail_sender_name",class:"col-md-6",field:e(i).mail_sender_name,label:e(t)("Sender Name")},null,8,["field","label"]),s(c,{id:"edit_form_mail_sender_email",class:"col-md-6",field:e(i).mail_sender_email,"input-type":"email",label:e(t)("Sender E-mail Address")},null,8,["field","label"]),s(c,{id:"edit_form_mail_smtp_host",class:"col-md-4",field:e(i).mail_smtp_host,label:e(t)("SMTP Host")},null,8,["field","label"]),s(c,{id:"edit_form_mail_smtp_port",class:"col-md-3",field:e(i).mail_smtp_port,"input-type":"number",label:e(t)("SMTP Port")},null,8,["field","label"]),s(h,{id:"edit_form_mail_smtp_secure",class:"col-md-5",field:e(i).mail_smtp_secure,label:e(t)("Use Secure (TLS) SMTP Connection"),description:e(t)("Usually enabled for port 465, disabled for ports 587 or 25.")},null,8,["field","label","description"]),s(c,{id:"edit_form_mail_smtp_username",class:"col-md-6",field:e(i).mail_smtp_username,label:e(t)("SMTP Username")},null,8,["field","label"]),s(c,{id:"edit_form_mail_smtp_password",class:"col-md-6",field:e(i).mail_smtp_password,"input-type":"password",label:e(t)("SMTP Password")},null,8,["field","label"]),r("div",Le,[r("button",{type:"button",class:"btn btn-sm btn-primary",disabled:e(i).$anyDirty,onClick:T},[s(G,{icon:e(fe)},null,8,["icon"]),r("span",null,[d(o(e(t)("Send Test Message"))+" ",1),e(i).$anyDirty?(g(),P("span",De," ("+o(e(t)("Save Changes first"))+") ",1)):F("",!0)])],8,Me)])])):F("",!0)]),_:1}),s($,null,{label:l(()=>[d(o(e(t)("Avatar Service")),1)]),default:l(()=>[r("div",Re,[s(W,{id:"edit_form_avatar_service",class:"col-md-6",field:e(i).avatar_service,options:w.value,stacked:"",radio:"",label:e(t)("Avatar Service")},null,8,["field","options","label"]),s(c,{id:"edit_form_avatar_default_url",class:"col-md-6",field:e(i).avatar_default_url,label:e(t)("Default Avatar URL")},null,8,["field","label"])])]),_:1}),s($,null,{label:l(()=>[d(o(e(t)("Album Art")),1)]),default:l(()=>[r("div",Ie,[s(h,{id:"use_external_album_art_in_apis",class:"col-md-6",field:e(i).use_external_album_art_in_apis},{label:l(()=>[d(o(e(t)('Check Web Services for Album Art for "Now Playing" Tracks')),1)]),_:1},8,["field"]),s(h,{id:"use_external_album_art_when_processing_media",class:"col-md-6",field:e(i).use_external_album_art_when_processing_media,label:e(t)("Check Web Services for Album Art When Uploading Media")},null,8,["field","label"]),s(c,{id:"edit_form_last_fm_api_key",class:"col-md-12",field:e(i).last_fm_api_key,label:e(t)("Last.fm API Key")},{description:l(()=>[d(o(e(t)("This service can provide album art for tracks where none is available locally."))+" ",1),y[0]||(y[0]=r("br",null,null,-1)),r("a",Fe,o(e(t)("Apply for an API key at Last.fm")),1)]),_:1},8,["field","label"])])]),_:1})]),_:1},8,["label","item-header-class"]),s(be,{ref_key:"$acmeModal",ref:p},null,512),s(we,{ref_key:"$testMessageModal",ref:b},null,512)],64))}}),Ee={class:"row g-3"},ze={class:"row g-3"},Oe={href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin",target:"_blank"},He=A({__name:"SecurityPrivacyTab",setup(v){const{r$:n}=L(D()),_=O(S(()=>n.value.$groups.securityPrivacyTab)),{$gettext:a}=M(),i=S(()=>[{value:"all",text:a("Full"),description:a("Collect aggregate listener statistics and IP-based listener statistics")},{value:"no_ip",text:a("Limited"),description:a("Only collect aggregate listener statistics")},{value:"none",text:a("None"),description:a("Do not collect any listener analytics")}]),m=S(()=>[{value:"local",text:a("Local IP (Default)")},{value:"cloudflare",text:a("CloudFlare (CF-Connecting-IP)")},{value:"xff",text:a("Reverse Proxy (X-Forwarded-For)")}]);return(t,u)=>(g(),U(z,{label:e(a)("Security & Privacy"),"item-header-class":e(_)},{default:l(()=>[s($,null,{label:l(()=>[d(o(e(a)("Privacy")),1)]),default:l(()=>[r("div",Ee,[s(W,{id:"edit_form_analytics",class:"col-md-12",field:e(n).analytics,options:i.value,radio:"",stacked:"",label:e(a)("Listener Analytics Collection"),description:e(a)("Aggregate listener statistics are used to show station reports across the system. IP-based listener statistics are used to view live listener tracking and may be required for royalty reports.")},null,8,["field","options","label","description"])])]),_:1}),s($,null,{label:l(()=>[d(o(e(a)("Security")),1)]),default:l(()=>[r("div",ze,[s(h,{id:"edit_form_always_use_ssl",class:"col-md-12",field:e(n).always_use_ssl,label:e(a)("Always Use HTTPS")},{description:l(()=>[d(o(e(a)('Set to "Yes" to always use "https://" secure URLs, and to automatically redirect to the secure URL when an insecure URL is visited (HSTS).')),1)]),_:1},8,["field","label"]),s(W,{id:"edit_form_ip_source",class:"col-md-6",field:e(n).ip_source,options:m.value,stacked:"",radio:"",label:e(a)("IP Address Source"),description:e(a)("Customize this setting to ensure you get the correct IP address for remote users. Only change this setting if you use a reverse proxy, either within Docker or a third-party service like CloudFlare.")},null,8,["field","options","label","description"]),s(c,{id:"edit_form_api_access_control",class:"col-md-6",field:e(n).api_access_control},{label:l(()=>[d(o(e(a)('API "Access-Control-Allow-Origin" Header')),1)]),description:l(()=>[d(o(e(a)("Set to * to allow all sources, or specify a list of origins separated by a comma (,)."))+" ",1),u[0]||(u[0]=r("br",null,null,-1)),r("a",Oe,o(e(a)("Learn more about this header.")),1)]),_:1},8,["field"])])]),_:1})]),_:1},8,["label","item-header-class"]))}}),Be={class:"row g-3"},Ve=A({__name:"DebuggingTab",setup(v){const{r$:n}=L(D()),_=O(S(()=>n.value.$groups.debuggingTab));return(a,i)=>(g(),U(z,{label:a.$gettext("Debugging"),"item-header-class":e(_)},{default:l(()=>[s($,null,{default:l(()=>[r("div",Be,[s(h,{id:"edit_form_sync_disabled",class:"col-md-6",field:e(n).sync_disabled,label:a.$gettext("Temporarily Disable Synchronization Tasks"),description:a.$gettext("Prevents background tasks from automatically running. Tasks are disabled automatically when restoring a backup to allow media to be re-uploaded."),advanced:""},null,8,["field","label","description"])])]),_:1})]),_:1},8,["label","item-header-class"]))}}),We={class:"card",role:"region","aria-labelledby":"hdr_system_settings"},qe={class:"card-header text-bg-primary"},Ke={id:"hdr_system_settings",class:"card-title"},Ge={class:"card-body"},Ye={class:"card-body"},ua=A({inheritAttrs:!1,__name:"Settings",emits:["saved"],setup(v,{emit:n}){const _=n,a=E("/admin/settings/general"),i=E("/admin/vue/settings"),m=D(),{form:t,r$:u}=L(m),{$reset:w}=m,p=B(!0),C=B(null),{axios:k}=q(),{data:b,isLoading:T}=me({queryKey:[ue.AdminSettings,"props"],queryFn:async({signal:f})=>{const{data:K}=await k.get(i.value,{signal:f});return K},placeholderData:()=>({releaseChannel:"rolling"})}),x=f=>{w(),t.value=ye(t.value,f)},y=async()=>{w(),p.value=!0;const{data:f}=await k.get(a.value);x(f),p.value=!1};ee(y);const{notifySuccess:R}=J(),{$gettext:H}=M(),j=async()=>{const{valid:f}=await u.value.$validate();f&&(await k({method:"PUT",url:a.value,data:t.value}),_("saved"),R(H("Changes saved.")),await y())};return(f,K)=>(g(),P("form",{class:"form vue-form",onSubmit:Y(j,["prevent"])},[I(f.$slots,"preCard"),r("section",We,[r("div",qe,[r("h2",Ke,[I(f.$slots,"cardTitle",{},()=>[d(o(e(H)("System Settings")),1)])])]),I(f.$slots,"cardUpper"),ae(r("div",{class:"alert alert-danger"},o(C.value),513),[[se,C.value!=null]]),r("div",Ge,[s(he,{loading:p.value||e(T),lazy:""},{default:l(()=>[e(b)?(g(),U(re,{key:0,"content-class":"mt-3"},{default:l(()=>[s(ve),s(He),s(Ne,{"release-channel":e(b).releaseChannel},null,8,["release-channel"]),s(Ve)]),_:1})):F("",!0)]),_:1},8,["loading"])]),r("div",Ye,[r("button",{type:"submit",class:Q(["btn btn-lg",e(u).$invalid?"btn-danger":"btn-primary"])},[I(f.$slots,"submitButtonName",{},()=>[d(o(e(H)("Save Changes")),1)])],2)])])],32))}});export{ua as _};
