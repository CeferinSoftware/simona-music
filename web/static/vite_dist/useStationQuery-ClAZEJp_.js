import{p as Q,q as B,t as d,v as E,w as A,x as Y,y as _,z as G,A as X,B as U,C as Z,D as K,E as W,F as tt,H as et,I as st,J as z,K as H,L as it,M as nt,u as at}from"./layout-CUzOT8aY.js";import{V as ot,R as rt,q as O,Q as lt,x as ut,B as x,Y as ht,_ as ct,W as dt,a0 as ft,$ as k}from"./vue-BsfewpWM.js";import{u as pt}from"./vue-router-Cafqdr3I.js";var mt=class extends Q{constructor(t,e){super(),this.options=e,this.#s=t,this.#n=null,this.#i=B(),this.bindMethods(),this.setOptions(e)}#s;#t=void 0;#p=void 0;#e=void 0;#o;#h;#i;#n;#m;#c;#d;#r;#l;#a;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),N(this.#t,this.options)?this.#u():this.updateResult(),this.#R())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return F(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return F(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#g(),this.#A(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,s=this.#t;if(this.options=this.#s.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof d(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#O(),this.#t.setOptions(this.options),e._defaulted&&!E(this.options,e)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&$(this.#t,s,this.options,e)&&this.#u(),this.updateResult(),i&&(this.#t!==s||d(this.options.enabled,this.#t)!==d(e.enabled,this.#t)||A(this.options.staleTime,this.#t)!==A(e.staleTime,this.#t))&&this.#b();const n=this.#S();i&&(this.#t!==s||d(this.options.enabled,this.#t)!==d(e.enabled,this.#t)||n!==this.#a)&&this.#v(n)}getOptimisticResult(t){const e=this.#s.getQueryCache().build(this.#s,t),s=this.createResult(e,t);return St(this,s)&&(this.#e=s,this.#h=this.options,this.#o=this.#t.state),s}getCurrentResult(){return this.#e}trackResult(t,e){return new Proxy(t,{get:(s,i)=>(this.trackProp(i),e?.(i),i==="promise"&&!this.options.experimental_prefetchInRender&&this.#i.status==="pending"&&this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(s,i))})}trackProp(t){this.#f.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#s.defaultQueryOptions(t),s=this.#s.getQueryCache().build(this.#s,e);return s.fetch().then(()=>this.createResult(s,e))}fetch(t){return this.#u({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#e))}#u(t){this.#O();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(Y)),e}#b(){this.#g();const t=A(this.options.staleTime,this.#t);if(_||this.#e.isStale||!G(t))return;const s=X(this.#e.dataUpdatedAt,t)+1;this.#r=U.setTimeout(()=>{this.#e.isStale||this.updateResult()},s)}#S(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(t){this.#A(),this.#a=t,!(_||d(this.options.enabled,this.#t)===!1||!G(this.#a)||this.#a===0)&&(this.#l=U.setInterval(()=>{(this.options.refetchIntervalInBackground||Z.isFocused())&&this.#u()},this.#a))}#R(){this.#b(),this.#v(this.#S())}#g(){this.#r&&(U.clearTimeout(this.#r),this.#r=void 0)}#A(){this.#l&&(U.clearInterval(this.#l),this.#l=void 0)}createResult(t,e){const s=this.#t,i=this.options,n=this.#e,l=this.#o,u=this.#h,b=t!==s?t.state:this.#p,{state:w}=t;let r={...w},P=!1,o;if(e._optimisticResults){const h=this.hasListeners(),I=!h&&N(t,e),R=h&&$(t,s,e,i);(I||R)&&(r={...r,...K(w.data,t.options)}),e._optimisticResults==="isRestoring"&&(r.fetchStatus="idle")}let{error:a,errorUpdatedAt:p,status:c}=r;o=r.data;let g=!1;if(e.placeholderData!==void 0&&o===void 0&&c==="pending"){let h;n?.isPlaceholderData&&e.placeholderData===u?.placeholderData?(h=n.data,g=!0):h=typeof e.placeholderData=="function"?e.placeholderData(this.#d?.state.data,this.#d):e.placeholderData,h!==void 0&&(c="success",o=W(n?.data,h,e),P=!0)}if(e.select&&o!==void 0&&!g)if(n&&o===l?.data&&e.select===this.#m)o=this.#c;else try{this.#m=e.select,o=e.select(o),o=W(n?.data,o,e),this.#c=o,this.#n=null}catch(h){this.#n=h}this.#n&&(a=this.#n,o=this.#c,p=Date.now(),c="error");const S=r.fetchStatus==="fetching",v=c==="pending",T=c==="error",q=v&&S,V=o!==void 0,f={status:c,fetchStatus:r.fetchStatus,isPending:v,isSuccess:c==="success",isError:T,isInitialLoading:q,isLoading:q,data:o,dataUpdatedAt:r.dataUpdatedAt,error:a,errorUpdatedAt:p,failureCount:r.fetchFailureCount,failureReason:r.fetchFailureReason,errorUpdateCount:r.errorUpdateCount,isFetched:r.dataUpdateCount>0||r.errorUpdateCount>0,isFetchedAfterMount:r.dataUpdateCount>b.dataUpdateCount||r.errorUpdateCount>b.errorUpdateCount,isFetching:S,isRefetching:S&&!v,isLoadingError:T&&!V,isPaused:r.fetchStatus==="paused",isPlaceholderData:P,isRefetchError:T&&V,isStale:y(t,e),refetch:this.refetch,promise:this.#i,isEnabled:d(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const h=D=>{f.status==="error"?D.reject(f.error):f.data!==void 0&&D.resolve(f.data)},I=()=>{const D=this.#i=f.promise=B();h(D)},R=this.#i;switch(R.status){case"pending":t.queryHash===s.queryHash&&h(R);break;case"fulfilled":(f.status==="error"||f.data!==R.value)&&I();break;case"rejected":(f.status!=="error"||f.error!==R.reason)&&I();break}}return f}updateResult(){const t=this.#e,e=this.createResult(this.#t,this.options);if(this.#o=this.#t.state,this.#h=this.options,this.#o.data!==void 0&&(this.#d=this.#t),E(e,t))return;this.#e=e;const s=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,n=typeof i=="function"?i():i;if(n==="all"||!n&&!this.#f.size)return!0;const l=new Set(n??this.#f);return this.options.throwOnError&&l.add("error"),Object.keys(this.#e).some(u=>{const m=u;return this.#e[m]!==t[m]&&l.has(m)})};this.#C({listeners:s()})}#O(){const t=this.#s.getQueryCache().build(this.#s,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#p=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#R()}#C(t){tt.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#e)}),this.#s.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function bt(t,e){return d(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function N(t,e){return bt(t,e)||t.state.data!==void 0&&F(t,e,e.refetchOnMount)}function F(t,e,s){if(d(e.enabled,t)!==!1&&A(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&y(t,e)}return!1}function $(t,e,s,i){return(t!==e||d(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&y(t,s)}function y(t,e){return d(e.enabled,t)!==!1&&t.isStaleByTime(A(e.staleTime,t))}function St(t,e){return!E(t.getCurrentResult(),e)}function L(t=""){if(!ot())throw new Error("vue-query hooks can only be used inside setup() function or functions that support injection context.");const e=et(t),s=rt(e);if(!s)throw new Error("No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.");return s}function vt(t,e,s){const i=L(),n=O(()=>{const a=st(e);typeof a.enabled=="function"&&(a.enabled=a.enabled());const p=i.defaultQueryOptions(a);return p._optimisticResults=i.isRestoring?.value?"isRestoring":"optimistic",p}),l=new t(i,n.value),u=n.value.shallow?lt(l.getCurrentResult()):ut(l.getCurrentResult());let m=()=>{};i.isRestoring&&x(i.isRestoring,a=>{a||(m(),m=l.subscribe(p=>{H(u,p)}))},{immediate:!0});const b=()=>{l.setOptions(n.value),H(u,l.getCurrentResult())};x(n,b),ht(()=>{m()});const w=(...a)=>(b(),u.refetch(...a)),r=()=>new Promise((a,p)=>{let c=()=>{};const g=()=>{if(n.value.enabled!==!1){l.setOptions(n.value);const S=l.getOptimisticResult(n.value);S.isStale?(c(),l.fetchOptimistic(n.value).then(a,v=>{z(n.value.throwOnError,[v,l.getCurrentQuery()])?p(v):a(l.getCurrentResult())})):(c(),a(S))}};g(),c=x(n,g)});x(()=>u.error,a=>{if(u.isError&&!u.isFetching&&z(n.value.throwOnError,[a,l.getCurrentQuery()]))throw a});const P=n.value.shallow?ct(u):dt(u),o=ft(P);for(const a in u)typeof u[a]=="function"&&(o[a]=u[a]);return o.suspense=r,o.refetch=w,o}function Rt(t,e){return vt(mt,t)}var M=(t=>(t.Dashboard="Dashboard",t.StationGroup="Station",t.StationGlobals="StationGlobals",t.StationHlsStreams="StationHlsStreams",t.StationLogs="StationLogs",t.StationMedia="StationMedia",t.StationMounts="StationMounts",t.StationPlaylists="StationPlaylists",t.StationPodcasts="StationPodcasts",t.StationProfile="StationProfile",t.StationQueue="StationQueue",t.StationRemotes="StationRemotes",t.StationReports="StationReports",t.StationSftpUsers="StationSftpUsers",t.StationStreamers="StationStreamers",t.StationWebhooks="StationWebhooks",t.AccountApiKeys="AccountApiKeys",t.AccountIndex="AccountIndex",t.AccountPasskeys="AccountPasskeys",t.PublicOnDemand="PublicOnDemand",t.PublicPodcasts="PublicPodcasts",t.PublicRequests="PublicRequests",t.AdminApiKeys="AdminApiKeys",t.AdminAuditLog="AdminAuditLog",t.AdminBackups="AdminBackups",t.AdminCustomFields="AdminCustomFields",t.AdminDebug="AdminDebug",t.AdminIndex="AdminIndex",t.AdminPermissions="AdminPermissions",t.AdminRelays="AdminRelays",t.AdminSettings="AdminSettings",t.AdminStations="AdminStations",t.AdminStorageLocations="AdminStorageLocations",t.AdminUpdates="AdminUpdates",t.AdminUsers="AdminUsers",t))(M||{});const j=(t,e)=>{e??=C();const s=["Station",{station:e}];return s.push({station:e}),t&&s.push(...t),s};function gt(t){return O(()=>`/api${k(t)}`)}function At(t,e){return e||(e=C()),gt(O(()=>{const s=k(e);if(s===null)throw new Error("Can't find station ID!");const i=k(t);return`/station/${s}${i}`}))}const C=()=>{const{params:t}=pt();return O(()=>Number(t.station_id)??null)},J={id:0,name:null,shortName:"loading",description:"",isEnabled:!1,hasStarted:!1,needsRestart:!1,timezone:"UTC",offlineText:null,maxBitrate:0,maxMounts:0,maxHlsStreams:0,enablePublicPages:!0,publicPageUrl:"",enableOnDemand:!1,onDemandUrl:"",enableStreamers:!1,webDjUrl:"",enableRequests:!1,features:{media:!1,sftp:!1,podcasts:!1,streamers:!1,webhooks:!1,requests:!1,mountPoints:!1,hlsStreams:!1,remoteRelays:!1,customLiquidsoapConfig:!1,autoDjQueue:!1},ipGeoAttribution:"N/A",backendType:nt.None,frontendType:it.Remote,canReload:!1,useManualAutoDj:!1},Ot=()=>{const{axios:t}=at(),e=C(),s=At("/dashboard",e);return Rt({queryKey:j([M.StationGlobals],e),queryFn:async({signal:i})=>{const{data:n}=await t.get(s.value,{signal:i});return n},staleTime:600*1e3,placeholderData:J})},Dt=()=>{const{data:t}=Ot();return O(()=>t.value??J)},Ut=()=>{const t=L(),e=C();return async()=>{await t.invalidateQueries({queryKey:j([M.StationGlobals],e)})}},xt=()=>{const t=L(),e=C();return async()=>{await t.invalidateQueries({queryKey:j([],e)})}};export{M as Q,Rt as a,L as b,Dt as c,Ot as d,At as e,Ut as f,gt as g,xt as h,j as q,C as u};
