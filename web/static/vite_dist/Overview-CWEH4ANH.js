import{_ as le}from"./DateRangeDropdown-7SFZkkqA.js";import{d as T,g as I,c as v,o as n,k as q,m as $,i as k,K as V,r as E,q as P,F as L,a as e,b as d,w as N,am as Q,t as s,u as a,e as m,D as x,f as h,B as X}from"./vue-BsfewpWM.js";import{u as Y,a as Z,_ as ne}from"./TimeSeriesChart-DO6pjMtG.js";import{g as J,u as K,am as ee,h as oe,a as re,an as ie,ab as de}from"./layout-CUzOT8aY.js";import{_ as O}from"./Loading-CQdAiB8R.js";import{u as W}from"./luxon-m3VuE4xT.js";import{a as F,q as z,Q as H,e as R,c as ue}from"./useStationQuery-ClAZEJp_.js";import{_ as G,am as ce,al as pe}from"./icons-BAjd3tML.js";import{u as te,_ as ae}from"./DataTable-BhAO7RbG.js";import{u as se}from"./useClientItemProvider-Ds0yxtsG.js";import{_ as U,a as me}from"./Tabs-DMTPhsiO.js";import{u as _e}from"./useStationDateTimeFormatter-CkmvkIuo.js";import"./theme-BQjAlSn5.js";import"./estoolkit-DCzBkaPJ.js";import"./leaflet-DkUWBo0d.js";import"./forEach-BFcv9GyE.js";import"./isArrayLike-DknTMkCU.js";import"./luxon-F75Z0klY.js";import"./defaultsDeep-B9v54JJt.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./vue-router-Cafqdr3I.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";const be=T({__name:"HourChart",props:{options:{},data:{},aspectRatio:{},alt:{},labels:{}},setup(g){const t=g,l=I("$canvas"),{$gettext:f}=J();return Y(t,l,{type:"bar",options:{scales:{x:{title:{display:!0,text:f("Hour")}},y:{title:{display:!0,text:f("Listeners")},min:0}}}}),(u,_)=>(n(),v("canvas",{ref_key:"$canvas",ref:l},[q(u.$slots,"default",{},()=>[u.alt&&u.alt.length>0?(n(),$(Z,{key:0,alt:u.alt},null,8,["alt"])):k("",!0)])],512))}}),A=T({__name:"PieChart",props:{options:{},data:{},aspectRatio:{},alt:{},labels:{}},setup(g){const t=g,l=I("$canvas");return Y(t,l,{type:"pie"}),(f,u)=>(n(),v("canvas",{ref_key:"$canvas",ref:l},[q(f.$slots,"default",{},()=>[f.alt&&f.alt.length>0?(n(),$(Z,{key:0,alt:f.alt},null,8,["alt"])):k("",!0)])],512))}}),ye={class:"buttons mb-3"},ge={class:"btn btn-sm btn-outline-secondary",for:"result-type-average"},fe={class:"btn btn-sm btn-outline-secondary",for:"result-type-unique"},ve={class:"row"},$e={class:"col-md-6 mb-4"},he={class:"col-md-6 mb-4"},Te={class:"col-md-12 mb-4"},ke={class:"buttons mb-3"},Se=["id","value"],we=["for"],De=T({__name:"ListenersByTimePeriodTab",props:{dateRange:{},apiUrl:{}},setup(g){const t=g,l=V(t,"dateRange"),{axios:f}=K(),{DateTime:u}=W(),_=E("average"),b={labels:[],metrics:[],alt:[]},{data:r,isLoading:o}=F({queryKey:z([H.StationReports,"listeners_by_time_period",_,l]),queryFn:async({signal:D})=>{const{data:c}=await f.get(t.apiUrl,{signal:D,params:{type:_.value,start:u.fromJSDate(l.value.startDate).toISO(),end:u.fromJSDate(l.value.endDate).toISO()}});return c},placeholderData:()=>({daily:{...b},day_of_week:{...b},hourly:{all:{...b},day0:{...b},day1:{...b},day2:{...b},day3:{...b},day4:{...b},day5:{...b},day6:{...b}}})}),i=E("all"),{$gettext:y}=J(),C=P(()=>({all:y("All Days"),day0:y("Monday"),day1:y("Tuesday"),day2:y("Wednesday"),day3:y("Thursday"),day4:y("Friday"),day5:y("Saturday"),day6:y("Sunday")})),S=P(()=>r.value?.hourly[i.value]);return(D,c)=>(n(),v(L,null,[e("div",ye,[N(e("input",{id:"result-type-average","onUpdate:modelValue":c[0]||(c[0]=p=>_.value=p),type:"radio",class:"btn-check",autocomplete:"off",value:"average"},null,512),[[Q,_.value]]),e("label",ge,s(a(y)("Average Listeners")),1),N(e("input",{id:"result-type-unique","onUpdate:modelValue":c[1]||(c[1]=p=>_.value=p),type:"radio",class:"btn-check",autocomplete:"off",value:"unique"},null,512),[[Q,_.value]]),e("label",fe,s(a(y)("Unique Listeners")),1)]),d(O,{loading:a(o),lazy:""},{default:m(()=>[e("div",ve,[e("div",$e,[e("fieldset",null,[e("legend",null,s(a(y)("Listeners by Day")),1),d(ne,{style:{width:"100%"},data:a(r).daily.metrics,alt:a(r).daily.alt},null,8,["data","alt"])])]),e("div",he,[e("fieldset",null,[e("legend",null,s(a(y)("Listeners by Day of Week")),1),d(A,{style:{width:"100%"},data:a(r).day_of_week.metrics,labels:a(r).day_of_week.labels,alt:a(r).day_of_week.alt},null,8,["data","labels","alt"])])]),e("div",Te,[e("fieldset",null,[e("legend",null,s(a(y)("Listeners by Hour")),1),e("div",ke,[(n(!0),v(L,null,x(C.value,(p,w)=>(n(),v(L,{key:w},[N(e("input",{id:`charts-hour-${w}`,"onUpdate:modelValue":c[2]||(c[2]=B=>i.value=B),type:"radio",class:"btn-check",autocomplete:"off",value:w},null,8,Se),[[Q,i.value]]),e("label",{class:"btn btn-sm btn-outline-secondary",for:`charts-hour-${w}`},s(p),9,we)],64))),128))]),d(be,{style:{width:"100%"},data:S.value.metrics,labels:S.value.labels,alt:S.value.alt,"aspect-ratio":3},null,8,["data","labels","alt"])])])])]),_:1},8,["loading"])],64))}}),Ce={key:0},Re={key:1},j=T({__name:"SongText",props:{song:{}},setup(g){return(t,l)=>t.song.title!==""?(n(),v("span",Ce,[e("b",null,s(t.song.title),1),l[0]||(l[0]=e("br",null,null,-1)),h(" "+s(t.song.artist),1)])):(n(),v("span",Re,s(t.song.text),1))}}),Ue={class:"row"},Le={class:"col-md-6 mb-4"},Be={class:"table table-striped table-condensed table-nopadding"},xe={key:0},qe={class:"text-center text-success"},Pe={class:"col-md-6 mb-4"},Ae={class:"table table-striped table-condensed table-nopadding"},Ie={key:0},Ve={class:"text-center text-danger"},Je={class:"col-md-12 mb-4"},Ke={class:"table table-striped table-condensed table-nopadding"},Oe={key:0},We={class:"text-center"},Fe=T({__name:"BestAndWorstTab",props:{dateRange:{},apiUrl:{}},setup(g){const t=g,l=V(t,"dateRange"),{axios:f}=K(),{DateTime:u}=W(),{data:_,isLoading:b}=F({queryKey:z([H.StationReports,"best_and_worst",l]),queryFn:async({signal:r})=>{const{data:o}=await f.get(t.apiUrl,{signal:r,params:{start:u.fromJSDate(l.value.startDate).toISO(),end:u.fromJSDate(l.value.endDate).toISO()}});return o},placeholderData:()=>({bestAndWorst:{best:[],worst:[]},mostPlayed:[]})});return(r,o)=>(n(),$(O,{loading:a(b),lazy:""},{default:m(()=>[e("div",Ue,[e("div",Le,[e("fieldset",null,[e("legend",null,s(r.$gettext("Best Performing Songs")),1),e("table",Be,[o[1]||(o[1]=e("colgroup",null,[e("col",{width:"20%"}),e("col",{width:"80%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(r.$gettext("Change")),1),e("th",null,s(r.$gettext("Song")),1)])]),a(_)?(n(),v("tbody",xe,[(n(!0),v(L,null,x(a(_).bestAndWorst.best,i=>(n(),v("tr",{key:i.song.id},[e("td",qe,[d(G,{icon:a(ce)},null,8,["icon"]),h(" "+s(i.stat_delta)+" ",1),o[0]||(o[0]=e("br",null,null,-1)),e("small",null,s(i.stat_start)+" to "+s(i.stat_end),1)]),e("td",null,[d(j,{song:i.song},null,8,["song"])])]))),128))])):k("",!0)])])]),e("div",Pe,[e("fieldset",null,[e("legend",null,s(r.$gettext("Worst Performing Songs")),1),e("table",Ae,[o[3]||(o[3]=e("colgroup",null,[e("col",{width:"20%"}),e("col",{width:"80%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(r.$gettext("Change")),1),e("th",null,s(r.$gettext("Song")),1)])]),a(_)?(n(),v("tbody",Ie,[(n(!0),v(L,null,x(a(_).bestAndWorst.worst,i=>(n(),v("tr",{key:i.song.id},[e("td",Ve,[d(G,{icon:a(pe)},null,8,["icon"]),h(" "+s(i.stat_delta)+" ",1),o[2]||(o[2]=e("br",null,null,-1)),e("small",null,s(i.stat_start)+" to "+s(i.stat_end),1)]),e("td",null,[d(j,{song:i.song},null,8,["song"])])]))),128))])):k("",!0)])])]),e("div",Je,[e("fieldset",null,[e("legend",null,s(r.$gettext("Most Played Songs")),1),e("table",Ke,[o[4]||(o[4]=e("colgroup",null,[e("col",{width:"10%"}),e("col",{width:"90%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(r.$gettext("Plays")),1),e("th",null,s(r.$gettext("Song")),1)])]),a(_)?(n(),v("tbody",Oe,[(n(!0),v(L,null,x(a(_).mostPlayed,i=>(n(),v("tr",{key:i.song.id},[e("td",We,s(i.num_plays),1),e("td",null,[d(j,{song:i.song},null,8,["song"])])]))),128))])):k("",!0)])])])])]),_:1},8,["loading"]))}}),ze={class:"row"},He={class:"col-md-6 mb-4"},Me={class:"col-md-6 mb-4"},M=T({__name:"CommonMetricsView",props:{dateRange:{},apiUrl:{},fieldKey:{},fieldLabel:{}},setup(g){const t=g,{$gettext:l}=J(),f=[{key:t.fieldKey,label:t.fieldLabel,sortable:!0},{key:"listeners",label:l("Listeners"),sortable:!0},{key:"connected_seconds_calc",label:l("Time"),sortable:!1},{key:"connected_seconds",label:l("Time (sec)"),sortable:!0}],u=V(t,"dateRange"),{axios:_}=K(),{DateTime:b}=W(),r=F({queryKey:z([H.StationReports,"common_metrics",u]),queryFn:async({signal:p})=>{const{data:w}=await _.get(t.apiUrl,{signal:p,params:{start:b.fromJSDate(u.value.startDate).toISO(),end:b.fromJSDate(u.value.endDate).toISO()}});return w},placeholderData:()=>({all:[],top_listeners:{labels:[],datasets:[],alt:[]},top_connected_time:{labels:[],datasets:[],alt:[]}})}),{data:o,isLoading:i,refetch:y}=r,C=se(P(()=>o.value?.all??[]),i,void 0,async()=>{await y()}),S=I("$dataTable"),{navigate:D}=te(S),c=ee();return X(u,()=>{c.value&&D()}),(p,w)=>(n(),$(O,{loading:a(i),lazy:""},{default:m(()=>[e("div",ze,[e("div",He,[e("fieldset",null,[e("legend",null,[q(p.$slots,"by_listeners_legend")]),a(o)?(n(),$(A,{key:0,style:{width:"100%"},data:a(o).top_listeners.datasets,labels:a(o).top_listeners.labels,alt:a(o).top_listeners.alt},null,8,["data","labels","alt"])):k("",!0)])]),e("div",Me,[e("fieldset",null,[e("legend",null,[q(p.$slots,"by_connected_time_legend")]),a(o)?(n(),$(A,{key:0,style:{width:"100%"},data:a(o).top_connected_time.datasets,labels:a(o).top_connected_time.labels,alt:a(o).top_connected_time.alt},null,8,["data","labels","alt"])):k("",!0)])])]),d(ae,{id:p.fieldKey+"_table",ref_key:"$dataTable",ref:S,paginated:"",fields:f,provider:a(C)},{"cell(connected_seconds_calc)":m(B=>[h(s(a(oe)(B.item.connected_seconds)),1)]),_:1},8,["id","provider"])]),_:3},8,["loading"]))}}),Ne=T({__name:"BrowsersTab",props:{dateRange:{},apiUrl:{}},setup(g){return(t,l)=>(n(),$(M,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"browser","field-label":t.$gettext("Browser")},{by_listeners_legend:m(()=>[h(s(t.$gettext("Top Browsers by Listeners")),1)]),by_connected_time_legend:m(()=>[h(s(t.$gettext("Top Browsers by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),Qe=T({__name:"CountriesTab",props:{dateRange:{},apiUrl:{}},setup(g){return(t,l)=>(n(),$(M,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"country","field-label":t.$gettext("Country")},{by_listeners_legend:m(()=>[h(s(t.$gettext("Top Countries by Listeners")),1)]),by_connected_time_legend:m(()=>[h(s(t.$gettext("Top Countries by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),je=T({__name:"StreamsTab",props:{dateRange:{},apiUrl:{}},setup(g){return(t,l)=>(n(),$(M,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"stream","field-label":t.$gettext("Stream")},{by_listeners_legend:m(()=>[h(s(t.$gettext("Top Streams by Listeners")),1)]),by_connected_time_legend:m(()=>[h(s(t.$gettext("Top Streams by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),Ee=T({__name:"ClientsTab",props:{dateRange:{},apiUrl:{}},setup(g){return(t,l)=>(n(),$(M,{"date-range":t.dateRange,"api-url":t.apiUrl,"field-key":"client","field-label":t.$gettext("Client")},{by_listeners_legend:m(()=>[h(s(t.$gettext("Clients by Listeners")),1)]),by_connected_time_legend:m(()=>[h(s(t.$gettext("Clients by Connected Time")),1)]),_:1},8,["date-range","api-url","field-label"]))}}),Ge=T({__name:"ListeningTimeTab",props:{dateRange:{},apiUrl:{}},setup(g){const t=g,{$gettext:l}=J(),f=[{key:"label",label:l("Listening Time"),sortable:!1},{key:"value",label:l("Listeners"),sortable:!1}],u=V(t,"dateRange"),{axios:_}=K(),{DateTime:b}=W(),{data:r,isLoading:o,refetch:i}=F({queryKey:z([H.StationReports,"listening_time_metrics",u]),queryFn:async({signal:c})=>{const{data:p}=await _.get(t.apiUrl,{signal:c,params:{start:b.fromJSDate(u.value.startDate).toISO(),end:b.fromJSDate(u.value.endDate).toISO()}});return p},placeholderData:()=>({all:[],chart:{labels:[],datasets:[],alt:[]}})}),y=se(P(()=>r.value?.all??[]),o,void 0,async()=>{await i()}),C=I("$dataTable"),{navigate:S}=te(C),D=ee();return X(u,()=>{D.value&&S()}),(c,p)=>(n(),$(O,{loading:a(o),lazy:""},{default:m(()=>[e("fieldset",null,[e("legend",null,s(a(l)("Listeners by Listening Time")),1),a(r)?(n(),$(A,{key:0,style:{width:"100%"},data:a(r).chart.datasets,labels:a(r).chart.labels,alt:a(r).chart.alt,"aspect-ratio":4},null,8,["data","labels","alt"])):k("",!0)]),d(ae,{id:"listening_time_table",ref_key:"$dataTable",ref:C,paginated:"",fields:f,provider:a(y)},null,8,["provider"])]),_:1},8,["loading"]))}}),Xe={class:"card mb-4",role:"region"},Ye={class:"card-header text-bg-primary"},Ze={class:"d-flex align-items-center"},et={class:"card-title flex-fill my-0"},tt={class:"flex-shrink"},at={class:"card-body"},Bt=T({__name:"Overview",setup(g){const{analyticsLevel:t}=re(),l=t===ie.All,f=R("/reports/overview/charts"),u=R("/reports/overview/best-and-worst"),_=R("/reports/overview/by-stream"),b=R("/reports/overview/by-browser"),r=R("/reports/overview/by-country"),o=R("/reports/overview/by-client"),i=R("/reports/overview/by-listening-time"),y=ue(),{timezone:C}=de(y),{now:S}=_e(),D=S(),c=E({startDate:D.minus({days:13}).toJSDate(),endDate:D.toJSDate()});return(p,w)=>(n(),v("section",Xe,[e("div",Ye,[e("div",Ze,[e("h2",et,s(p.$gettext("Station Statistics")),1),e("div",tt,[d(le,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=B=>c.value=B),options:{enableTimePicker:!0,timezone:a(C)},class:"btn-dark"},null,8,["modelValue","options"])])])]),e("div",at,[d(me,{"destroy-on-hide":""},{default:m(()=>[d(U,{label:p.$gettext("Best & Worst")},{default:m(()=>[d(Fe,{"api-url":a(u),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),d(U,{label:p.$gettext("Listeners By Time Period")},{default:m(()=>[d(De,{"api-url":a(f),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),d(U,{label:p.$gettext("Listening Time")},{default:m(()=>[d(Ge,{"api-url":a(i),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),d(U,{label:p.$gettext("Streams")},{default:m(()=>[d(je,{"api-url":a(_),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"]),l?(n(),$(U,{key:0,label:p.$gettext("Clients")},{default:m(()=>[d(Ee,{"api-url":a(o),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"])):k("",!0),l?(n(),$(U,{key:1,label:p.$gettext("Browsers")},{default:m(()=>[d(Ne,{"api-url":a(b),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"])):k("",!0),l?(n(),$(U,{key:2,label:p.$gettext("Countries")},{default:m(()=>[d(Qe,{"api-url":a(r),"date-range":c.value},null,8,["api-url","date-range"])]),_:1},8,["label"])):k("",!0)]),_:1})])]))}});export{Bt as default};
