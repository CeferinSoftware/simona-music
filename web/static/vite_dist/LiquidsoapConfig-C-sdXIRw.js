import{d as V,r as v,g as F,m as $,o as d,e as a,a as e,l as U,b as m,f as A,t as s,u as l,h as H,c as N,s as R,F as T,D as J}from"./vue-BsfewpWM.js";import{_ as P}from"./FormFieldset-DUBDY7k3.js";import{_ as Y}from"./FormGroupField-K9S4Sadl.js";import{_ as j}from"./FormMarkup-DqBjuQjX.js";import{m as G}from"./mergeExisting-B6FvxI3v.js";import{_ as K}from"./InfoCard-D5Q671bF.js";import{u as O}from"./useMayNeedRestart-CTqbUxcB.js";import{f as B,u as D}from"./layout-CUzOT8aY.js";import{_ as Q}from"./Loading-CQdAiB8R.js";import{e as S}from"./useStationQuery-ClAZEJp_.js";import{_ as W}from"./CodemirrorTextarea-gPAxNt7r.js";import{I as X}from"./InvisibleSubmitButton-NGv_v7G8.js";import{_ as Z}from"./FormGroup-DXDHSoyc.js";import{u as tt,_ as et}from"./useHasModal-Bq3QxExQ.js";import{_ as ot}from"./FormFile-B5B3WV6y.js";import{u as st}from"./useResettableRef-BwkDrsai.js";import{u as at}from"./regle-hGsoY2W9.js";import"./ValidationError-DsAp6Fjg.js";import"./estoolkit-DCzBkaPJ.js";import"./icons-BAjd3tML.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./vue-router-Cafqdr3I.js";import"./index.es-DJGkFkUi.js";import"./theme-BQjAlSn5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./zxcvbn-Bgw4VUEj.js";const it=V({__name:"ImportModal",props:{importUrl:{}},emits:["relist"],setup(I,{expose:f,emit:x}){const C=I,_=x,u=v(null),c=o=>{u.value=o},g=F("$modal"),{show:n,hide:r}=tt(g),{notifySuccess:k,notifyError:b}=B(),{axios:p}=D(),y=async()=>{if(!u.value)return;const o=new FormData;o.append("file",u.value);const{data:i}=await p.post(C.importUrl,o);i.success?k(i.message):b(i.message),r()},w=()=>{_("relist"),u.value=null};return f({open:n}),(o,i)=>(d(),$(et,{id:"import_modal",ref_key:"$modal",ref:g,title:o.$gettext("Import Configuration"),size:"lg",onHidden:w},{"modal-footer":a(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:i[0]||(i[0]=(...t)=>l(r)&&l(r)(...t))},s(o.$gettext("Close")),1),e("button",{class:"btn btn-primary",type:"submit",onClick:y},s(o.$gettext("Import Configuration")),1)]),default:a(()=>[e("form",{class:"form",onSubmit:U(y,["prevent"])},[m(Z,{id:"import_modal_file"},{label:a(()=>[A(s(o.$gettext("Select File to Import")),1)]),description:a(()=>[A(s(o.$gettext("Import a file that was previously exported by this page, and AzuraCast will update any custom code sections with the custom code contained in your export file. Note that this will remove any existing code you have in these sections.")),1)]),default:a(({id:t})=>[m(ot,{id:t,onUploaded:c},null,8,["id"])]),_:1}),m(X)],32)]),_:1},8,["title"]))}}),nt={class:"card",role:"region","aria-labelledby":"hdr_edit_ls_config"},rt={class:"card-header text-bg-primary"},lt={id:"hdr_edit_ls_config",class:"card-title"},mt={class:"card-text"},ut={class:"card-text"},ct={class:"card-text"},dt={class:"card-body"},pt={class:"buttons mb-3"},ft=["href"],_t={class:"typography-body-1"},Pt=V({__name:"LiquidsoapConfig",setup(I){const f=S("/liquidsoap-config"),x=S("/liquidsoap-config/export"),C=S("/liquidsoap-config/import"),_=v([]),u=v([]),{record:c,reset:g}=st(()=>({custom_config_top:null,custom_config_pre_playlists:null,custom_config_pre_live:null,custom_config_pre_fade:null,custom_config:null,custom_config_bottom:null})),{r$:n}=at(c,{},{}),r=v(!0),{mayNeedRestart:k}=O(),{axios:b}=D(),p=async()=>{r.value=!0;try{const{data:t}=await b.get(f.value);_.value=t.config,u.value=t.sections,g(),n.$reset(),c.value=G(c.value,t.contents)}finally{r.value=!1}};H(p);const{notifySuccess:y}=B(),w=async()=>{const{valid:t}=await n.$validate();t&&(await b({method:"PUT",url:f.value,data:c.value}),y(),k(),await p())},o=F("$importModal"),i=()=>{o.value?.open()};return(t,M)=>(d(),N(T,null,[e("form",{class:"form vue-form",onSubmit:U(w,["prevent"])},[e("section",nt,[e("div",rt,[e("h2",lt,s(t.$gettext("Edit Liquidsoap Configuration")),1)]),m(K,null,{default:a(()=>[e("p",mt,s(t.$gettext("Using this page, you can customize several sections of the Liquidsoap configuration. This allows you to add advanced functionality to your station's AutoDJ.")),1),e("p",ut,s(t.$gettext("The editable text boxes are areas where you can insert custom configuration code. The non-editable sections are automatically generated by AzuraCast.")),1),e("p",ct,s(t.$gettext("This is an advanced feature and custom code is not officially supported by AzuraCast. You may break your station by adding custom code, but removing it should fix any issues.")),1)]),_:1}),m(Q,{loading:r.value,lazy:""},{default:a(()=>[e("div",dt,[e("div",pt,[e("a",{class:"btn btn-sm btn-secondary",href:l(x),target:"_blank"},s(t.$gettext("Export Configuration")),9,ft),e("button",{class:"btn btn-sm btn-secondary",onClick:U(i,["prevent"])},s(t.$gettext("Import Configuration")),1)]),e("button",{type:"submit",class:R(["btn mb-2",l(n).$invalid?"btn-danger":"btn-primary"])},s(t.$gettext("Save Changes")),3),(d(!0),N(T,null,J(_.value,(h,q)=>(d(),$(P,{key:q,class:"mb-0"},{default:a(()=>[h.is_field?(d(),$(Y,{key:0,id:"form_edit_"+h.field_name,field:l(n)[h.field_name]},{default:a(({id:E,model:z})=>[m(W,{id:E,modelValue:z.$model,"onUpdate:modelValue":L=>z.$model=L,mode:"liquidsoap"},null,8,["id","modelValue","onUpdate:modelValue"])]),_:1},8,["id","field"])):(d(),$(j,{key:1,id:"form_section_"+q},{default:a(()=>[e("pre",_t,s(h.markup??""),1)]),_:2},1032,["id"]))]),_:2},1024))),128)),e("button",{type:"submit",class:R(["btn mt-2",l(n).$invalid?"btn-danger":"btn-primary"])},s(t.$gettext("Save Changes")),3)])]),_:1},8,["loading"])])],32),m(it,{ref_key:"$importModal",ref:o,"import-url":l(C),onRelist:M[0]||(M[0]=()=>p())},null,8,["import-url"])],64))}});export{Pt as default};
