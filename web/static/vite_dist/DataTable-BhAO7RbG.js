import{d as ee,c as l,o as s,s as A,l as te,t as h,q as r,r as K,B as I,K as $e,a,i as v,m as R,F as b,D as N,w as pe,y as ve,ah as Ce,a9 as Fe,G as re,a1 as Se,b as B,u as O,k as U,f as D,p as Be}from"./vue-BsfewpWM.js";import{_ as z,z as De,A as Ae,B as Re,C as Le,D as Te}from"./icons-BAjd3tML.js";import{_ as xe}from"./FormMultiCheck-RiRcopXY.js";import{_ as ie}from"./FormCheckbox-Cc7beVle.js";import{o as Oe,p as Ue}from"./estoolkit-DCzBkaPJ.js";import{c as Ve,Z as Ke}from"./layout-CUzOT8aY.js";import{a as Ie,g as ue}from"./iteratee-DJRL6CbS.js";import{f as Y}from"./map-Caxea7Kw.js";import{i as Ne}from"./isArrayLike-DknTMkCU.js";import{i as Ee,a as Me}from"./isTypedArray-By1PpNM0.js";import{s as ze}from"./some-B0KiPFWm.js";import{f as je}from"./forEach-BFcv9GyE.js";function Ge(n,f,u){return Number.isNaN(f)&&(f=0),Number.isNaN(u)&&(u=0),Oe(n,f,u)}function ce(n){if(n==null)return!0;if(Ne(n))return typeof n.splice!="function"&&typeof n!="string"&&(typeof Buffer>"u"||!Buffer.isBuffer(n))&&!Ee(n)&&!Ie(n)?!1:n.length===0;if(typeof n=="object"){if(n instanceof Map||n instanceof Set)return n.size===0;const f=Object.keys(n);return Me(n)?f.filter(u=>u!=="constructor").length===0:f.length===0}return!0}const He={key:1,class:"page-link"},V=ee({__name:"PaginationItem",props:{page:{default:1},label:{},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["click"],setup(n,{emit:f}){const u=n,i=f,g=()=>{i("click",u.page)};return(d,k)=>(s(),l("li",{class:A(["page-item",[d.active?"active":"",d.disabled?"disabled":""]])},[d.disabled?(s(),l("span",He,h(d.label??d.page),1)):(s(),l("a",{key:0,class:"page-link",href:"#",onClick:te(g,["prevent"])},h(d.label??d.page),1))],2))}}),qe={class:"d-flex"},We={class:"pagination mb-0"},Xe={key:0,class:"input-group input-group-sm ms-2"},Ze=["max","aria-label","onKeydown"],de=ee({__name:"Pagination",props:{total:{},perPage:{},currentPage:{default:1},pageSpace:{default:1}},emits:["update:currentPage","change"],setup(n,{emit:f}){const u=n,i=f,g=r(()=>Math.max(1,Math.ceil(u.total/u.perPage))),d=K(1),k=c=>{c=Ge(c,1,g.value),p.value=c,d.value=c};I($e(u,"currentPage"),c=>{k(c)});const p=r({get(){return u.currentPage},set(c){i("update:currentPage",c),i("change",c)}}),G=r(()=>p.value>=u.pageSpace+2),_=r(()=>p.value>=u.pageSpace+4),$=r(()=>p.value<=g.value-(u.pageSpace+1)),y=r(()=>p.value<g.value-(u.pageSpace+2)),P=r(()=>{let c=Math.max(1,p.value-u.pageSpace);c-1===2&&c--;let w=Math.min(p.value+u.pageSpace,g.value);g.value-w===2&&w++;const m=[];for(let F=c;F<=w;F++)m.push(F);return m}),C=r(()=>g.value>10),L=()=>{k(d.value)};return(c,w)=>(s(),l("nav",qe,[a("ul",We,[G.value?(s(),R(V,{key:0,page:1,active:p.value===1,onClick:k},null,8,["active"])):v("",!0),_.value?(s(),R(V,{key:1,label:"...",disabled:""})):v("",!0),(s(!0),l(b,null,N(P.value,m=>(s(),R(V,{key:m,page:m,active:p.value===m,onClick:k},null,8,["page","active"]))),128)),y.value?(s(),R(V,{key:2,label:"...",disabled:""})):v("",!0),$.value?(s(),R(V,{key:3,page:g.value,active:p.value===g.value,onClick:k},null,8,["page","active"])):v("",!0)]),C.value?(s(),l("div",Xe,[pe(a("input",{"onUpdate:modelValue":w[0]||(w[0]=m=>d.value=m),type:"number",min:1,max:g.value,step:"1",class:"form-control rounded-start-2","aria-label":c.$gettext("Page"),style:{"max-width":"60px"},onKeydown:Ce(te(L,["prevent"]),["enter"])},null,40,Ze),[[ve,d.value]]),a("button",{class:"btn btn-outline-secondary rounded-end-2",type:"button",onClick:L},h(c.$gettext("Go")),1)])):v("",!0)]))}}),j={searchPhrase:"",currentPage:1,sortField:null,sortOrder:null,paginated:!1,perPage:10};function qt(n){return{refresh:()=>n.value?.refresh(),relist:()=>n.value?.relist(),navigate:()=>n.value?.navigate(),setFilter:d=>n.value?.setFilter(d)}}const Je=["id"],Qe={key:0,class:"datatable-toolbar-top card-body"},Ye={class:"row align-items-center"},et={key:0,class:"col-xl-6 col-lg-5 col-md-12 col-sm-12"},tt={key:1,class:"col-xl-6 col-lg-5 col-md-12 col-sm-12"},st={class:"col-xl-6 col-lg-7 col-md-12 col-sm-12 d-flex my-2"},at={class:"flex-fill"},lt={class:"input-group"},ot={class:"input-group-text"},nt=["placeholder"],rt={class:"flex-shrink-1 ps-3"},it={class:"btn-group actions"},ut=["title"],ct={key:0,class:"dropdown btn-group",role:"group"},dt=["title"],pt={class:"dropdown-menu"},vt=["onClick"],gt={key:1,class:"dropdown btn-group",role:"group"},ft=["title"],ht={class:"dropdown-menu"},yt={class:"px-3 py-1"},mt={key:0},bt={key:0,class:"checkbox"},kt={class:"form-check"},_t={class:"visually-hidden"},Pt=["aria-sort","onClick"],wt={class:"d-flex align-items-center"},$t={key:0},Ct=["colspan"],Ft={class:"spinner-border",role:"status"},St={class:"visually-hidden"},Bt={key:1},Dt=["colspan"],At={key:0,class:"checkbox"},Rt={class:"form-check"},Lt={class:"visually-hidden"},Tt=["colspan"],xt={key:1,class:"datatable-toolbar-bottom card-body"},Wt=ee({__name:"DataTable",props:{id:{},fields:{},provider:{},responsive:{type:[Boolean,String],default:()=>!0},paginated:{type:Boolean,default:j.paginated},hideOnLoading:{type:Boolean,default:!0},showToolbar:{type:Boolean,default:!0},pageOptions:{default:()=>[10,25,50,100,250,500,0]},defaultPerPage:{default:j.perPage},selectable:{type:Boolean,default:!1},detailed:{type:Boolean,default:!1},selectFields:{type:Boolean,default:!1}},emits:["row-selected","filtered"],setup(n,{expose:f,emit:u}){const i=n,g=Fe(),d=u,k=r(()=>i.provider.total.value),p=r(()=>i.provider.rows.value),G=r(()=>i.provider.loading.value),_=re([]);I(_,e=>{d("row-selected",e)});const $=K(j.searchPhrase),y=K(j.currentPage),P=K(null),C=K(null),L=re(null);I(p,()=>{_.value=[],L.value=null});const c=r(()=>i.fields.map(e=>({isRowHeader:!1,sortable:!1,selectable:!1,visible:!0,class:void 0,formatter:void 0,sorter:o=>ue(o,e.key),...e}))),w=r(()=>Y({...c.value},e=>e.selectable??!1)),m=r(()=>w.value.map(e=>({value:e.key,text:e.label}))),F=r(()=>Y({...w.value},e=>e.visible??!0)),E=Ve("datatable_"+i.id+"_settings",{sortBy:null,sortDesc:!1,perPage:i.defaultPerPage,visibleFieldKeys:F.value.map(e=>e.key)},{mergeDefaults:!0}),H=r({get:()=>{const e=Se(E.value.visibleFieldKeys);return ce(e)?F.value.map(o=>o.key):e},set:e=>{ce(e)&&(e=F.value.map(o=>o.key)),E.value.visibleFieldKeys=e}}),S=r(()=>i.paginated?E.value?.perPage??i.defaultPerPage:-1),ge=r(()=>({searchPhrase:$.value,currentPage:y.value,sortField:P.value?.key??null,sortOrder:C.value,paginated:i.paginated,perPage:S.value}));I(ge,e=>{i.provider.setContext(e)},{immediate:!0});const q=r(()=>{const e=c.value.slice();if(!i.selectFields)return e;const o=H.value;return Y(e,t=>t.selectable?o.indexOf(t.key)!==-1:!0)}),se=e=>e===0?"All":e.toString(),fe=r(()=>se(S.value)),ae=r(()=>i.paginated&&S.value!==0),W=async(e=!1)=>{await i.provider.refresh(e)},le=()=>{W(!1)},oe=e=>{y.value=e},X=()=>{W(!0)},he=e=>{W(e.shiftKey)},ye=()=>{$.value="",y.value=1},me=e=>{$.value=e};I(S,()=>{y.value=1,X()}),Ke($,e=>{y.value=1,X(),d("filtered",e)},{debounce:500,maxWait:1e3});const Z=r(()=>p.value.length===0?!1:!ze(p.value,e=>_.value.indexOf(e)===-1)),J=e=>_.value.indexOf(e)!==-1,Q=r(()=>{let e=q.value.length;return e+=i.selectable?1:0,e}),be=e=>{e.sortable&&(P.value?.key===e.key&&C.value==="desc"?(C.value=null,P.value=null):(C.value=P.value?.key===e.key?"desc":"asc",P.value=e),le())},ke=e=>{const o=_.value.slice();if(J(e)){const t=o.indexOf(e);t>=0&&o.splice(t,1)}else o.push(e);_.value=o},_e=()=>{const e=[];Z.value||je(p.value,o=>{e.push(o)}),_.value=e},M=e=>L.value===e,ne=e=>{L.value=M(e)?null:e},Pe=r(()=>Ue(i.responsive)?i.responsive:i.responsive?"table-responsive":""),we=(e,o)=>{const t=ue(o,e.key,"");return e.formatter?e.formatter(t,e.key,o):t};return f({refresh:le,relist:X,navigate:ye,setFilter:me,toggleDetails:ne}),(e,o)=>(s(),l("div",{id:e.id,class:"datatable-wrapper"},[e.showToolbar?(s(),l("div",Qe,[a("div",Ye,[ae.value?(s(),l("div",et,[B(de,{"current-page":y.value,"onUpdate:currentPage":o[0]||(o[0]=t=>y.value=t),total:k.value,"per-page":S.value,onChange:oe},null,8,["current-page","total","per-page"])])):(s(),l("div",tt," Â  ")),a("div",st,[a("div",at,[a("div",lt,[a("span",ot,[B(z,{icon:O(De)},null,8,["icon"])]),pe(a("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>$.value=t),class:"form-control",type:"search",placeholder:e.$gettext("Search")},null,8,nt),[[ve,$.value]])])]),a("div",rt,[a("div",it,[a("button",{type:"button","data-bs-tooltip":"",class:"btn btn-secondary","data-bs-placement":"left",title:e.$gettext("Refresh rows"),onClick:he},[B(z,{icon:O(Ae)},null,8,["icon"])],8,ut),e.paginated?(s(),l("div",ct,[a("button",{type:"button","data-bs-tooltip":"",class:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-placement":"left",title:e.$gettext("Items per page")},[a("span",null,h(fe.value),1),o[4]||(o[4]=a("span",{class:"caret"},null,-1))],8,dt),a("ul",pt,[(s(!0),l(b,null,N(e.pageOptions,t=>(s(),l("li",{key:t},[a("button",{type:"button",class:A(["dropdown-item",t===S.value?"active":""]),onClick:T=>O(E).perPage=t},h(se(t)),11,vt)]))),128))])])):v("",!0),e.selectFields?(s(),l("div",gt,[a("button",{type:"button",class:"btn btn-secondary dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-placement":"left",title:e.$gettext("Display fields")},[B(z,{icon:O(Re)},null,8,["icon"]),o[5]||(o[5]=a("span",{class:"caret"},null,-1))],8,ft),a("div",ht,[a("div",yt,[B(xe,{id:"field_select",modelValue:H.value,"onUpdate:modelValue":o[2]||(o[2]=t=>H.value=t),options:m.value,stacked:""},null,8,["modelValue","options"])])])])):v("",!0)])])])])])):v("",!0),a("div",{class:A(["datatable-main",[Pe.value]])},[a("table",{class:A(["table align-middle table-striped table-hover",[e.selectable?"table-selectable":""]])},[g.caption?(s(),l("caption",mt,[U(e.$slots,"caption")])):v("",!0),a("thead",null,[a("tr",null,[e.selectable?(s(),l("th",bt,[a("label",kt,[B(ie,{autocomplete:"off","model-value":Z.value,"onUpdate:modelValue":_e},null,8,["model-value"]),a("span",_t,[Z.value?(s(),l(b,{key:0},[D(h(e.$gettext("Unselect All Rows")),1)],64)):(s(),l(b,{key:1},[D(h(e.$gettext("Select All Rows")),1)],64))])])])):v("",!0),(s(!0),l(b,null,N(q.value,t=>(s(),l("th",{key:t.key+"header",class:A([t.class,t.sortable?"sortable":""]),"aria-sort":t.sortable&&P.value?.key===t.key?C.value==="asc"?"ascending":"descending":void 0,onClick:te(T=>be(t),["stop"])},[U(e.$slots,`header(${t.key})`,Be({ref_for:!0},t),()=>[a("div",wt,[D(h(t.label)+" ",1),t.sortable&&P.value?.key===t.key?(s(),R(z,{key:0,icon:C.value==="asc"?O(Le):O(Te)},null,8,["icon"])):v("",!0)])])],10,Pt))),128))])]),a("tbody",null,[G.value&&e.hideOnLoading?(s(),l("tr",$t,[a("td",{colspan:Q.value,class:"text-center p-5"},[a("div",Ft,[a("span",St,h(e.$gettext("Loading")),1)])],8,Ct)])):p.value.length===0?(s(),l("tr",Bt,[a("td",{colspan:Q.value},[U(e.$slots,"empty",{},()=>[D(h(e.$gettext("No records.")),1)])],8,Dt)])):(s(!0),l(b,{key:2},N(p.value,(t,T)=>(s(),l(b,{key:T},[a("tr",{class:A([M(t)?"table-active":""])},[e.selectable?(s(),l("td",At,[a("label",Rt,[B(ie,{autocomplete:"off","model-value":J(t),"onUpdate:modelValue":x=>ke(t)},null,8,["model-value","onUpdate:modelValue"]),a("span",Lt,[J(t)?(s(),l(b,{key:0},[D(h(e.$gettext("Unselect Row")),1)],64)):(s(),l(b,{key:1},[D(h(e.$gettext("Select Row")),1)],64))])])])):v("",!0),(s(!0),l(b,null,N(q.value,x=>(s(),l("td",{key:x.key+":"+T,class:A(x.class)},[U(e.$slots,`cell(${x.key})`,{column:x,item:t,isActive:M(t),toggleDetails:()=>ne(t)},()=>[D(h(we(x,t)),1)])],2))),128))],2),M(t)?(s(),l("tr",{key:T+":detail",class:"table-active"},[a("td",{colspan:Q.value},[U(e.$slots,"detail",{item:t,index:T})],8,Tt)])):v("",!0)],64))),128))])],2)],2),e.showToolbar?(s(),l("div",xt,[ae.value?(s(),R(de,{key:0,"current-page":y.value,"onUpdate:currentPage":o[3]||(o[3]=t=>y.value=t),total:k.value,"per-page":S.value,onChange:oe},null,8,["current-page","total","per-page"])):v("",!0)])):v("",!0)],8,Je))}});export{j as D,Wt as _,de as a,ce as i,qt as u};
