import{_ as m,f as T,e as C,w as z,F as H,G as K}from"./icons-BAjd3tML.js";import{_ as Q}from"./PlayButton-Dbj4ENWk.js";import{A as j}from"./AlbumArt-CcCTgtsV.js";import{u as N,a as E,G as R,c as W,g as J}from"./layout-CUzOT8aY.js";import{_ as L}from"./TimeSeriesChart-DO6pjMtG.js";import{_ as X}from"./Loading-CQdAiB8R.js";import{a as Y,_ as D}from"./Tabs-DMTPhsiO.js";import{a as P,Q as w,g as x}from"./useStationQuery-ClAZEJp_.js";import{u as Z}from"./luxon-m3VuE4xT.js";import{d as V,m as p,o as e,u as t,e as n,i as d,b as i,q as ss,j as ts,a,c as r,t as l,F as S,D as as,s as q,f as I}from"./vue-BsfewpWM.js";import{_ as U}from"./CardPage-Cth3uewv.js";import{_ as es}from"./UserInfoPanel-CZjNR-4w.js";import{_ as ns}from"./DataTable-BhAO7RbG.js";import{u as os}from"./useApiItemProvider-DAIhDonu.js";import{u as ls}from"./acl-BtcXS2wX.js";import{_ as is}from"./DashboardNoSidebar-Cg7D8DtY.js";import"./lightbox-B9nVyWr-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./leaflet-DkUWBo0d.js";import"./estoolkit-DCzBkaPJ.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./forEach-BFcv9GyE.js";import"./isArrayLike-DknTMkCU.js";import"./luxon-F75Z0klY.js";import"./defaultsDeep-B9v54JJt.js";import"./vue-router-Cafqdr3I.js";import"./InfoCard-D5Q671bF.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./PanelFooter-D_-n9Oyr.js";const rs=V({__name:"DashboardCharts",props:{chartsUrl:{}},setup(A){const b=A,{DateTime:y}=Z(),h={options:{scales:{x:{min:Number(y.utc().minus({days:30}).toMillis())}}}},{axios:g}=N(),{data:_,isLoading:k}=P({queryKey:[w.Dashboard,"charts"],queryFn:async({signal:c})=>{const{data:o}=await g.get(b.chartsUrl,{signal:c});return o},placeholderData:()=>({average:{metrics:[],alt:[]},unique:{metrics:[],alt:[]}}),staleTime:3600*1e3});return(c,o)=>(e(),p(X,{loading:t(k),lazy:""},{default:n(()=>[t(_)?(e(),p(Y,{key:0},{default:n(()=>[i(D,{label:c.$gettext("Average Listeners")},{default:n(()=>[i(L,{style:{width:"100%"},data:t(_).average.metrics,alt:t(_).average.alt,"aspect-ratio":3,options:h},null,8,["data","alt"])]),_:1},8,["label"]),i(D,{label:c.$gettext("Unique Listeners")},{default:n(()=>[i(L,{style:{width:"100%"},data:t(_).unique.metrics,alt:t(_).unique.alt,"aspect-ratio":3,options:h},null,8,["data","alt"])]),_:1},8,["label"])]),_:1})):d("",!0)]),_:1},8,["loading"]))}}),cs={id:"dashboard",class:"row-of-cards"},ds=["aria-label"],_s={key:0,class:"flex-shrink-0 me-3"},us={key:1,class:"flex-shrink-0 me-3"},ms={class:"flex-fill"},ps={class:"card-text"},hs={key:2,class:"flex-shrink-0 ms-md-3 mt-3 mt-md-0"},fs=["href"],bs={class:"d-flex align-items-center"},ys={class:"flex-fill"},gs=["id"],ks={class:"flex-shrink-0"},vs={key:0,id:"charts",class:"card-body"},xs={class:"d-flex flex-wrap align-items-center"},ws={class:"flex-fill"},As=["id"],$s={key:0,class:"flex-shrink-0"},Cs={class:"h5 m-0"},Ls={key:0},Ds=["href"],Ss={class:"pe-1"},qs=["href","aria-label"],Is={class:"d-flex align-items-center"},Us={key:1,class:"flex-fill text-muted"},Ns={key:2,class:"flex-fill"},Ps={class:"nowplaying-title"},Vs={class:"nowplaying-artist"},Fs={key:3,class:"flex-fill"},Bs={class:"nowplaying-title"},kt=V({__name:"Dashboard",setup(A){const{showCharts:b,showAlbumArt:y}=E(),h=ls(R.View),g=x("/frontend/dashboard/notifications"),_=x("/frontend/dashboard/charts"),k=x("/frontend/dashboard/stations"),c=W("dashboard_show_chart",!0),{$gettext:o}=J(),F=ss(()=>c.value?o("Hide Charts"):o("Show Charts")),{axios:B}=N(),{data:v,isLoading:G}=P({queryKey:[w.Dashboard,"notifications"],queryFn:async({signal:$})=>{const{data:u}=await B.get(g.value,{signal:$});return u}}),M=[{key:"play_button",label:"",sortable:!1,class:"shrink"},{key:"name",label:o("Station Name"),sortable:!0},{key:"listeners",label:o("Listeners"),sortable:!0},{key:"now_playing",label:o("Now Playing"),sortable:!0},{key:"actions",label:"",sortable:!1,class:"shrink"}],O=os(k,[w.Dashboard,"stations"],{refetchInterval:15*1e3});return($,u)=>{const f=ts("router-link");return e(),p(is,null,{default:n(()=>[a("div",cs,[a("section",{class:"card",role:"region","aria-label":t(o)("Account Details")},[i(es,null,{default:n(()=>[i(f,{class:"btn btn-dark",role:"button",to:{name:"profile:index"}},{default:n(()=>[i(m,{icon:t(T)},null,8,["icon"]),a("span",null,l(t(o)("My Account")),1)]),_:1}),t(h)?(e(),p(f,{key:0,class:"btn btn-dark",role:"button",to:{name:"admin:index"}},{default:n(()=>[i(m,{icon:t(C)},null,8,["icon"]),a("span",null,l(t(o)("Administration")),1)]),_:1})):d("",!0)]),_:1}),!t(G)&&t(v)&&t(v).length>0?(e(!0),r(S,{key:0},as(t(v),s=>(e(),r("div",{key:s.title,class:q(["card-body d-flex align-items-center alert flex-md-row flex-column","alert-"+s.type]),role:"alert","aria-live":"polite"},[s.type==="info"?(e(),r("div",_s,[i(m,{icon:t(z),class:"lg"},null,8,["icon"])])):(e(),r("div",us,[i(m,{icon:t(H),class:"lg"},null,8,["icon"])])),a("div",ms,[a("h4",null,l(s.title),1),a("p",ps,l(s.body),1)]),s.actionLabel&&s.actionUrl?(e(),r("div",hs,[a("a",{class:q(["btn btn-sm","btn-"+s.type]),href:s.actionUrl,target:"_blank"},l(s.actionLabel),11,fs)])):d("",!0)],2))),128)):d("",!0)],8,ds),t(b)?(e(),p(U,{key:0,"header-id":"hdr_listeners_per_station"},{header:n(({id:s})=>[a("div",bs,[a("div",ys,[a("h3",{id:s,class:"card-title"},l(t(o)("Listeners Per Station")),9,gs)]),a("div",ks,[a("button",{type:"button",class:"btn btn-sm btn-dark py-2",onClick:u[0]||(u[0]=Gs=>c.value=!t(c))},l(F.value),1)])])]),default:n(()=>[t(c)?(e(),r("div",vs,[i(rs,{"charts-url":t(_)},null,8,["charts-url"])])):d("",!0)]),_:1})):d("",!0),i(U,{"header-id":"hdr_stations"},{header:n(({id:s})=>[a("div",xs,[a("div",ws,[a("h2",{id:s,class:"card-title"},l(t(o)("Station Overview")),9,As)]),t(h)?(e(),r("div",$s,[i(f,{class:"btn btn-dark py-2",to:{name:"admin:stations:index"}},{default:n(()=>[i(m,{icon:t(C)},null,8,["icon"]),a("span",null,l(t(o)("Manage Stations")),1)]),_:1})])):d("",!0)])]),default:n(()=>[i(ns,{id:"dashboard_stations",fields:M,provider:t(O),paginated:"",responsive:"","show-toolbar":"","hide-on-loading":!1},{"cell(play_button)":n(({item:s})=>[i(Q,{class:"file-icon btn-lg",stream:{url:s.station.listen_url,title:s.station.name,isStream:!0}},null,8,["stream"])]),"cell(name)":n(({item:s})=>[a("div",Cs,l(s.station.name),1),s.station.is_public?(e(),r("div",Ls,[a("a",{href:s.links.public,target:"_blank"},l(t(o)("Public Page")),9,Ds)])):d("",!0)]),"cell(listeners)":n(({item:s})=>[a("span",Ss,[i(m,{class:"sm align-middle",icon:t(K)},null,8,["icon"])]),s.links.listeners?(e(),r("a",{key:0,href:s.links.listeners,"aria-label":t(o)("View Listener Report")},l(s.listeners.total),9,qs)):(e(),r(S,{key:1},[I(l(s.listeners.total),1)],64))]),"cell(now_playing)":n(({item:s})=>[a("div",Is,[t(y)&&s.now_playing&&s.now_playing.song&&s.now_playing.song.art?(e(),p(j,{key:0,src:s.now_playing.song.art,class:"flex-shrink-0 pe-3"},null,8,["src"])):d("",!0),s.is_online?s.now_playing?.song?.title!==""?(e(),r("div",Ns,[a("strong",null,[a("span",Ps,l(s.now_playing?.song?.title),1)]),u[1]||(u[1]=a("br",null,null,-1)),a("span",Vs,l(s.now_playing?.song?.artist),1)])):(e(),r("div",Fs,[a("strong",null,[a("span",Bs,l(s.now_playing?.song?.text),1)])])):(e(),r("div",Us,l(t(o)("Station Offline")),1))])]),"cell(actions)":n(({item:s})=>[i(f,{class:"btn btn-primary",to:{name:"stations:index",params:{station_id:s.station.id}},role:"button"},{default:n(()=>[I(l(t(o)("Manage")),1)]),_:1},8,["to"])]),_:1},8,["provider"])]),_:1})])]),_:1})}}});export{kt as default};
