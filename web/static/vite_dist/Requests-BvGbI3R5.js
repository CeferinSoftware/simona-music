import{_ as A}from"./DataTable-BhAO7RbG.js";import{V as N,_ as $}from"./icons-BAjd3tML.js";import{g as I,a5 as V,f as B,u as F}from"./layout-CUzOT8aY.js";import{e as b,q as U,Q as H}from"./useStationQuery-ClAZEJp_.js";import{u as K}from"./useStationDateTimeFormatter-CkmvkIuo.js";import{u as Q}from"./useApiItemProvider-DAIhDonu.js";import{d as w,r as z,q as E,c as i,o as n,a,i as k,b as g,t as s,u as r,F as L,D as W,s as j,e as m,f as p}from"./vue-BsfewpWM.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./estoolkit-DCzBkaPJ.js";import"./isArrayLike-DknTMkCU.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./vue-router-Cafqdr3I.js";import"./luxon-m3VuE4xT.js";import"./luxon-F75Z0klY.js";const G={class:"card",role:"region"},J={class:"card-header text-bg-primary"},M={class:"card-title"},O={class:"card-body"},X={class:"nav nav-tabs",role:"tablist"},Y=["onClick"],Z={key:0,class:"card-body"},ee={key:0},te={key:1},se={key:0},ae={key:1},oe=["onClick"],Pe=w({__name:"Requests",setup(ie){const h=b("/reports/requests"),q=b("/reports/requests/clear"),c=z("pending"),C=E(()=>h.value+"?type="+c.value),{$gettext:t}=I(),R=[{key:"timestamp",label:t("Date Requested"),sortable:!1},{key:"played_at",label:t("Date Played"),sortable:!1},{key:"song_title",isRowHeader:!0,label:t("Song Title"),sortable:!1},{key:"ip",label:t("Requester IP"),sortable:!1},{key:"actions",label:t("Actions"),sortable:!1}],d=Q(C,U([H.StationReports,"requests",c])),u=()=>{d.refresh()},D=[{type:"pending",title:t("Pending Requests")},{type:"history",title:t("Request History")}],x=l=>{c.value=l},{formatIsoAsDateTime:y}=K(),{confirmDelete:_}=V(),{notifySuccess:f}=B(),{axios:v}=F(),T=async l=>{const{value:o}=await _({title:t("Delete Request?")});if(!o)return;const{data:e}=await v.delete(l);f(e.message),u()},P=async()=>{const{value:l}=await _({title:t("Clear All Pending Requests?"),confirmButtonText:t("Clear")});if(!l)return;const{data:o}=await v.post(q.value);f(o.message),u()};return(l,o)=>(n(),i("section",G,[a("div",J,[a("h2",M,s(r(t)("Song Requests")),1)]),a("div",O,[a("nav",X,[(n(),i(L,null,W(D,e=>a("div",{key:e.type,class:"nav-item",role:"presentation"},[a("button",{class:j(["nav-link",c.value===e.type?"active":""]),type:"button",role:"tab",onClick:S=>x(e.type)},s(e.title),11,Y)])),64))])]),c.value==="pending"?(n(),i("div",Z,[a("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=e=>P())},[g($,{icon:r(N)},null,8,["icon"]),a("span",null,s(r(t)("Clear Pending Requests")),1)])])):k("",!0),g(A,{id:"station_requests",fields:R,provider:r(d)},{"cell(timestamp)":m(e=>[p(s(r(y)(e.item.timestamp)),1)]),"cell(played_at)":m(e=>[e.item.played_at===null?(n(),i("span",ee,s(r(t)("Not Played")),1)):(n(),i("span",te,s(r(y)(e.item.played_at)),1))]),"cell(song_title)":m(e=>[e.item.track.title?(n(),i("div",se,[a("b",null,s(e.item.track.title),1),o[1]||(o[1]=a("br",null,null,-1)),p(" "+s(e.item.track.artist),1)])):(n(),i("div",ae,s(e.item.track.text),1))]),"cell(ip)":m(e=>[p(s(e.item.ip),1)]),"cell(actions)":m(e=>[e.item.played_at===0?(n(),i("button",{key:0,type:"button",class:"btn btn-sm btn-danger",onClick:S=>T(e.item.links.delete)},s(r(t)("Delete")),9,oe)):k("",!0)]),_:1},8,["provider"])]))}});export{Pe as default};
