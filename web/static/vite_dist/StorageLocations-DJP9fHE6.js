import{_ as W}from"./DataTable-BhAO7RbG.js";import{u as X}from"./useBaseEditModal-D4NDXa4y.js";import{d as Y,a7 as _,s as w,g as G,a8 as U}from"./layout-CUzOT8aY.js";import{_ as Z}from"./ModalForm-D0z4l5nm.js";import{_ as c}from"./FormGroupField-K9S4Sadl.js";import{_ as ee}from"./FormGroupMultiCheck-z3kTFzdV.js";import{_ as F,a as te}from"./Tabs-DMTPhsiO.js";import{u as ae,c as oe,r as f,l as z}from"./regle-hGsoY2W9.js";import{r as j,d as A,q as S,m as y,o as g,u as t,e as b,a as l,b as r,f as k,t as p,g as J,K as se,i as E,z as R,c as N,F as O,D as le,s as q,E as re}from"./vue-BsfewpWM.js";import{u as D}from"./useFormTabClass-DgI07GN4.js";import{_ as ie}from"./FormGroupCheckbox-ZsJmXmB6.js";import{m as ne}from"./mergeExisting-B6FvxI3v.js";import{_ as de,u as pe}from"./AddButton-DLx8r-7e.js";import{u as ce}from"./useConfirmAndDelete-CuQodV6V.js";import{_ as ue}from"./CardPage-Cth3uewv.js";import{g as me,Q as fe}from"./useStationQuery-ClAZEJp_.js";import{u as be}from"./useApiItemProvider-DAIhDonu.js";import"./icons-BAjd3tML.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./estoolkit-DCzBkaPJ.js";import"./isArrayLike-DknTMkCU.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./InvisibleSubmitButton-NGv_v7G8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-Dp0PSXNw.js";import"./useHasModal-Bq3QxExQ.js";import"./Loading-CQdAiB8R.js";import"./FormGroup-DXDHSoyc.js";import"./ValidationError-DsAp6Fjg.js";import"./zxcvbn-Bgw4VUEj.js";import"./InfoCard-D5Q671bF.js";import"./vue-router-Cafqdr3I.js";const T=Y("form-admin-storage-locations",()=>{const v=j({adapter:_.Local,path:"",storageQuota:"",dropboxAppKey:null,dropboxAppSecret:null,dropboxAuthToken:null,s3CredentialKey:null,s3CredentialSecret:null,s3Region:null,s3Version:"latest",s3Bucket:null,s3Endpoint:null,s3UsePathStyle:!1,sftpHost:null,sftpPort:22,sftpUsername:null,sftpPassword:null,sftpPrivateKey:null,sftpPrivateKeyPassPhrase:null}),{r$:d}=ae(v,()=>oe(v,"adapter",[{adapter:{literal:z(_.Dropbox),required:f},dropboxAuthToken:{required:f}},{adapter:{literal:z(_.S3),required:f},s3CredentialKey:{required:f},s3CredentialSecret:{required:f},s3Version:{required:f},s3Bucket:{required:f},s3Endpoint:{required:f}},{adapter:{literal:z(_.Sftp),required:f},sftpHost:{required:f},sftpPort:{required:f},sftpUsername:{required:f}},{adapter:{required:f}}]).value,{validationGroups:a=>({generalTab:[a.adapter,a.path,a.storageQuota],dropboxTab:[a.dropboxAppKey,a.dropboxAppSecret,a.dropboxAuthToken],s3Tab:[a.s3CredentialKey,a.s3CredentialSecret,a.s3Region,a.s3Version,a.s3Bucket,a.s3Endpoint,a.s3UsePathStyle],sftpTab:[a.sftpHost,a.sftpPort,a.sftpUsername,a.sftpPassword,a.sftpPrivateKey,a.sftpPrivateKeyPassPhrase]})});return{form:v,r$:d,$reset:()=>{d.$reset({toOriginalState:!0})}}}),_e={class:"row g-3"},ge=A({__name:"Form",setup(v){const d=T(),{r$:o}=w(d),a=D(S(()=>o.value.$groups.generalTab)),{$gettext:e}=G(),h=S(()=>[{value:_.Local,text:e("Local Filesystem")},{value:_.S3,text:e("Remote: S3 Compatible")},{value:_.Dropbox,text:e("Remote: Dropbox")},{value:_.Sftp,text:e("Remote: SFTP")}]);return(i,s)=>(g(),y(F,{label:t(e)("Basic Info"),"item-header-class":t(a)},{default:b(()=>[l("div",_e,[r(ee,{id:"form_edit_adapter",class:"col-md-12",field:t(o).adapter,options:h.value,stacked:"",radio:"",label:t(e)("Storage Adapter")},null,8,["field","options","label"]),r(c,{id:"form_edit_path",class:"col-md-12",field:t(o).path,label:t(e)("Path/Suffix"),description:t(e)("For local filesystems, this is the base path of the directory. For remote filesystems, this is the folder prefix.")},null,8,["field","label","description"]),r(c,{id:"form_edit_storageQuota",class:"col-md-12",field:t(o).storageQuota},{label:b(()=>[k(p(t(e)("Storage Quota")),1)]),description:b(()=>[k(p(t(e)('Set a maximum disk space that this storage location can use. Specify the size with unit, i.e. "8 GB". Units are measured in 1024 bytes. Leave blank to default to the available space on the disk.')),1)]),_:1},8,["field"])])]),_:1},8,["label","item-header-class"]))}}),ve={class:"row g-3"},he=A({__name:"Sftp",setup(v){const d=T(),{r$:o}=w(d),a=D(S(()=>o.value.$groups.sftpTab));return(e,h)=>(g(),y(F,{label:e.$gettext("Remote: SFTP"),"item-header-class":t(a)},{default:b(()=>[l("div",ve,[r(c,{id:"form_edit_sftpHost",class:"col-md-12 col-lg-6",field:t(o).sftpHost,label:e.$gettext("SFTP Host")},null,8,["field","label"]),r(c,{id:"form_edit_sftpPort",class:"col-md-12 col-lg-6","input-type":"number",min:"1",step:"1",field:t(o).sftpPort,label:e.$gettext("SFTP Port")},null,8,["field","label"]),r(c,{id:"form_edit_sftpUsername",class:"col-md-12 col-lg-6",field:t(o).sftpUsername,label:e.$gettext("SFTP Username")},null,8,["field","label"]),r(c,{id:"form_edit_sftpPassword",class:"col-md-12 col-lg-6",field:t(o).sftpPassword,label:e.$gettext("SFTP Password")},null,8,["field","label"]),r(c,{id:"form_edit_sftpPrivateKeyPassPhrase",class:"col-md-12",field:t(o).sftpPrivateKeyPassPhrase,label:e.$gettext("SFTP Private Key Pass Phrase")},null,8,["field","label"]),r(c,{id:"form_edit_sftpPrivateKey",class:"col-md-12","input-type":"textarea",field:t(o).sftpPrivateKey,label:e.$gettext("SFTP Private Key")},null,8,["field","label"])])]),_:1},8,["label","item-header-class"]))}}),ye={class:"row g-3"},Se=A({__name:"S3",setup(v){const d=T(),{r$:o}=w(d),a=D(S(()=>o.value.$groups.s3Tab));return(e,h)=>(g(),y(F,{label:e.$gettext("Remote: S3 Compatible"),"item-header-class":t(a)},{default:b(()=>[l("div",ye,[r(c,{id:"form_edit_s3CredentialKey",class:"col-md-6",field:t(o).s3CredentialKey,label:e.$gettext("Access Key ID")},null,8,["field","label"]),r(c,{id:"form_edit_s3CredentialSecret",class:"col-md-6",field:t(o).s3CredentialSecret,label:e.$gettext("Secret Key")},null,8,["field","label"]),r(c,{id:"form_edit_s3Bucket",class:"col-md-6",field:t(o).s3Bucket,label:e.$gettext("Bucket Name")},null,8,["field","label"]),r(c,{id:"form_edit_s3Region",class:"col-md-6",field:t(o).s3Region,label:e.$gettext("Region")},null,8,["field","label"]),r(c,{id:"form_edit_s3Endpoint",class:"col-md-6",field:t(o).s3Endpoint,label:e.$gettext("Endpoint")},null,8,["field","label"]),r(c,{id:"form_edit_s3Version",class:"col-md-6",field:t(o).s3Version,label:e.$gettext("API Version")},null,8,["field","label"]),r(ie,{id:"form_edit_s3UsePathStyle",class:"col-md-12",field:t(o).s3UsePathStyle,label:e.$gettext("Use Path Instead of Subdomain Endpoint Style"),description:e.$gettext("Enable this option if your S3 provider is using paths instead of sub-domains for their S3 endpoint; for example, when using MinIO or with other self-hosted S3 storage solutions that are accessible via a path on a domain/IP instead of a subdomain."),advanced:""},null,8,["field","label","description"])])]),_:1},8,["label","item-header-class"]))}}),$e={class:"row g-3"},xe={class:"col-md-12"},Pe={href:"https://www.dropbox.com/developers/apps",target:"_blank"},ke={class:"col-md-12"},Ae=["href"],Ce="https://www.dropbox.com/oauth2/authorize",Ue=A({__name:"Dropbox",setup(v){const d=T(),{r$:o,form:a}=w(d),e=D(S(()=>o.value.$groups.dropboxTab)),h=S(()=>{const i=new URLSearchParams,s=a.value?.dropboxAppKey;return s&&i.append("client_id",s),i.append("response_type","code"),i.append("token_access_type","offline"),Ce+"?"+i.toString()});return(i,s)=>(g(),y(F,{label:i.$gettext("Remote: Dropbox"),"item-header-class":t(e)},{default:b(()=>[l("div",$e,[l("div",xe,[l("h3",null,p(i.$gettext("Dropbox Setup Instructions")),1),l("ul",null,[l("li",null,[k(p(i.$gettext("Visit the Dropbox App Console:")),1),s[0]||(s[0]=l("br",null,null,-1)),l("a",Pe,p(i.$gettext("Dropbox App Console")),1)]),l("li",null,p(i.$gettext('Create a new application. Choose "Scoped Access", select your preferred level of access, then name your app. Do not name it "AzuraCast", but rather use a name specific to your installation.')),1),l("li",null,p(i.$gettext("Enter your app secret and app key below.")),1)])]),r(c,{id:"form_edit_dropboxAppKey",class:"col-md-6",field:t(o).dropboxAppKey,label:i.$gettext("App Key")},null,8,["field","label"]),r(c,{id:"form_edit_dropboxAppSecret",class:"col-md-6",field:t(o).dropboxAppSecret,label:i.$gettext("App Secret")},null,8,["field","label"]),l("div",ke,[l("ul",null,[l("li",null,[k(p(i.$gettext("Visit the link below to sign in and generate an access code:")),1),s[1]||(s[1]=l("br",null,null,-1)),l("a",{href:h.value,target:"_blank"},p(i.$gettext("Generate Access Code")),9,Ae)]),l("li",null,p(i.$gettext("Enter the access code you receive below.")),1)])]),r(c,{id:"form_edit_dropboxAuthToken",class:"col-md-12",field:t(o).dropboxAuthToken,label:i.$gettext("Access Code")},null,8,["field","label"])])]),_:1},8,["label","item-header-class"]))}}),we=A({__name:"EditModal",props:{createUrl:{},type:{}},emits:["relist"],setup(v,{expose:d,emit:o}){const a=v,e=o,h=J("$modal"),i=T(),{form:s,r$:P}=w(i),{$reset:K}=i,{loading:L,error:B,isEditMode:V,clearContents:M,create:I,edit:H,doSubmit:Q,close:u}=X(se(a,"createUrl"),e,h,K,$=>{P.value.$reset({toState:ne(P.value.$value,$)})},async $=>{const{valid:m}=await P.value.$validate();return m?$?{valid:m,data:s.value}:{valid:m,data:{...s.value,type:a.type}}:{valid:m}}),{$gettext:C}=G(),n=S(()=>V.value?C("Edit Storage Location"):C("Add Storage Location"));return d({create:I,edit:H,close:u}),($,m)=>(g(),y(Z,{ref_key:"$modal",ref:h,loading:t(L),title:n.value,error:t(B),"disable-save-button":t(P).$invalid,onSubmit:t(Q),onHidden:t(M)},{default:b(()=>[r(te,{"content-class":"mt-3"},{default:b(()=>[r(ge,{form:t(s),"onUpdate:form":m[0]||(m[0]=x=>R(s)?s.value=x:null)},null,8,["form"]),t(s).adapter==="s3"?(g(),y(Se,{key:0,form:t(s),"onUpdate:form":m[1]||(m[1]=x=>R(s)?s.value=x:null)},null,8,["form"])):E("",!0),t(s).adapter==="dropbox"?(g(),y(Ue,{key:1,form:t(s),"onUpdate:form":m[2]||(m[2]=x=>R(s)?s.value=x:null)},null,8,["form"])):E("",!0),t(s).adapter==="sftp"?(g(),y(he,{key:2,form:t(s),"onUpdate:form":m[3]||(m[3]=x=>R(s)?s.value=x:null)},null,8,["form"])):E("",!0)]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}}),Te={class:"card-body pb-0"},Ke={class:"nav nav-tabs",role:"tablist"},Re=["onClick"],Ee={class:"card-body buttons"},Fe={class:"btn-group btn-group-sm"},De=["onClick"],Le=["onClick"],Be={class:"m-0"},Ve={class:"card-text"},Me=["aria-label","aria-valuenow"],At=A({__name:"StorageLocations",setup(v){const d=j(U.StationMedia),o=me("/admin/storage_locations"),a=S(()=>o.value+"?type="+d.value),{$gettext:e}=G(),h=[{key:"adapter",label:e("Adapter"),sortable:!1},{key:"space",label:e("Space Used"),class:"text-nowrap",sortable:!1},{key:"stations",label:e("Station(s)"),sortable:!1},{key:"actions",label:e("Actions"),class:"shrink",sortable:!1}],i=be(a,[fe.AdminStorageLocations,d]),s=()=>{i.refresh()},P=[{type:U.StationMedia,title:e("Station Media")},{type:U.StationRecordings,title:e("Station Recordings")},{type:U.StationPodcasts,title:e("Station Podcasts")},{type:U.Backup,title:e("Backups")}],K=J("$editModal"),{doCreate:L,doEdit:B}=pe(K),V=u=>{d.value=u},M=u=>{switch(u){case _.Local:return e("Local");case _.S3:return e("Remote: S3 Compatible");case _.Dropbox:return e("Remote: Dropbox");case _.Sftp:return e("Remote: SFTP")}},I=u=>u.storageAvailable?u.storageUsed+" / "+u.storageAvailable:u.storageUsed,H=u=>u===null?"":u>85?"text-bg-danger":u>65?"text-bg-warning":"text-bg-primary",{doDelete:Q}=ce(e("Delete Storage Location?"),()=>s());return(u,C)=>(g(),N(O,null,[r(ue,{"header-id":"hdr_storage_locations",title:t(e)("Storage Locations")},{default:b(()=>[l("div",Te,[l("nav",Ke,[(g(),N(O,null,le(P,n=>l("div",{key:n.type,class:"nav-item",role:"presentation"},[l("button",{class:q(["nav-link",d.value===n.type?"active":""]),type:"button",role:"tab",onClick:$=>V(n.type)},p(n.title),11,Re)])),64))])]),l("div",Ee,[r(de,{text:t(e)("Add Storage Location"),onClick:t(L)},null,8,["text","onClick"])]),r(W,{id:"admin_storage_locations","show-toolbar":!1,fields:h,provider:t(i)},{"cell(actions)":b(({item:n})=>[l("div",Fe,[l("button",{type:"button",class:"btn btn-primary",onClick:$=>t(B)(n.links.self)},p(t(e)("Edit")),9,De),l("button",{type:"button",class:"btn btn-danger",onClick:$=>t(Q)(n.links.self)},p(t(e)("Delete")),9,Le)])]),"cell(adapter)":b(({item:n})=>[l("h5",Be,p(M(n.adapter)),1),l("p",Ve,p(n.uri),1)]),"cell(stations)":b(({item:n})=>[k(p(n.stations?.join(", ")),1)]),"cell(space)":b(({item:n})=>[n.storageAvailable?(g(),N("div",{key:0,class:"progress h-20 mb-3",role:"progressbar","aria-label":n.storageUsedPercent+"%","aria-valuenow":n.storageUsedPercent??void 0,"aria-valuemin":"0","aria-valuemax":"100"},[l("div",{class:q(["progress-bar",H(n.storageUsedPercent)]),style:re({width:n.storageUsedPercent+"%"})},p(n.storageUsedPercent)+"% ",7)],8,Me)):E("",!0),k(" "+p(I(n)),1)]),_:1},8,["provider"])]),_:1},8,["title"]),r(we,{ref_key:"$editModal",ref:K,"create-url":t(o),type:d.value,onRelist:C[0]||(C[0]=()=>s())},null,8,["create-url","type"])],64))}});export{At as default};
