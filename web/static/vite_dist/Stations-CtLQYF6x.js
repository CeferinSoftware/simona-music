import{_ as K}from"./DataTable-BhAO7RbG.js";import{_ as O}from"./StationForm-C9h2magr.js";import{I as W}from"./InvisibleSubmitButton-NGv_v7G8.js";import{g as T,f as V,u as q,R as j,a5 as G}from"./layout-CUzOT8aY.js";import{_ as X,u as z}from"./useHasModal-Bq3QxExQ.js";import{d as N,r as A,q as w,g as D,m as E,o as M,e as u,b as p,p as F,u as t,a as r,t as m,s as Q,i as U,f as Y,c as Z}from"./vue-BsfewpWM.js";import{u as tt,r as et}from"./regle-hGsoY2W9.js";import{_ as ot}from"./ModalForm-D0z4l5nm.js";import{u as st}from"./useResettableRef-BwkDrsai.js";import{_ as at}from"./FormGroupMultiCheck-z3kTFzdV.js";import{_ as P}from"./FormGroupField-K9S4Sadl.js";import{u as nt,_ as it}from"./AddButton-DLx8r-7e.js";import{u as lt}from"./useConfirmAndDelete-CuQodV6V.js";import{_ as rt}from"./CardPage-Cth3uewv.js";import{g as I,a as ct,Q as H}from"./useStationQuery-ClAZEJp_.js";import{u as mt}from"./useApiItemProvider-DAIhDonu.js";import{_ as dt}from"./Loading-CQdAiB8R.js";import{g as L}from"./iteratee-DJRL6CbS.js";import"./icons-BAjd3tML.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./estoolkit-DCzBkaPJ.js";import"./isArrayLike-DknTMkCU.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./FormFieldset-DUBDY7k3.js";import"./FormGroupCheckbox-ZsJmXmB6.js";import"./ValidationError-DsAp6Fjg.js";import"./FormGroup-DXDHSoyc.js";import"./FormGroupSelect-Cp69W3Gu.js";import"./Tabs-DMTPhsiO.js";import"./RadioWithCustomNumber-B3JRVqX_.js";import"./find-B-AZI_Kz.js";import"./useFormTabClass-DgI07GN4.js";import"./FormMarkup-DqBjuQjX.js";import"./BitrateOptions-CGWdTyiI.js";import"./mergeExisting-B6FvxI3v.js";import"./acl-BtcXS2wX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./zxcvbn-Bgw4VUEj.js";import"./useSlotsExcept-Dp0PSXNw.js";import"./InfoCard-D5Q671bF.js";import"./vue-router-Cafqdr3I.js";const ut=N({inheritAttrs:!1,__name:"EditModal",props:{createUrl:{},timezones:{},countries:{},isRsasInstalled:{type:Boolean},isShoutcastInstalled:{type:Boolean},isStereoToolInstalled:{type:Boolean}},emits:["relist"],setup(R,{expose:y,emit:S}){const g=R,d=S,l=A(null),o=A(!0),f=w(()=>l.value!==null),{$gettext:c}=T(),i=w(()=>f.value?c("Edit Station"):c("Add Station")),_=D("$modal"),{show:k,hide:b}=z(_),s=e=>{o.value=!e},C=()=>{l.value=null,k()},h=e=>{l.value=e,k()},v=D("$form"),x=()=>{v.value?.reset()},B=()=>{d("relist"),b()},n=()=>{v.value?.submit()},a=()=>{l.value=null};return y({create:C,edit:h}),(e,$)=>(M(),E(X,{id:"station_edit_modal",ref_key:"$modal",ref:_,size:"lg",title:i.value,busy:!1,onShown:x,onHidden:a},{"modal-footer":u(()=>[r("button",{class:"btn btn-secondary",type:"button",onClick:$[0]||($[0]=(...J)=>t(b)&&t(b)(...J))},m(t(c)("Close")),1),r("button",{class:Q(["btn",o.value?"btn-danger":"btn-primary"]),type:"submit",onClick:n},m(t(c)("Save Changes")),3)]),default:u(()=>[p(O,F(g,{ref_key:"$form",ref:v,"is-modal":"","create-url":e.createUrl,"edit-url":l.value,"is-edit-mode":f.value,onError:t(b),onSubmitted:B,onValidUpdate:s}),{submitButton:u(()=>[p(W)]),_:1},16,["create-url","edit-url","is-edit-mode","onError"])]),_:1},8,["title"]))}}),pt={class:"row g-3"},ft=N({__name:"CloneModal",emits:["relist"],setup(R,{expose:y,emit:S}){const g=S,d=A(!0),l=A(null),o=A(null),{record:f,reset:c}=st({name:"",description:"",clone:[]}),{r$:i}=tt(f,{name:{required:et},description:{},clone:{}},{}),_=D("$modal"),{hide:k,show:b}=z(_),{$gettext:s}=T(),C=(a,e)=>{c(),i.$reset(),f.value.name=s("%{station} - Copy",{station:a}),d.value=!1,o.value=null,l.value=e,b()},h=()=>{c(),l.value=null},{notifySuccess:v}=V(),{axios:x}=q(),B=w(()=>[{text:s("Share Media Storage Location"),value:"media_storage"},{text:s("Share Recordings Storage Location"),value:"recordings_storage"},{text:s("Share Podcasts Storage Location"),value:"podcasts_storage"},{text:s("Playlists"),value:"playlists"},{text:s("Mount Points"),value:"mounts"},{text:s("Remote Relays"),value:"remotes"},{text:s("Streamers/DJs"),value:"streamers"},{text:s("User Permissions"),value:"permissions"},{text:s("Web Hooks"),value:"webhooks"}]),n=async()=>{const{valid:a}=await i.$validate();if(a){o.value=null;try{const e=l.value;if(e===null)return;await x({method:"POST",url:e,data:f.value}),v(),g("relist"),k()}catch(e){o.value=j(e)}}};return y({create:C}),(a,e)=>(M(),E(ot,{ref_key:"$modal",ref:_,loading:d.value,title:t(s)("Clone Station"),error:o.value,"disable-save-button":t(i).$invalid,onSubmit:n,onHidden:h},{default:u(()=>[r("div",pt,[p(P,{id:"edit_form_name",class:"col-md-12",field:t(i).name,label:t(s)("New Station Name")},null,8,["field","label"]),p(P,{id:"edit_form_description",class:"col-md-12",field:t(i).description,"input-type":"textarea",label:t(s)("New Station Description")},null,8,["field","label"]),p(at,{id:"edit_form_clone",class:"col-md-12",field:t(i).clone,options:B.value,stacked:"",label:t(s)("Copy to New Station")},null,8,["field","options","label"])])]),_:1},8,["loading","title","error","disable-save-button"]))}}),_t={class:"typography-subheading"},bt={key:0,class:"badge text-bg-secondary"},vt={class:"btn-group btn-group-sm"},yt=["href"],gt=["onClick"],kt=["onClick"],$t=["onClick"],St=["onClick"],ve=N({__name:"Stations",setup(R){const y=I("/admin/stations"),S=I("/admin/vue/stations"),{axios:g}=q(),{data:d,isLoading:l}=ct({queryKey:[H.AdminStations,"props"],queryFn:async({signal:n})=>{const{data:a}=await g.get(S.value,{signal:n});return a}}),{$gettext:o}=T(),f=[{key:"name",isRowHeader:!0,label:o("Name"),sortable:!0},{key:"frontend_type",label:o("Broadcasting"),sortable:!1,formatter:n=>L(d.value?.frontendTypes,[n,"name"],"")},{key:"backend_type",label:o("AutoDJ"),sortable:!1,formatter:n=>L(d.value?.backendTypes,[n,"name"],"")},{key:"actions",label:o("Actions"),sortable:!1,class:"shrink"}],c=mt(y,[H.AdminStations,"data"]),i=()=>{c.refresh()},_=D("$editModal"),{doCreate:k,doEdit:b}=nt(_),s=D("$cloneModal"),C=(n,a)=>{s.value?.create(n,a)},{showAlert:h}=G(),{notifySuccess:v}=V(),x=async n=>{const{value:a}=await h(n.is_enabled?{title:o("Disable station?"),confirmButtonText:o("Disable"),confirmButtonClass:"btn-warning",focusCancel:!0}:{title:o("Enable station?"),confirmButtonText:o("Enable"),confirmButtonClass:"btn-success",focusCancel:!1});if(!a)return;const{data:e}=await g.put(n.links.self,{is_enabled:!n.is_enabled});v(e.message),i()},{doDelete:B}=lt(o("Delete Station?"),()=>i());return(n,a)=>(M(),E(dt,{loading:t(l),lazy:""},{default:u(()=>[p(rt,{title:t(o)("Stations")},{actions:u(()=>[p(it,{text:t(o)("Add Station"),onClick:t(k)},null,8,["text","onClick"])]),default:u(()=>[p(K,{id:"stations",paginated:"",fields:f,provider:t(c)},{"cell(name)":u(({item:e})=>[r("div",_t,[Y(m(e.name)+" ",1),e.is_enabled?U("",!0):(M(),Z("span",bt,m(t(o)("Disabled")),1))]),r("code",null,m(e.short_name),1)]),"cell(actions)":u(e=>[r("div",vt,[r("a",{class:"btn btn-secondary",href:e.item.links.manage,target:"_blank"},m(t(o)("Manage")),9,yt),r("button",{type:"button",class:"btn btn-secondary",onClick:$=>C(e.item.name,e.item.links.clone)},m(t(o)("Clone")),9,gt),r("button",{type:"button",class:Q(["btn btn-sm",e.item.is_enabled?"btn-warning":"btn-success"]),onClick:$=>x(e.item)},m(e.item.is_enabled?t(o)("Disable"):t(o)("Enable")),11,kt),r("button",{type:"button",class:"btn btn-primary",onClick:$=>t(b)(e.item.links.self)},m(t(o)("Edit")),9,$t),r("button",{type:"button",class:"btn btn-danger",onClick:$=>t(B)(e.item.links.self)},m(t(o)("Delete")),9,St)])]),_:1},8,["provider"])]),_:1},8,["title"]),t(d)?(M(),E(ut,F({key:0},t(d).formProps,{ref_key:"$editModal",ref:_,"create-url":t(y),onRelist:a[0]||(a[0]=()=>i())}),null,16,["create-url"])):U("",!0),p(ft,{ref_key:"$cloneModal",ref:s,onRelist:a[1]||(a[1]=()=>i())},null,512)]),_:1},8,["loading"]))}});export{ve as default};
