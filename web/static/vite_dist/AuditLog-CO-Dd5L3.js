import{g as I,j as T}from"./layout-CUzOT8aY.js";import{_ as U}from"./DataTable-BhAO7RbG.js";import{_ as V}from"./DateRangeDropdown-7SFZkkqA.js";import{_ as y,W as L,X as w,Y as M}from"./icons-BAjd3tML.js";import{_ as N,u as R}from"./useHasModal-Bq3QxExQ.js";import{d as D,g as x,r as C,m as O,o,e as p,a as e,t as s,c as r,F as b,D as P,q as B,b as u,u as l,i as H,f as k}from"./vue-BsfewpWM.js";import{_ as J}from"./CardPage-Cth3uewv.js";import{u as z}from"./luxon-m3VuE4xT.js";import{g as E,Q as F}from"./useStationQuery-ClAZEJp_.js";import{u as Q}from"./useApiItemProvider-DAIhDonu.js";import"./leaflet-DkUWBo0d.js";import"./estoolkit-DCzBkaPJ.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./isArrayLike-DknTMkCU.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./theme-BQjAlSn5.js";import"./Loading-CQdAiB8R.js";import"./InfoCard-D5Q671bF.js";import"./luxon-F75Z0klY.js";import"./vue-router-Cafqdr3I.js";const j={class:"table table-bordered table-responsive"},q={class:"changes"},K={class:"changes"},W=D({__name:"DetailsModal",setup(A,{expose:h}){const i=x("$modal"),{show:m}=R(i),a=C(null);return h({open:d=>{a.value=d,m()}}),(d,g)=>(o(),O(N,{id:"audit_log_details",ref_key:"$modal",ref:i,title:d.$gettext("Changes"),size:"xl"},{default:p(()=>[e("table",j,[g[0]||(g[0]=e("colgroup",null,[e("col",{width:"30%"}),e("col",{width:"35%"}),e("col",{width:"35%"})],-1)),e("thead",null,[e("tr",null,[e("th",null,s(d.$gettext("Field Name")),1),e("th",null,s(d.$gettext("Previous")),1),e("th",null,s(d.$gettext("Updated")),1)])]),e("tbody",null,[(o(!0),r(b,null,P(a.value,f=>(o(),r("tr",{key:f.field},[e("td",null,s(f.field),1),e("td",null,[e("pre",q,s(f.from),1)]),e("td",null,[e("pre",K,s(f.to),1)])]))),128))])])]),_:1},8,["title"]))}}),X={class:"d-flex align-items-center"},Y=["id"],G={class:"flex-shrink"},Z=["title"],ee=["title"],te=["title"],ae=["onClick"],Ue=D({__name:"AuditLog",setup(A){const h=E("/admin/auditlog"),{DateTime:i}=z(),m=C({startDate:i.now().minus({days:13}).toJSDate(),endDate:i.now().toJSDate()}),{$gettext:a}=I(),{timeConfig:$}=T(),d=[{key:"timestamp",label:a("Date/Time"),sortable:!1,formatter:c=>i.fromISO(c).toLocaleString({...i.DATETIME_SHORT,...$})},{key:"user",label:a("User"),sortable:!1},{key:"operation",isRowHeader:!0,label:a("Operation"),sortable:!1},{key:"identifier",label:a("Identifier"),sortable:!1},{key:"target",label:a("Target"),sortable:!1},{key:"actions",label:a("Actions"),sortable:!1}],g=B(()=>{const c=new URL(h.value,document.location.href),n=c.searchParams,t=i.fromJSDate(m.value.startDate);t.isValid&&n.set("start",t.toISO());const _=i.fromJSDate(m.value.endDate);return _.isValid&&n.set("end",_.toISO()),c.toString()}),f=Q(g,[F.AdminAuditLog,m]),v=x("$detailsModal"),S=c=>{v.value?.open(c)};return(c,n)=>(o(),r(b,null,[u(J,{"header-id":"hdr_audit_log"},{header:p(({id:t})=>[e("div",X,[e("h2",{id:t,class:"card-title flex-fill my-0"},s(l(a)("Audit Log")),9,Y),e("div",G,[u(V,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=_=>m.value=_),class:"btn-dark"},null,8,["modelValue"])])])]),default:p(()=>[u(U,{paginated:"",fields:d,provider:l(f)},{"cell(operation)":p(t=>[t.item.operationText==="insert"?(o(),r("span",{key:0,class:"text-success",title:l(a)("Insert")},[u(y,{class:"lg inline",icon:l(L)},null,8,["icon"])],8,Z)):t.item.operationText==="delete"?(o(),r("span",{key:1,class:"text-danger",title:l(a)("Delete")},[u(y,{class:"lg inline",icon:l(w)},null,8,["icon"])],8,ee)):(o(),r("span",{key:2,class:"text-primary",title:l(a)("Update")},[u(y,{class:"lg inline",icon:l(M)},null,8,["icon"])],8,te))]),"cell(identifier)":p(t=>[e("small",null,s(t.item.class),1),n[1]||(n[1]=e("br",null,null,-1)),k(" "+s(t.item.identifier),1)]),"cell(target)":p(t=>[t.item.target?(o(),r(b,{key:0},[e("small",null,s(t.item.targetClass),1),n[2]||(n[2]=e("br",null,null,-1)),k(" "+s(t.item.target),1)],64)):(o(),r(b,{key:1},[k(s(l(a)("N/A")),1)],64))]),"cell(actions)":p(t=>[t.item.changes.length>0?(o(),r("button",{key:0,type:"button",class:"btn btn-sm btn-primary",onClick:_=>S(t.item.changes)},s(l(a)("Changes")),9,ae)):H("",!0)]),_:1},8,["provider"])]),_:1}),u(W,{ref_key:"$detailsModal",ref:v},null,512)],64))}});export{Ue as default};
