import{_ as J}from"./DataTable-BhAO7RbG.js";import{g as I,u as W,f as j}from"./layout-CUzOT8aY.js";import{_ as x}from"./CardPage-Cth3uewv.js";import{u as X}from"./luxon-m3VuE4xT.js";import{_ as Y,u as Z}from"./useHasModal-Bq3QxExQ.js";import{d as S,c,o as i,F as g,D as T,a as t,i as L,f as tt,s as et,t as a,u as s,g as M,r as st,m as O,e as l,b as m}from"./vue-BsfewpWM.js";import{a as at,_ as nt}from"./Tabs-DMTPhsiO.js";import{g as $,a as q,Q as N,b as ot}from"./useStationQuery-ClAZEJp_.js";import{_ as U}from"./Loading-CQdAiB8R.js";import{_ as B,A as F}from"./icons-BAjd3tML.js";import{u as lt}from"./useQueryItemProvider-RNAxJE6j.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./estoolkit-DCzBkaPJ.js";import"./isArrayLike-DknTMkCU.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./InfoCard-D5Q671bF.js";import"./luxon-F75Z0klY.js";import"./vue-router-Cafqdr3I.js";import"./useClientItemProvider-Ds0yxtsG.js";const it=["id"],rt={class:"mb-0"},ct={key:0,class:"buttons mt-3"},dt=["data-bs-target","aria-controls"],ut=["id","aria-labelledby"],mt={class:"card-body pb-0"},_t=S({__name:"TaskOutput",props:{logs:{}},setup(w){const f={100:"text-bg-info",200:"text-bg-info",250:"text-bg-info",300:"text-bg-warning",400:"text-bg-danger",500:"text-bg-danger",550:"text-bg-danger",600:"text-bg-danger"},v=_=>f[_]??f[100],{$gettext:d}=I(),p={100:d("Debug"),200:d("Info"),250:d("Notice"),300:d("Warning"),400:d("Error"),500:d("Critical"),550:d("Alert"),600:d("Emergency")},Q=_=>p[_]??p[100],e=_=>JSON.stringify(_);return(_,D)=>(i(!0),c(g,null,T(_.logs,(r,b)=>(i(),c("div",{id:"log-view",key:b,class:"card mb-3"},[t("div",{id:"log-row-"+b,class:"card-header"},[t("h4",rt,[t("span",{class:et(["badge",v(r.level)])},a(Q(r.level)),3),tt(" "+a(r.message),1)]),r.context||r.extra?(i(),c("div",ct,[t("button",{class:"btn btn-sm btn-bg",type:"button","data-bs-toggle":"collapse","data-bs-target":"#detail-row-"+b,"aria-controls":"detail-row-"+b},a(s(d)("Details")),9,dt)])):L("",!0)],8,it),r.context||r.extra?(i(),c("div",{key:0,id:"detail-row-"+b,class:"collapse","aria-labelledby":"log-row-"+b,"data-parent":"#log-view"},[t("div",mt,[t("dl",null,[(i(!0),c(g,null,T(r.context,(k,y)=>(i(),c(g,{key:y},[t("dt",null,a(y),1),t("dd",null,a(e(k)),1)],64))),128)),(i(!0),c(g,null,T(r.extra,(k,y)=>(i(),c(g,{key:y},[t("dt",null,a(y),1),t("dd",null,a(e(k)),1)],64))),128))])])],8,ut)):L("",!0)]))),128))}}),bt={style:{"max-height":"300px","overflow-y":"scroll"}},gt=S({__name:"TaskOutputModal",setup(w,{expose:f}){const v=M("$modal"),{show:d}=Z(v),p=st([]);return f({open:e=>{p.value=e,d()}}),(e,_)=>(i(),O(Y,{ref_key:"$modal",ref:v,title:e.$gettext("Log Output"),size:"lg"},{default:l(()=>[t("div",bt,[m(_t,{logs:p.value},null,8,["logs"])])]),_:1},8,["title"]))}}),pt={class:"outside-card-header mb-1"},yt={class:"row row-of-cards"},ht={class:"col-md-6"},ft={class:"card-body"},vt={class:"card-text"},kt={class:"col-md-6"},Ct={class:"card-body"},xt={class:"card-text"},$t={class:"d-md-flex align-items-center"},Tt={class:"flex-fill my-0"},Qt=["id"],qt={class:"flex-shrink buttons mt-2 mt-md-0"},Nt={key:0},St={key:1},wt=["onClick"],Dt={class:"d-md-flex align-items-center"},Rt={class:"flex-fill my-0"},At=["id"],Lt={class:"flex-shrink buttons mt-2 mt-md-0"},Ut={class:"card-body"},Bt={class:"row"},Ft={class:"mb-0"},It={class:"buttons"},Mt=["onClick"],Ot={class:"card-body"},zt={class:"row"},Kt={class:"col-md-4"},Pt={class:"buttons"},Vt=["onClick"],Et=["onClick"],Gt={class:"col-md-4"},Ht={class:"buttons"},Jt=["onClick"],Ce=S({__name:"Debug",setup(w){const f=$("/admin/debug/sync-tasks"),v=$("/admin/debug/queues"),d=$("/admin/debug/stations"),p=$("/admin/debug/clear-cache"),Q=$("/admin/debug/clear-queue"),{$gettext:e}=I(),{timestampToRelative:_}=X(),D=[{key:"name",isRowHeader:!0,label:e("Task Name"),sortable:!0},{key:"time",label:e("Last Run"),formatter:u=>u===0?e("Not Run"):_(u),sortable:!0},{key:"nextRun",label:e("Next Run"),formatter:u=>_(u),sortable:!0},{key:"actions",label:e("Actions")}],{axios:r}=W(),b=q({queryKey:[N.AdminDebug,"syncTasks"],queryFn:async({signal:u})=>{const{data:o}=await r.get(f.value,{signal:u});return o},refetchInterval:6e4}),k=lt(b),y=()=>{k.refresh()},{data:z,isLoading:K,refetch:P}=q({queryKey:[N.AdminDebug,"queueTotals"],queryFn:async({signal:u})=>{const{data:o}=await r.get(v.value,{signal:u});return o},refetchInterval:6e4}),{data:V,isLoading:E}=q({queryKey:[N.AdminDebug,"stations"],queryFn:async({signal:u})=>{const{data:o}=await r.get(d.value,{signal:u});return o}}),R=M("$modal"),{notifySuccess:A}=j(),h=async u=>{const{data:o}=await r.put(u);o.logs?R.value?.open(o.logs):A(o.message)},G=ot(),H=async()=>{await G.invalidateQueries(),A(e("Client-side cache cleared!"))};return(u,o)=>(i(),c(g,null,[t("h2",pt,a(s(e)("System Debugger")),1),t("div",yt,[t("div",ht,[m(x,{"header-id":"hdr_clear_cache",title:s(e)("Clear Cache")},{footer_actions:l(()=>[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:o[0]||(o[0]=n=>h(s(p)))},a(s(e)("Clear Server Cache")),1),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:H},a(s(e)("Clear Client Cache")),1)]),default:l(()=>[t("div",ft,[t("p",vt,a(s(e)("Clearing the application cache may log you out of your session.")),1)])]),_:1},8,["title"])]),t("div",kt,[m(x,{"header-id":"hdr_clear_queues",title:s(e)("Clear All Message Queues")},{footer_actions:l(()=>[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:o[1]||(o[1]=n=>h(s(Q)))},a(s(e)("Clear All Message Queues")),1)]),default:l(()=>[t("div",Ct,[t("p",xt,a(s(e)("This will clear any pending unprocessed messages in all message queues.")),1)])]),_:1},8,["title"])])]),m(x,{class:"mb-3","header-id":"hdr_sync_tasks"},{header:l(({id:n})=>[t("div",$t,[t("div",Tt,[t("h2",{id:n,class:"card-title"},a(s(e)("Synchronization Tasks")),9,Qt)]),t("div",qt,[t("button",{type:"button",class:"btn btn-dark",onClick:o[2]||(o[2]=C=>y())},[m(B,{icon:s(F)},null,8,["icon"]),t("span",null,a(s(e)("Refresh")),1)])])])]),default:l(()=>[m(J,{fields:D,provider:s(k),"show-toolbar":!1},{"cell(name)":l(n=>[t("h5",null,a(n.item.task),1),n.item.pattern?(i(),c("span",Nt,a(n.item.pattern),1)):(i(),c("span",St,a(s(e)("Custom")),1))]),"cell(actions)":l(n=>[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:C=>h(n.item.url)},a(s(e)("Run Task")),9,wt)]),_:1},8,["provider"])]),_:1}),m(x,{class:"mb-3","header-id":"hdr_message_queues"},{header:l(({id:n})=>[t("div",Dt,[t("div",Rt,[t("h2",{id:n,class:"card-title"},a(s(e)("Message Queues")),9,At)]),t("div",Lt,[t("button",{type:"button",class:"btn btn-dark",onClick:o[3]||(o[3]=C=>s(P)())},[m(B,{icon:s(F)},null,8,["icon"]),t("span",null,a(s(e)("Refresh")),1)])])])]),default:l(()=>[t("div",Ut,[m(U,{loading:s(K)},{default:l(()=>[t("div",Bt,[(i(!0),c(g,null,T(s(z)??[],n=>(i(),c("div",{key:n.name,class:"col"},[t("h5",Ft,a(n.name),1),t("p",null,a(s(e)("%{messages} queued messages",{messages:n.count})),1),t("div",It,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:C=>h(n.url)},a(s(e)("Clear Queue")),9,Mt)])]))),128))])]),_:1},8,["loading"])])]),_:1}),m(x,{"header-id":"hdr_station_debugging",title:s(e)("Station-Specific Debugging")},{default:l(()=>[t("div",Ot,[m(U,{loading:s(E),lazy:""},{default:l(()=>[m(at,null,{default:l(()=>[(i(!0),c(g,null,T(s(V)??[],n=>(i(),O(nt,{key:n.id,label:n.name},{default:l(()=>[t("h3",null,a(n.name),1),t("div",zt,[t("div",Kt,[t("h5",null,a(s(e)("AutoDJ Queue")),1),t("div",Pt,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:C=>h(n.clearQueueUrl)},a(s(e)("Clear Queue")),9,Vt),t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:C=>h(n.getNextSongUrl)},a(s(e)("Get Next Song")),9,Et)])]),t("div",Gt,[t("h5",null,a(s(e)("Get Now Playing")),1),t("div",Ht,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:C=>h(n.getNowPlayingUrl)},a(s(e)("Run Task")),9,Jt)])])])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["loading"])])]),_:1},8,["title"]),m(gt,{ref_key:"$modal",ref:R},null,512)],64))}});export{Ce as default};
