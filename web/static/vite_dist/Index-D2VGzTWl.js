import{w as H,_ as U}from"./icons-BAjd3tML.js";import{u as V,f as R}from"./layout-CUzOT8aY.js";import{g as N,a as D,Q as O}from"./useStationQuery-ClAZEJp_.js";import{u as q}from"./menu-CymKRDlS.js";import{u as W,_ as z}from"./useHasModal-Bq3QxExQ.js";import{d as w,g as C,m as $,o as i,e as p,a as e,f as g,t as s,k as F,u as d,c as m,b as h,E as v,F as f,D as k,i as S,s as K,q as M,j as B}from"./vue-BsfewpWM.js";import{d as P,c as Q,z as E}from"./estoolkit-DCzBkaPJ.js";import{_ as G}from"./RunningBadge-BHzAwYQE.js";import{_ as x}from"./Loading-CQdAiB8R.js";import{_ as J,a as X}from"./Tabs-DMTPhsiO.js";import{c as Y,t as Z,d as j,g as L}from"./iteratee-DJRL6CbS.js";import{_ as ee}from"./DashboardNoSidebar-Cg7D8DtY.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./vue-router-Cafqdr3I.js";import"./acl-BtcXS2wX.js";import"./filterMenu-BX5NScds.js";import"./map-Caxea7Kw.js";import"./isArrayLike-DknTMkCU.js";import"./PanelFooter-D_-n9Oyr.js";function T(c,o){if(c==null)return!0;switch(typeof o){case"symbol":case"number":case"object":{if(Array.isArray(o))return I(c,o);if(typeof o=="number"?o=j(o):typeof o=="object"&&(Object.is(o?.valueOf(),-0)?o="-0":o=String(o)),P(o))return!1;if(c?.[o]===void 0)return!0;try{return delete c[o],!0}catch{return!1}}case"string":{if(c?.[o]===void 0&&Y(o))return I(c,Z(o));if(P(o))return!1;try{return delete c[o],!0}catch{return!1}}}}function I(c,o){const r=L(c,o.slice(0,-1),c),n=o[o.length-1];if(r?.[n]===void 0)return!0;if(P(n))return!1;try{return delete r[n],!0}catch{return!1}}function te(c,...o){if(c==null)return{};const r=Q(c);for(let n=0;n<o.length;n++){let a=o[n];switch(typeof a){case"object":{Array.isArray(a)||(a=Array.from(a));for(let t=0;t<a.length;t++){const l=a[t];T(r,l)}break}case"string":case"symbol":case"number":{T(r,a);break}}}return r}const se={class:"mb-2"},ae={class:"ms-4"},oe={class:"mb-2"},le={class:"ms-4"},re={class:"mb-1"},ne=w({__name:"CpuStatsHelpModal",setup(c,{expose:o}){const r=C("$modal"),{show:n,hide:a}=W(r);return o({create:n,close:a}),(t,l)=>(i(),$(z,{id:"cpu_stats_help_modal",ref_key:"$modal",ref:r,size:"lg",centered:"",title:t.$gettext("CPU Stats Help")},{"modal-footer":p(()=>[F(t.$slots,"modal-footer",{},()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:l[0]||(l[0]=(...u)=>d(a)&&d(a)(...u))},s(t.$gettext("Close")),1)])]),default:p(()=>[e("div",se,[e("h6",null,[l[1]||(l[1]=e("span",{class:"badge text-bg-danger me-1"},"  ",-1)),g(" "+s(t.$gettext("Steal (St)"))+": "+s(t.$gettext("Time stolen by other virtual machines on the same physical server.")),1)]),e("div",ae,[e("p",null,s(t.$gettext('Most hosting providers will put more Virtual Machines (VPSes) on a server than the hardware can handle when each VM is running at full CPU load. This is called over-provisioning, which can lead to other VMs on the server "stealing" CPU time from your VM and vice-versa.')),1),e("p",null,s(t.$gettext(`To alleviate this potential problem with shared CPU resources, hosts assign "credits" to a VPS which are used up according to an algorithm based on the CPU load as well as the time over which the CPU load is generated. If your VM's assigned credit is used up, they will take CPU time from your VM and assign it to other VMs on the machine. This is seen as the "Steal" or "St" value.`)),1),e("p",null,s(t.$gettext("Audio transcoding applications like Liquidsoap use a consistent amount of CPU over time, which gradually drains this available credit. If you regularly see stolen CPU time, you should consider migrating to a VM that has CPU resources dedicated to your instance.")),1)])]),e("div",oe,[e("h6",null,[l[2]||(l[2]=e("span",{class:"badge text-bg-warning me-1"},"  ",-1)),g(" "+s(t.$gettext("Wait (Wa)"))+": "+s(t.$gettext("Time spent waiting for disk I/O to be completed.")),1)]),e("div",le,[e("p",null,s(t.$gettext("The I/O Wait is the percentage of time that the CPU is waiting for disk access before it can continue the work that depends on the result of this.")),1),e("p",null,s(t.$gettext("High I/O Wait can indicate a bottleneck with the server's hard disk, a potentially failing hard disk, or heavy load on the hard disk.")),1),e("p",null,s(t.$gettext("One important note on I/O Wait is that it can indicate a bottleneck or problem but also may be completely meaningless, depending on the workload and general available resources. A constantly high I/O Wait should prompt further investigation with more sophisticated tools.")),1)])]),e("div",re,[e("h6",null,[l[3]||(l[3]=e("span",{class:"badge text-bg-primary me-1"}," ",-1)),g(" "+s(t.$gettext("Use (Us)"))+": "+s(t.$gettext("The current CPU usage including I/O Wait and Steal.")),1)])])]),_:3},8,["title"]))}}),ie={class:"card"},de={class:"card-header text-bg-primary d-flex align-items-center"},ce={class:"flex-fill"},ue={class:"card-title"},me={class:"flex-shrink-0"},_e={class:"card-body"},ge={class:"mb-1 text-center"},he=["aria-label"],pe={class:"row"},be={class:"col"},ye={class:"col"},fe={class:"col"},$e={class:"row"},ve={class:"mb-1 text-center"},we=["aria-label"],ke={class:"row mb-2 mt-1"},Se={class:"col"},xe={class:"col"},Ce={class:"col"},Me={class:"card-footer"},Pe={class:"mb-1 text-center"},Ue={class:"row text-center"},Te={class:"col"},Ie={class:"col"},Ae={class:"col"},He=w({__name:"CpuStatsPanel",props:{cpuStats:{}},setup(c){const o=C("$cpuStatsHelpModal"),r=()=>{o.value?.create()},n=t=>E(t),a=t=>t+"%";return(t,l)=>(i(),m(f,null,[e("section",ie,[e("div",de,[e("div",ce,[e("h2",ue,s(t.$gettext("CPU Load")),1)]),e("div",me,[e("button",{type:"button",class:"btn btn-dark btn-sm py-2",onClick:r},[h(U,{icon:d(H)},null,8,["icon"])])])]),e("div",_e,[e("h5",ge,s(n(t.cpuStats.total.name)),1),e("div",{class:"progress h-20 mb-3 mt-2",role:"progressbar","aria-label":a(t.cpuStats.total.usage),"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar text-bg-danger",style:v({width:t.cpuStats.total.steal+"%"})},null,4),e("div",{class:"progress-bar text-bg-warning",style:v({width:t.cpuStats.total.io_wait+"%"})},null,4),e("div",{class:"progress-bar text-bg-primary",style:v({width:t.cpuStats.total.usage+"%"})},null,4)],8,he),e("div",pe,[e("div",be,[l[0]||(l[0]=e("span",{class:"badge text-bg-danger me-1"},"  ",-1)),g(" "+s(t.$gettext("Steal"))+" : "+s(t.cpuStats.total.steal)+"% ",1)]),e("div",ye,[l[1]||(l[1]=e("span",{class:"badge text-bg-warning me-1"},"  ",-1)),g(" "+s(t.$gettext("Wait"))+" : "+s(t.cpuStats.total.io_wait)+"% ",1)]),e("div",fe,[l[2]||(l[2]=e("span",{class:"badge text-bg-primary me-1"},"  ",-1)),g(" "+s(t.$gettext("Use"))+" : "+s(t.cpuStats.total.usage)+"% ",1)])]),l[3]||(l[3]=e("hr",null,null,-1)),e("div",$e,[(i(!0),m(f,null,k(t.cpuStats.cores,u=>(i(),m("div",{key:u.name,class:"col-lg-6"},[e("h6",ve,s(n(u.name)),1),e("div",{class:"progress h-20 mb-3 mt-2",role:"progressbar","aria-label":a(u.usage),"aria-valuemin":"0","aria-valuemax":"100"},[e("div",{class:"progress-bar text-bg-danger",style:v({width:u.steal+"%"})},null,4),e("div",{class:"progress-bar text-bg-warning",style:v({width:u.io_wait+"%"})},null,4),e("div",{class:"progress-bar text-bg-primary",style:v({width:u.usage+"%"})},null,4)],8,we),e("div",ke,[e("div",Se," St: "+s(u.steal)+"% ",1),e("div",xe," Wa: "+s(u.io_wait)+"% ",1),e("div",Ce," Us: "+s(u.usage)+"% ",1)])]))),128))])]),e("div",Me,[e("h6",Pe,s(t.$gettext("Load Average")),1),e("div",Ue,[e("div",Te,[l[4]||(l[4]=e("h6",null,"1-Min",-1)),g(" "+s(t.cpuStats.load[0].toFixed(2)),1)]),e("div",Ie,[l[5]||(l[5]=e("h6",null,"5-Min",-1)),g(" "+s(t.cpuStats.load[1].toFixed(2)),1)]),e("div",Ae,[l[6]||(l[6]=e("h6",null,"15-Min",-1)),g(" "+s(t.cpuStats.load[2].toFixed(2)),1)])])])]),h(ne,{ref_key:"$cpuStatsHelpModal",ref:o},null,512)],64))}}),Ve={class:"mb-2"},Ne={class:"ms-4"},De={class:"mb-2"},Oe=w({__name:"MemoryStatsHelpModal",setup(c,{expose:o}){const r=C("$modal"),{show:n,hide:a}=W(r);return o({create:n,close:a}),(t,l)=>(i(),$(z,{id:"cpu_stats_help_modal",ref_key:"$modal",ref:r,size:"lg",centered:"",title:t.$gettext("Memory Stats Help")},{"modal-footer":p(()=>[F(t.$slots,"modal-footer",{},()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:l[0]||(l[0]=(...u)=>d(a)&&d(a)(...u))},s(t.$gettext("Close")),1)])]),default:p(()=>[e("div",Ve,[e("h6",null,[l[1]||(l[1]=e("span",{class:"badge text-bg-warning me-1"},"  ",-1)),g(" "+s(t.$gettext("Cached"))+": "+s(t.$gettext("The amount of memory Linux is using for disk caching.")),1)]),e("div",Ne,[e("p",null,s(t.$gettext("This can make it look like your memory is low while it actually is not. Some monitoring solutions/panels include cached memory in their used memory statistics without indicating this.")),1),e("p",null,s(t.$gettext("Disk caching makes a system much faster and more responsive in general. It does not take memory away from applications in any way since it will automatically be released by the operating system when needed.")),1)])]),e("div",De,[e("h6",null,[l[2]||(l[2]=e("span",{class:"badge text-bg-primary me-1"},"  ",-1)),g(" "+s(t.$gettext("Used"))+": "+s(t.$gettext("The current Memory usage excluding cached memory.")),1)])])]),_:3},8,["title"]))}}),We={class:"card"},ze={class:"card-header text-bg-primary d-flex align-items-center"},Fe={class:"flex-fill"},Le={class:"card-title"},Re={class:"flex-shrink-0"},qe={class:"card-body"},Ke={class:"mb-1 text-center"},Be=["aria-label","aria-valuemax"],Qe={class:"row"},Ee={class:"col"},Ge={class:"col"},Je=w({__name:"MemoryStatsPanel",props:{memoryStats:{}},setup(c){const o=C("$memoryStatsHelpModal"),r=()=>{o.value?.create()},n=(a,t)=>Number(a)/Number(t)*100+"%";return(a,t)=>(i(),m(f,null,[e("section",We,[e("div",ze,[e("div",Fe,[e("h2",Le,s(a.$gettext("Memory")),1)]),e("div",Re,[e("button",{type:"button",class:"btn btn-dark btn-sm py-2",onClick:r},[h(U,{icon:d(H)},null,8,["icon"])])])]),e("div",qe,[e("h6",Ke,s(a.$gettext("Total RAM"))+" : "+s(a.memoryStats.total_readable),1),e("div",{class:"progress h-20 mb-3 mt-2",role:"progressbar","aria-label":a.memoryStats.used_readable,"aria-valuemin":"0","aria-valuemax":a.memoryStats.total_bytes},[e("div",{class:"progress-bar text-bg-primary",style:v({width:n(a.memoryStats.used_bytes,a.memoryStats.total_bytes)})},null,4),e("div",{class:"progress-bar text-bg-warning",style:v({width:n(a.memoryStats.cached_bytes,a.memoryStats.total_bytes)})},null,4)],8,Be),e("div",Qe,[e("div",Ee,[t[0]||(t[0]=e("span",{class:"badge text-bg-primary me-1"},"  ",-1)),g(" "+s(a.$gettext("Used"))+" : "+s(a.memoryStats.used_readable),1)]),e("div",Ge,[t[1]||(t[1]=e("span",{class:"badge text-bg-warning me-1"},"  ",-1)),g("  "+s(a.$gettext("Cached"))+" : "+s(a.memoryStats.cached_readable),1)])])])]),h(Oe,{ref_key:"$memoryStatsHelpModal",ref:o},null,512)],64))}}),Xe={class:"card"},Ye={class:"card-header text-bg-primary"},Ze={class:"card-title"},je={class:"card-body"},et={class:"mb-1 text-center"},tt=["aria-label","aria-valuemax"],st={class:"row"},at={class:"col"},ot=w({__name:"DiskUsagePanel",props:{diskStats:{}},setup(c){const o=(r,n)=>Number(r)/Number(n)*100+"%";return(r,n)=>(i(),m("section",Xe,[e("div",Ye,[e("h2",Ze,s(r.$gettext("Disk Space")),1)]),e("div",je,[e("h6",et,s(r.$gettext("Total Disk Space"))+" : "+s(r.diskStats.total_readable),1),e("div",{class:"progress h-20 mb-3 mt-2",role:"progressbar","aria-label":r.diskStats.used_readable,"aria-valuemin":"0","aria-valuemax":r.diskStats.total_bytes},[e("div",{class:"progress-bar text-bg-primary",style:v({width:o(r.diskStats.used_bytes,r.diskStats.total_bytes)})},null,4)],8,tt),e("div",st,[e("div",at,[n[0]||(n[0]=e("span",{class:"badge text-bg-primary me-1"},"  ",-1)),g(" "+s(r.$gettext("Used"))+" : "+s(r.diskStats.used_readable),1)])])])]))}}),lt={class:"card"},rt={class:"card-header text-bg-primary"},nt={class:"card-title mb-0"},it={class:"table table-striped table-responsive mb-0"},dt={class:"text-center pe-2"},ct={class:"ps-2"},ut={class:"mb-0"},mt=["onClick"],_t=w({__name:"ServicesPanel",setup(c){const o=N("/admin/services"),{axios:r,axiosSilent:n}=V(),{data:a,isLoading:t}=D({queryKey:[O.AdminIndex,"services"],queryFn:async({signal:y})=>{const{data:_}=await n.get(o.value,{signal:y});return _},placeholderData:()=>[],refetchInterval:5*1e3}),{notifySuccess:l}=R(),u=async y=>{const{data:_}=await r.post(y);l(_.message)};return(y,_)=>(i(),m("section",lt,[e("div",rt,[e("h2",nt,s(y.$gettext("Services")),1)]),h(x,{loading:d(t)},{default:p(()=>[e("table",it,[_[1]||(_[1]=e("colgroup",null,[e("col",{style:{width:"5%"}}),e("col",{style:{width:"75%"}}),e("col",{style:{width:"20%"}})],-1)),e("tbody",null,[(i(!0),m(f,null,k(d(a),b=>(i(),m("tr",{key:b.name,class:"align-middle"},[e("td",dt,[h(G,{running:b.running},null,8,["running"])]),e("td",ct,[e("h6",ut,[g(s(b.name),1),_[0]||(_[0]=e("br",null,null,-1)),e("small",null,s(b.description),1)])]),e("td",null,[b.links.restart?(i(),m("button",{key:0,type:"button",class:K(["btn btn-sm",b.running?"btn-primary":"btn-danger"]),onClick:qt=>u(b.links.restart)},s(y.$gettext("Restart")),11,mt)):S("",!0)])]))),128))])])]),_:1},8,["loading"])]))}}),gt={class:"table-responsive"},ht={class:"table table-striped"},A=w({__name:"NetworkStatsTable",props:{row:{}},setup(c){const o=c,r=M(()=>({speed:o.row.speed_readable,...te(o.row,"speed_readable","speed_bytes")})),n=M(()=>Object.keys(r.value)),a=M(()=>[r.value]);return(t,l)=>(i(),m("div",gt,[e("table",ht,[e("thead",null,[e("tr",null,[(i(!0),m(f,null,k(n.value,u=>(i(),m("th",{key:`${u}-header`},s(u),1))),128))])]),e("tbody",null,[(i(!0),m(f,null,k(a.value,(u,y)=>(i(),m("tr",{key:y},[(i(!0),m(f,null,k(n.value,_=>(i(),m("td",{key:`row-${y}-${_}`},s(d(L)(u,_,null)),1))),128))]))),128))])])]))}}),pt={class:"card"},bt={class:"card-header text-bg-primary"},yt={class:"card-title mb-0"},ft={class:"card-body"},$t={class:"row mb-3"},vt={class:"col mb-3"},wt={class:"mb-1 text-center"},kt={class:"col"},St={class:"mb-1 text-center"},xt=w({__name:"NetworkStatsPanel",props:{networkStats:{}},setup(c){return(o,r)=>(i(),m("section",pt,[e("div",bt,[e("h2",yt,s(o.$gettext("Network Interfaces")),1)]),e("div",ft,[h(X,null,{default:p(()=>[(i(!0),m(f,null,k(o.networkStats,n=>(i(),$(J,{key:n.interface_name,label:n.interface_name},{default:p(()=>[e("div",$t,[e("div",vt,[e("h5",wt,s(o.$gettext("Received")),1),h(A,{row:n.received},null,8,["row"])]),e("div",kt,[e("h5",St,s(o.$gettext("Transmitted")),1),h(A,{row:n.transmitted},null,8,["row"])])])]),_:2},1032,["label"]))),128))]),_:1})])]))}}),Ct={class:"outside-card-header mb-1"},Mt={class:"row row-of-cards"},Pt={class:"card"},Ut={class:"card-header text-bg-primary d-flex align-items-center"},Tt={class:"flex-fill"},It={class:"card-title"},At={class:"flex-shrink-0 pt-1"},Ht={class:"list-group list-group-flush"},Vt={class:"outside-card-header mb-1"},Nt={class:"row row-of-cards"},Dt={class:"col-sm-12 col-lg-6 col-xl-6"},Ot={class:"col-sm-12 col-lg-6 col-xl-6"},Wt={class:"row row-of-cards"},zt={class:"col-sm-12 col-lg-8 col-xl-6"},Ft={class:"col-sm-12 col-lg-4 col-xl-6"},Lt={class:"row row-of-cards"},Rt={class:"col"},us=w({__name:"Index",setup(c){const o=N("/admin/server/stats"),r=q(),{axiosSilent:n}=V(),{data:a,isLoading:t}=D({queryKey:[O.AdminIndex,"stats"],queryFn:async({signal:l})=>{const{data:u}=await n.get(o.value,{signal:l});return u},placeholderData:()=>({cpu:{total:{name:"Total",usage:"",idle:"",io_wait:"",steal:""},cores:[],load:[0,0,0]},memory:{total_bytes:"0",total_readable:"",free_bytes:"0",free_readable:"",buffers_bytes:"0",buffers_readable:"",cached_bytes:"0",cached_readable:"",sReclaimable_bytes:"0",sReclaimable_readable:"",shmem_bytes:"0",shmem_readable:"",used_bytes:"0",used_readable:""},swap:{total_bytes:"0",total_readable:"",free_bytes:"0",free_readable:"",used_bytes:"0",used_readable:""},disk:{total_bytes:"0",total_readable:"",free_bytes:"0",free_readable:"",used_bytes:"0",used_readable:""},network:[]}),refetchInterval:5*1e3});return(l,u)=>{const y=B("router-link");return i(),$(ee,null,{default:p(()=>[e("h2",Ct,s(l.$gettext("Administration")),1),e("div",Mt,[(i(!0),m(f,null,k(d(r).categories,_=>(i(),m("div",{key:_.key,class:"col-sm-12 col-lg-4"},[e("section",Pt,[e("div",Ut,[e("div",Tt,[e("h2",It,s(_.label),1)]),e("div",At,[_.icon?(i(),$(U,{key:0,class:"lg",icon:_.icon},null,8,["icon"])):S("",!0)])]),e("div",Ht,[(i(!0),m(f,null,k(_.items,b=>(i(),m(f,{key:b.key},[b.url?(i(),$(y,{key:0,to:b.url,class:"list-group-item list-group-item-action"},{default:p(()=>[g(s(b.label),1)]),_:2},1032,["to"])):S("",!0)],64))),128))])])]))),128))]),e("h2",Vt,s(l.$gettext("Server Status")),1),e("div",Nt,[e("div",Dt,[h(x,{loading:d(t),lazy:""},{default:p(()=>[d(a)&&d(a).memory?(i(),$(Je,{key:0,"memory-stats":d(a).memory},null,8,["memory-stats"])):S("",!0)]),_:1},8,["loading"])]),e("div",Ot,[h(x,{loading:d(t),lazy:""},{default:p(()=>[d(a)&&d(a).disk?(i(),$(ot,{key:0,"disk-stats":d(a).disk},null,8,["disk-stats"])):S("",!0)]),_:1},8,["loading"])])]),e("div",Wt,[e("div",zt,[h(x,{loading:d(t),lazy:""},{default:p(()=>[d(a)&&d(a).cpu?(i(),$(He,{key:0,"cpu-stats":d(a).cpu},null,8,["cpu-stats"])):S("",!0)]),_:1},8,["loading"])]),e("div",Ft,[h(_t)])]),e("div",Lt,[e("div",Rt,[h(x,{loading:d(t),lazy:""},{default:p(()=>[d(a)&&d(a).network?(i(),$(xt,{key:0,"network-stats":d(a).network},null,8,["network-stats"])):S("",!0)]),_:1},8,["loading"])])])]),_:1})}}});export{us as default};
