import{_ as N}from"./DataTable-BhAO7RbG.js";import{u as L}from"./useBaseEditModal-D4NDXa4y.js";import{g as R,u as V}from"./layout-CUzOT8aY.js";import{_ as H}from"./ModalForm-D0z4l5nm.js";import{m as I}from"./mergeExisting-B6FvxI3v.js";import{u as P,b as T,i as F,e as K,r as Q}from"./regle-hGsoY2W9.js";import{_ as C}from"./FormGroupField-K9S4Sadl.js";import{_ as z}from"./FormGroupMultiCheck-z3kTFzdV.js";import{m as O}from"./map-Caxea7Kw.js";import{d as S,g as B,r as Y,K as j,B as G,q as J,m as A,o as r,u as e,e as l,a as u,b as n,a6 as W,f as X,t as i,i as $,c as p,F as Z,D as ee}from"./vue-BsfewpWM.js";import{u as te,_ as se}from"./AddButton-DLx8r-7e.js";import{u as oe}from"./useConfirmAndDelete-CuQodV6V.js";import{_ as ae}from"./CardPage-Cth3uewv.js";import{g as q,a as re,Q as D}from"./useStationQuery-ClAZEJp_.js";import{u as ie}from"./useApiItemProvider-DAIhDonu.js";import{_ as le}from"./Loading-CQdAiB8R.js";import"./icons-BAjd3tML.js";import"./FormMultiCheck-RiRcopXY.js";import"./FormCheckbox-Cc7beVle.js";import"./estoolkit-DCzBkaPJ.js";import"./iteratee-DJRL6CbS.js";import"./isArrayLike-DknTMkCU.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./InvisibleSubmitButton-NGv_v7G8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-Dp0PSXNw.js";import"./useHasModal-Bq3QxExQ.js";import"./zxcvbn-Bgw4VUEj.js";import"./FormGroup-DXDHSoyc.js";import"./ValidationError-DsAp6Fjg.js";import"./InfoCard-D5Q671bF.js";import"./vue-router-Cafqdr3I.js";const ne={class:"row g-3"},me=S({__name:"EditModal",props:{createUrl:{},roles:{}},emits:["relist"],setup(E,{expose:v,emit:_}){const h=E,f=_,b=B("$modal"),s=Y(!1),{r$:o}=P({email:"",new_password:"",name:"",roles:[]},{email:{required:Q,email:K},new_password:{isValidPassword:F,required:T(()=>!s.value)}},{}),{loading:g,error:y,isEditMode:m,clearContents:U,create:w,edit:x,doSubmit:k,close:d}=L(j(h,"createUrl"),f,b,()=>{o.$reset({toOriginalState:!0})},a=>{o.$reset({toState:I(o.$value,{...a,roles:O(a.roles,"id"),new_password:""})})},async()=>{const{valid:a,data:M}=await o.$validate();return{valid:a,data:M}});G(m,a=>{s.value=a});const{$gettext:t}=R(),c=J(()=>m.value?t("Edit User"):t("Add User"));return v({create:w,edit:x,close:d}),(a,M)=>(r(),A(H,{ref_key:"$modal",ref:b,loading:e(g),title:c.value,error:e(y),"disable-save-button":e(o).$invalid,onSubmit:e(k),onHidden:e(U)},{default:l(()=>[u("div",ne,[n(C,{id:"edit_form_email",class:"col-md-6",field:e(o).email,"input-type":"email",label:e(t)("E-mail Address")},null,8,["field","label"]),n(C,{id:"edit_form_new_password",class:"col-md-6",field:e(o).new_password,"input-type":"password",label:e(t)("Password")},W({_:2},[e(m)?{name:"description",fn:l(()=>[X(i(e(t)("Leave blank to use the current password.")),1)]),key:"0"}:void 0]),1032,["field","label"]),n(C,{id:"edit_form_name",class:"col-md-12",field:e(o).name,label:e(t)("Display Name")},null,8,["field","label"]),n(z,{id:"edit_form_roles",class:"col-md-12",field:e(o).roles,options:a.roles,label:e(t)("Roles")},null,8,["field","options","label"])])]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}}),de={key:0,class:"mb-0"},ce=["href"],pe={key:1,class:"badge text-bg-primary ms-1"},ue={key:0,class:"btn-group btn-group-sm"},_e=["href"],fe=["onClick"],be=["onClick"],et=S({__name:"Users",setup(E){const v=q("/admin/vue/users"),_=q("/admin/users"),{axios:h}=V(),{data:f,isLoading:b}=re({queryKey:[D.AdminUsers,"props"],queryFn:async({signal:k})=>{const{data:d}=await h.get(v.value,{signal:k});return d}}),{$gettext:s}=R(),o=[{key:"name",isRowHeader:!0,label:s("User Name"),sortable:!0},{key:"roles",label:s("Roles"),sortable:!1},{key:"actions",label:s("Actions"),sortable:!1,class:"shrink"}],g=ie(_,[D.AdminUsers,"data"]),y=()=>{g.refresh()},m=B("$editModal"),{doCreate:U,doEdit:w}=te(m),{doDelete:x}=oe(s("Delete User?"),()=>y());return(k,d)=>(r(),A(le,{loading:e(b),lazy:""},{default:l(()=>[n(ae,{title:e(s)("Users")},{actions:l(()=>[n(se,{text:e(s)("Add User"),onClick:e(U)},null,8,["text","onClick"])]),default:l(()=>[n(N,{id:"users",paginated:"",fields:o,provider:e(g)},{"cell(name)":l(t=>[t.item.name!==""?(r(),p("h5",de,i(t.item.name),1)):$("",!0),u("a",{href:"mailto:"+t.item.email},i(t.item.email),9,ce),t.item.is_me?(r(),p("span",pe,i(e(s)("You")),1)):$("",!0)]),"cell(roles)":l(t=>[(r(!0),p(Z,null,ee(t.item.roles,c=>(r(),p("div",{key:c.id},i(c.name),1))),128))]),"cell(actions)":l(t=>[t.item.is_me?$("",!0):(r(),p("div",ue,[u("a",{class:"btn btn-secondary",href:t.item.links.masquerade,target:"_blank"},i(e(s)("Log In")),9,_e),u("button",{type:"button",class:"btn btn-primary",onClick:c=>e(w)(t.item.links.self)},i(e(s)("Edit")),9,fe),u("button",{type:"button",class:"btn btn-danger",onClick:c=>e(x)(t.item.links.self)},i(e(s)("Delete")),9,be)]))]),_:1},8,["provider"])]),_:1},8,["title"]),e(f)?(r(),A(me,{key:0,ref_key:"$editModal",ref:m,"create-url":e(_),roles:e(f).roles,onRelist:d[0]||(d[0]=()=>y())},null,8,["create-url","roles"])):$("",!0)]),_:1},8,["loading"]))}});export{et as default};
