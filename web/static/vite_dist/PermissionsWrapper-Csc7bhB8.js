import{g as L,Q as V,a as W}from"./useStationQuery-ClAZEJp_.js";import{g as z,u as J}from"./layout-CUzOT8aY.js";import{_ as O}from"./Loading-CQdAiB8R.js";import{i as U,_ as X}from"./DataTable-BhAO7RbG.js";import{_ as Y}from"./ModalForm-D0z4l5nm.js";import{u as Z}from"./useBaseEditModal-D4NDXa4y.js";import{_ as j}from"./FormGroupField-K9S4Sadl.js";import{_ as H}from"./FormGroupMultiCheck-z3kTFzdV.js";import{_ as I,a as ss}from"./Tabs-DMTPhsiO.js";import{d as T,r as es,f as ts}from"./regle-hGsoY2W9.js";import{d as S,af as A,A as F,m as w,o as m,e as b,a as l,b as v,u as e,c as _,t as f,q as E,a1 as os,i as R,D as q,F as D,f as B,g as K,K as is,z as G,L as ns,p as rs}from"./vue-BsfewpWM.js";import{_ as as,V as ls}from"./icons-BAjd3tML.js";import{i as ms,g as ds}from"./iteratee-DJRL6CbS.js";import{i as ps,k as us,g as cs}from"./getSymbolsIn-Bpzy0hqO.js";import{b as fs,u as _s}from"./estoolkit-DCzBkaPJ.js";import{i as gs}from"./isArrayLike-DknTMkCU.js";import{f as bs}from"./find-B-AZI_Kz.js";import{u as vs}from"./useResettableRef-BwkDrsai.js";import{m as $s}from"./mergeExisting-B6FvxI3v.js";import{u as hs,_ as ys}from"./AddButton-DLx8r-7e.js";import{u as ks}from"./useConfirmAndDelete-CuQodV6V.js";import{_ as Ps}from"./CardPage-Cth3uewv.js";import{u as ws}from"./useApiItemProvider-DAIhDonu.js";import"./vue-router-Cafqdr3I.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./InvisibleSubmitButton-NGv_v7G8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSlotsExcept-Dp0PSXNw.js";import"./useHasModal-Bq3QxExQ.js";import"./FormGroup-DXDHSoyc.js";import"./ValidationError-DsAp6Fjg.js";import"./zxcvbn-Bgw4VUEj.js";import"./InfoCard-D5Q671bF.js";function Rs(n,r){if(n==null)return{};const i=ms(r??ps),s={},d=gs(n)?fs(0,n.length):[...us(n),...cs(n)];for(let t=0;t<d.length;t++){const o=_s(d[t])?d[t]:d[t].toString(),a=n[o];i(a,o,n)&&(s[o]=a)}return s}const Ss={class:"row g-3"},Cs=S({__name:"GlobalForm",props:A({globalPermissions:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(n){const r=F(n,"form"),{r$:i}=T(r,{name:{required:es},permissions:{global:{$each:{}}}},{namespace:"admin-permissions"});return(s,d)=>(m(),w(I,{label:s.$gettext("Global Permissions")},{default:b(()=>[l("div",Ss,[v(j,{id:"edit_form_name",class:"col-md-12",field:e(i).name,label:s.$gettext("Role Name")},null,8,["field","label"]),v(H,{id:"edit_form_global_permissions",class:"col-md-12",field:e(i).permissions.global,options:s.globalPermissions,stacked:"",label:s.$gettext("Global Permissions"),description:s.$gettext("Users with this role will have these permissions across the entire installation.")},null,8,["field","options","label","description"])])]),_:1},8,["label"]))}}),As={class:"card mb-3",role:"region"},Ns={class:"card-header text-bg-primary d-flex align-items-center"},xs={class:"flex-fill"},Ms={class:"card-title"},Us={class:"flex-shrink-0"},Es={class:"card-body"},qs={class:"row g-3"},Ds=S({__name:"StationRow",props:A({stations:{},stationPermissions:{}},{row:{required:!0},rowModifiers:{}}),emits:A(["remove"],["update:row"]),setup(n){const r=n,i=F(n,"row"),{r$:s}=T(i,{permissions:{}},{namespace:"admin-permissions"}),d=t=>ds(r.stations,t,null);return(t,o)=>(m(),_("section",As,[l("div",Ns,[l("div",xs,[l("h2",Ms,f(d(i.value.id)),1)]),l("div",Us,[l("button",{type:"button",class:"btn btn-sm btn-light py-2",onClick:o[0]||(o[0]=a=>t.$emit("remove"))},[v(as,{icon:e(ls)},null,8,["icon"]),l("span",null,f(t.$gettext("Remove")),1)])])]),l("div",Es,[l("div",qs,[v(H,{id:"edit_form_station_permissions_"+i.value.id,class:"col-md-12",field:e(s).permissions,options:t.stationPermissions,stacked:"",label:t.$gettext("Station Permissions"),description:t.$gettext("Users with this role will have these permissions for this single station.")},null,8,["id","field","options","label","description"])])])]))}}),Bs={key:0,class:"btn-group btn-group-sm"},Fs={class:"dropdown btn-group"},Gs={class:"btn btn-sm btn-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Ls={class:"dropdown-menu"},Vs=["onClick"],zs=S({__name:"StationForm",props:A({stations:{},stationPermissions:{}},{form:{required:!0},formModifiers:{}}),emits:["update:form"],setup(n){const r=n,i=F(n,"form"),s=E(()=>{const a=i.value.permissions?.station??[];return Rs(os(r.stations),(g,$)=>!bs(a,p=>p.id===Number($)))}),d=E(()=>!U(s.value)),t=a=>{i.value.permissions.station.splice(a,1)},o=a=>{i.value.permissions.station.push({id:Number(a),permissions:[]})};return(a,g)=>(m(),w(I,{label:a.$gettext("Station Permissions")},{default:b(()=>[(m(!0),_(D,null,q(i.value.permissions?.station??[],($,p)=>(m(),w(Ds,{key:p,row:i.value.permissions.station[p],"onUpdate:row":k=>i.value.permissions.station[p]=k,stations:a.stations,"station-permissions":a.stationPermissions,onRemove:k=>t(p)},null,8,["row","onUpdate:row","stations","station-permissions","onRemove"]))),128)),d.value?(m(),_("div",Bs,[l("div",Fs,[l("button",Gs,[B(f(a.$gettext("Add Station"))+" ",1),g[0]||(g[0]=l("span",{class:"caret"},null,-1))]),l("ul",Ls,[(m(!0),_(D,null,q(s.value,($,p)=>(m(),_("li",{key:p},[l("button",{type:"button",class:"dropdown-item",onClick:k=>o(p)},f($),9,Vs)]))),128))])])])):R("",!0)]),_:1},8,["label"]))}}),Hs=S({__name:"EditModal",props:{createUrl:{},stations:{},globalPermissions:{},stationPermissions:{}},emits:["relist"],setup(n,{expose:r,emit:i}){const s=n,d=i,t=K("$modal"),{record:o,reset:a}=vs({name:"",permissions:{global:[],station:[]}}),{r$:g}=ts("admin-permissions"),{loading:$,error:p,isEditMode:k,clearContents:N,create:x,edit:h,doSubmit:u,close:c}=Z(is(s,"createUrl"),d,t,()=>{a(),g.$reset()},P=>{o.value=$s(o.value,P),g.$reset()},async()=>{const{valid:P}=await g.$validate();return{valid:P,data:o.value}}),{$gettext:y}=z(),Q=E(()=>k.value?y("Edit Role"):y("Add Role"));return r({create:x,edit:h,close:c}),(P,C)=>(m(),w(Y,{ref_key:"$modal",ref:t,loading:e($),title:Q.value,error:e(p),"disable-save-button":e(g).$invalid,onSubmit:e(u),onHidden:e(N)},{default:b(()=>[v(ss,{"content-class":"mt-3"},{default:b(()=>[v(Cs,{form:e(o),"onUpdate:form":C[0]||(C[0]=M=>G(o)?o.value=M:null),"global-permissions":P.globalPermissions},null,8,["form","global-permissions"]),v(zs,{form:e(o),"onUpdate:form":C[1]||(C[1]=M=>G(o)?o.value=M:null),stations:P.stations,"station-permissions":P.stationPermissions},null,8,["form","stations","station-permissions"])]),_:1})]),_:1},8,["loading","title","error","disable-save-button","onSubmit","onHidden"]))}}),Is={class:"card-text"},Ts={key:0},Ks={key:1},Qs={key:0,class:"btn-group btn-group-sm"},Ws=["onClick"],Js=["onClick"],Os=S({__name:"Permissions",props:{stations:{},globalPermissions:{},stationPermissions:{}},setup(n){const r=n,i=L("/admin/roles"),{$gettext:s}=z(),d=[{key:"name",isRowHeader:!0,label:s("Role Name"),sortable:!0},{key:"permissions",label:s("Permissions"),sortable:!1},{key:"actions",label:s("Actions"),sortable:!1,class:"shrink"}],t=ws(i,[V.AdminPermissions]),o=()=>{t.refresh()},a=h=>h.map(u=>r.globalPermissions[u]??null).filter(u=>!U(u)),g=h=>h.map(u=>r.stationPermissions[u]??null).filter(u=>!U(u)),$=h=>r.stations[h]??null,p=K("$editModal"),{doCreate:k,doEdit:N}=hs(p),{doDelete:x}=ks(s("Delete Role?"),()=>o());return(h,u)=>(m(),w(Ps,{title:e(s)("Roles & Permissions")},{info:b(()=>[l("p",Is,f(e(s)("AzuraCast uses a role-based access control system. Roles are given permissions to certain sections of the site, then users are assigned into those roles.")),1)]),actions:b(()=>[v(ys,{text:e(s)("Add Role"),onClick:e(k)},null,8,["text","onClick"])]),default:b(()=>[v(X,{id:"permissions",paginated:"",fields:d,provider:e(t)},{"cell(permissions)":b(({item:c})=>[c.permissions.global.length>0?(m(),_("div",Ts,[l("b",null,f(e(s)("Global"))+":",1),B(" "+f(a(c.permissions.global).join(", ")),1)])):R("",!0),(m(!0),_(D,null,q(c.permissions.station,y=>(m(),_("div",{key:y.id},[l("b",null,f($(y.id))+":",1),B(" "+f(g(y.permissions).join(", ")),1)]))),128)),c.permissions.global.length===0&&c.permissions.station.length===0?(m(),_("div",Ks," Â  ")):R("",!0)]),"cell(actions)":b(({item:c})=>[c.is_super_admin?R("",!0):(m(),_("div",Qs,[l("button",{type:"button",class:"btn btn-primary",onClick:y=>e(N)(c.links.self)},f(e(s)("Edit")),9,Ws),c.id!==1?(m(),_("button",{key:0,type:"button",class:"btn btn-danger",onClick:y=>e(x)(c.links.self)},f(e(s)("Delete")),9,Js)):R("",!0)]))]),_:1},8,["provider"]),v(Hs,{ref_key:"$editModal",ref:p,"create-url":e(i),"station-permissions":r.stationPermissions,stations:r.stations,"global-permissions":r.globalPermissions,onRelist:u[0]||(u[0]=()=>o())},null,8,["create-url","station-permissions","stations","global-permissions"])]),_:1},8,["title"]))}}),Fe=S({__name:"PermissionsWrapper",setup(n){const r=L("/admin/vue/permissions"),{axios:i}=J(),{data:s,isLoading:d}=W({queryKey:[V.AdminPermissions,"props"],queryFn:async({signal:t})=>{const{data:o}=await i.get(r.value,{signal:t});return o},placeholderData:()=>({stations:{},globalPermissions:{},stationPermissions:{}})});return(t,o)=>(m(),w(O,{loading:e(d),lazy:""},{default:b(()=>[e(s)?(m(),w(Os,ns(rs({key:0},e(s))),null,16)):R("",!0)]),_:1},8,["loading"]))}});export{Fe as default};
