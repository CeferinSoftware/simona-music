import{d as j,r as v,g as P,q as O,c as a,o as i,a as t,b,t as e,u as f,l as q,e as h,f as r,F as c,D as g,i as u}from"./vue-BsfewpWM.js";import{f as z,u as H,R as L}from"./layout-CUzOT8aY.js";import{u as V,_ as F}from"./useHasModal-Bq3QxExQ.js";import{_ as W}from"./FormGroup-DXDHSoyc.js";import{_ as Y}from"./FormFile-B5B3WV6y.js";import{e as R}from"./useStationQuery-ClAZEJp_.js";import"./leaflet-DkUWBo0d.js";import"./estoolkit-DCzBkaPJ.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./Loading-CQdAiB8R.js";import"./vue-router-Cafqdr3I.js";const G={class:"row row-of-cards"},J={class:"col-md-6"},K={class:"card",role:"region","aria-labelledby":"hdr_export_media"},Q={class:"card-header text-bg-primary"},X={id:"hdr_export_media",class:"card-title"},Z={class:"card-body"},tt={class:"card-text"},et={class:"card-text"},st={class:"block-buttons"},lt=["href"],ot={class:"col-md-6"},at={class:"card",role:"region"},it={class:"card-header text-bg-primary"},nt={class:"card-title"},rt={class:"card-body"},dt={class:"card-text"},ct={class:"block-buttons mt-3"},ut=["disabled"],pt={class:"card-text"},mt={style:{"max-height":"400px","overflow-y":"scroll"}},ht={class:"table table-striped table-responsive"},_t={class:"p-2"},ft={class:"p-2"},gt={class:"p-2",style:{"overflow-x":"auto"}},vt={class:"p-2",style:{"overflow-x":"auto"}},bt={key:0,class:"text-danger"},yt={key:0,class:"mb-2"},xt={class:"mb-0"},kt={class:"text-muted"},$t={class:"text-success"},Ct={key:1,class:"mb-2"},wt={class:"mb-0"},St={class:"text-muted"},Mt={class:"text-success"},Pt={key:2,class:"mb-2"},Vt={class:"mb-0"},Ft={key:0},Rt={class:"text-success"},Nt={key:1},Ut={class:"text-danger"},It={key:3,class:"mb-2"},Dt={class:"mb-0"},Et={class:"text-muted"},At={class:"text-success"},Tt={key:2,class:"text-muted"},Bt=["disabled"],jt={class:"card-text"},Ot={style:{"max-height":"300px","overflow-y":"scroll"}},qt={class:"table table-striped table-responsive"},zt={class:"p-2"},Ht={class:"p-2"},Lt={class:"p-2",style:{"overflow-x":"auto"}},Wt={class:"p-2",style:{"overflow-x":"auto"}},Yt={key:0,class:"text-success"},Gt={class:"text-danger"},Jt={key:0},de=j({__name:"BulkMedia",setup(Kt){const $=R("/files/bulk"),N=R("/files/bulk/preview"),p=v(null),y=v(null),d=v(null),_=v(!1),{notifySuccess:U,notifyError:m}=z(),{axios:C}=H(),w=P("$modal"),{show:I,hide:x}=V(w),S=P("$previewModal"),{show:D,hide:k}=V(S),E=O(()=>d.value?.previewResults?d.value.previewResults.filter(s=>s.has_changes||s.error):[]),A=s=>{p.value=s,_.value=!1,d.value=null},T=async()=>{if(!p.value){m("Please select a CSV file first.");return}const s=new FormData;s.append("import_file",p.value);try{const{data:o}=await C.post(N.value,s);o.success?(d.value=o,_.value=!0,D()):m(o.message||"Preview failed")}catch(o){const l=L(o);m(`Preview failed: ${l}`)}},B=()=>{k(),M()},M=async()=>{if(!_.value){m("Please preview the changes first.");return}if(!p.value){m("No file provided.");return}const s=new FormData;s.append("import_file",p.value);const{data:o}=await C.post($.value,s);p.value=null,_.value=!1,d.value=null,o.success?(y.value=o,U(o.message),I()):(m(o.message),x())};return(s,o)=>(i(),a("div",G,[t("div",J,[t("section",K,[t("div",Q,[t("h2",X,e(s.$gettext("Export Media to CSV")),1)]),t("div",Z,[t("p",tt,e(s.$gettext("Click the button below to generate a CSV file with all of this station's media. You can make any necessary changes, and then import the file using the file picker on the right.")),1),t("p",et,e(s.$gettext("Note: If your media metadata has UTF-8 characters, you should use a spreadsheet editor that supports UTF-8 encoding, like OpenOffice.")),1),t("div",st,[t("a",{class:"btn btn-block btn-primary",href:f($)},e(s.$gettext("Export Media to CSV")),9,lt)])])])]),t("div",ot,[t("section",at,[t("div",it,[t("h2",nt,e(s.$gettext("Import Changes from CSV")),1)]),t("div",rt,[t("p",dt,e(s.$gettext("The format and headers of this CSV should match the format generated by the export function on this page.")),1),t("form",{class:"form",onSubmit:q(M,["prevent"])},[b(W,{id:"import_file"},{label:h(()=>[r(e(s.$gettext("Select CSV File")),1)]),default:h(({id:l})=>[b(Y,{id:l,onUploaded:A},null,8,["id"])]),_:1}),t("div",ct,[t("button",{type:"button",class:"btn btn-block btn-outline-primary me-2",onClick:T},e(s.$gettext("Preview Changes")),1),t("button",{type:"submit",class:"btn btn-block btn-primary",disabled:!_.value},e(s.$gettext("Import Changes from CSV")),9,ut)])],32)])])]),b(F,{id:"preview_modal",ref_key:"$previewModal",ref:S,title:s.$gettext("Preview Changes"),size:"lg"},{"modal-footer":h(()=>[t("button",{class:"btn btn-secondary",type:"button",onClick:o[0]||(o[0]=(...l)=>f(k)&&f(k)(...l))},e(s.$gettext("Cancel")),1),t("button",{class:"btn btn-success",type:"button",onClick:B,disabled:!d.value||d.value.total_changes===0},e(s.$gettext("Proceed with Import")),9,Bt)]),default:h(()=>[t("p",pt,e(d.value.message),1),t("div",mt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",_t,e(s.$gettext("Media File")),1),t("th",ft,e(s.$gettext("Proposed Changes")),1)])]),t("tbody",null,[(i(!0),a(c,null,g(E.value,l=>(i(),a("tr",{key:l.id},[t("td",gt,[t("b",null,e(l.title),1),o[2]||(o[2]=t("br",null,null,-1)),r(" "+e(l.artist),1)]),t("td",vt,[l.error?(i(),a("div",bt,[o[3]||(o[3]=t("i",{class:"fas fa-exclamation-triangle"},null,-1)),r(" "+e(l.error),1)])):l.has_changes?(i(),a(c,{key:1},[l.changes.metadata?(i(),a("div",yt,[t("strong",null,e(s.$gettext("Metadata:")),1),t("ul",xt,[(i(!0),a(c,null,g(l.changes.metadata,n=>(i(),a("li",{key:n.field},[t("strong",null,e(n.field)+": ",1),t("span",kt,e(n.current||"(empty)"),1),o[4]||(o[4]=r(" → ",-1)),t("span",$t,e(n.new||"(empty)"),1)]))),128))])])):u("",!0),l.changes.extra_metadata?(i(),a("div",Ct,[t("strong",null,e(s.$gettext("Extra Metadata:")),1),t("ul",wt,[(i(!0),a(c,null,g(l.changes.extra_metadata,n=>(i(),a("li",{key:n.field},[t("strong",null,e(n.field)+": ",1),t("span",St,e(n.current||"(empty)"),1),o[5]||(o[5]=r(" → ",-1)),t("span",Mt,e(n.new||"(empty)"),1)]))),128))])])):u("",!0),l.changes.playlists?(i(),a("div",Pt,[t("strong",null,e(s.$gettext("Playlists:")),1),t("ul",Vt,[l.changes.playlists.added&&l.changes.playlists.added.length>0?(i(),a("li",Ft,[t("span",Rt,[o[6]||(o[6]=t("i",{class:"fas fa-plus"},null,-1)),r(" "+e(s.$gettext("Add to:"))+" "+e(l.changes.playlists.added.join(", ")),1)])])):u("",!0),l.changes.playlists.removed&&l.changes.playlists.removed.length>0?(i(),a("li",Nt,[t("span",Ut,[o[7]||(o[7]=t("i",{class:"fas fa-minus"},null,-1)),r(" "+e(s.$gettext("Remove from:"))+" "+e(l.changes.playlists.removed.join(", ")),1)])])):u("",!0)])])):u("",!0),l.changes.custom_fields?(i(),a("div",It,[t("strong",null,e(s.$gettext("Custom Fields:")),1),t("ul",Dt,[(i(!0),a(c,null,g(l.changes.custom_fields,n=>(i(),a("li",{key:n.field},[t("strong",null,e(n.field)+": ",1),t("span",Et,e(n.current||"(empty)"),1),o[8]||(o[8]=r(" → ",-1)),t("span",At,e(n.new||"(empty)"),1)]))),128))])])):u("",!0)],64)):(i(),a("div",Tt,e(s.$gettext("No changes")),1))])]))),128))])])])]),_:1},8,["title"]),b(F,{id:"import_modal",ref_key:"$modal",ref:w,title:s.$gettext("Import Results")},{"modal-footer":h(()=>[t("button",{class:"btn btn-secondary",type:"button",onClick:o[1]||(o[1]=(...l)=>f(x)&&f(x)(...l))},e(s.$gettext("Close")),1)]),default:h(()=>[t("p",jt,e(y.value.message),1),t("div",Ot,[t("table",qt,[t("thead",null,[t("tr",null,[t("th",zt,e(s.$gettext("Media File")),1),t("th",Ht,e(s.$gettext("Import Results")),1)])]),t("tbody",null,[(i(!0),a(c,null,g(y.value.import_results,l=>(i(),a("tr",{key:l.id},[t("td",Lt,[t("b",null,e(l.title),1),o[9]||(o[9]=t("br",null,null,-1)),r(" "+e(l.artist),1)]),t("td",Wt,[l.success?(i(),a("div",Yt,e(s.$gettext("Updated successfully.")),1)):(i(),a(c,{key:1},[t("div",Gt,e(s.$gettext("Unable to update.")),1),l.error?(i(),a("div",Jt,e(l.error),1)):u("",!0)],64))])]))),128))])])])]),_:1},8,["title"])]))}});export{de as default};
