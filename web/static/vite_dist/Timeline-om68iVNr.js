import{r as $,_,aq as q,ar as L}from"./icons-BAjd3tML.js";import{u as z,_ as B}from"./DataTable-BhAO7RbG.js";import{_ as C}from"./DateRangeDropdown-7SFZkkqA.js";import{ab as E,g as H}from"./layout-CUzOT8aY.js";import{e as J,c as O,q as F,Q as M}from"./useStationQuery-ClAZEJp_.js";import{u as N}from"./useStationDateTimeFormatter-CkmvkIuo.js";import{u as K}from"./luxon-m3VuE4xT.js";import{u as Q}from"./useApiItemProvider-DAIhDonu.js";import{d as W,r as j,q as D,g as w,B as G,n as X,c as l,o as i,a as o,b as u,t,u as r,e as f,F as c,f as m,s as Y}from"./vue-BsfewpWM.js";import"./FormMultiCheck-RiRcopXY.js";import"./map-Caxea7Kw.js";import"./estoolkit-DCzBkaPJ.js";import"./isArrayLike-DknTMkCU.js";import"./iteratee-DJRL6CbS.js";import"./FormCheckbox-Cc7beVle.js";import"./isTypedArray-By1PpNM0.js";import"./some-B0KiPFWm.js";import"./forEach-BFcv9GyE.js";import"./theme-BQjAlSn5.js";import"./leaflet-DkUWBo0d.js";import"./hlsjs-BVyhFw5s.js";import"./bootstrap.esm-30QIU_ZL.js";import"./vue-router-Cafqdr3I.js";import"./luxon-F75Z0klY.js";const Z={class:"card"},ee={class:"card-header text-bg-primary"},te={class:"d-lg-flex align-items-center"},ae={class:"card-title flex-fill my-0"},se={class:"flex-shrink buttons mt-2 mt-lg-0"},oe=["href"],le={class:"flex-shrink buttons ms-lg-2 mt-2 mt-lg-0"},ie={class:"typography-subheading"},re={key:0,class:"text-success"},ne={key:1,class:"text-danger"},Le=W({__name:"Timeline",setup(me){const h=J("/history"),v=O(),{timezone:S}=E(v),{DateTime:p}=K(),{now:x,formatDateTimeAsDateTime:U,formatTimestampAsDateTime:P}=N(),b=x(),d=j({startDate:b.minus({days:13}).toJSDate(),endDate:b.toJSDate()}),{$gettext:a}=H(),R=[{key:"played_at",label:a("Date/Time (Browser)"),selectable:!0,sortable:!1,visible:!1,formatter:s=>U(p.fromSeconds(s,{zone:"system"}),p.DATETIME_SHORT)},{key:"played_at_station",label:a("Date/Time (Station)"),sortable:!1,selectable:!0,visible:!0,formatter:(s,n,e)=>P(e.played_at,p.DATETIME_SHORT)},{key:"listeners_start",label:a("Listeners"),selectable:!0,sortable:!1},{key:"delta",label:a("Change"),selectable:!0,sortable:!1},{key:"song",isRowHeader:!0,label:a("Song Title"),selectable:!0,sortable:!1},{key:"source",label:a("Source"),selectable:!0,sortable:!1}],y=D(()=>{const s=new URL(h.value,document.location.href),n=s.searchParams,e=p.fromJSDate(d.value.startDate);e.isValid&&n.set("start",e.toISO());const k=p.fromJSDate(d.value.endDate);return k.isValid&&n.set("end",k.toISO()),s.toString()}),I=D(()=>{const s=new URL(y.value,document.location.href);return s.searchParams.set("format","csv"),s.toString()}),V=Q(y,F([M.StationReports,"timeline",d])),g=s=>Math.abs(s),T=w("$dataTable"),{navigate:A}=z(T);return G(d,()=>void X(A)),(s,n)=>(i(),l("div",Z,[o("div",ee,[o("div",te,[o("h2",ae,t(r(a)("Song Playback Timeline")),1),o("div",se,[o("a",{id:"btn-export",class:"btn btn-dark",href:I.value,target:"_blank"},[u(_,{icon:r($)},null,8,["icon"]),o("span",null,t(r(a)("Download CSV")),1)],8,oe)]),o("div",le,[u(C,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=e=>d.value=e),options:{enableTimePicker:!0,timezone:r(S)},class:"btn-dark"},null,8,["modelValue","options"])])])]),u(B,{ref_key:"$dataTable",ref:T,paginated:"","select-fields":"",fields:R,provider:r(V)},{"cell(delta)":f(e=>[o("span",ie,[e.item.delta_total>0?(i(),l("span",re,[u(_,{icon:r(q)},null,8,["icon"]),m(" "+t(g(e.item.delta_total)),1)])):e.item.delta_total<0?(i(),l("span",ne,[u(_,{icon:r(L)},null,8,["icon"]),m(" "+t(g(e.item.delta_total)),1)])):(i(),l(c,{key:2},[m(" 0 ")],64))])]),"cell(song)":f(e=>[o("div",{class:Y({"text-muted":!e.item.is_visible})},[e.item.song.title?(i(),l(c,{key:0},[o("b",null,t(e.item.song.title),1),n[1]||(n[1]=o("br",null,null,-1)),m(" "+t(e.item.song.artist),1)],64)):(i(),l(c,{key:1},[m(t(e.item.song.text),1)],64))],2)]),"cell(source)":f(e=>[e.item.is_request?(i(),l(c,{key:0},[m(t(r(a)("Listener Request")),1)],64)):e.item.playlist?(i(),l(c,{key:1},[m(t(r(a)("Playlist:"))+" "+t(e.item.playlist),1)],64)):e.item.streamer?(i(),l(c,{key:2},[m(t(r(a)("Live Streamer:"))+" "+t(e.item.streamer),1)],64)):(i(),l(c,{key:3},[m(" Â  ")],64))]),_:1},8,["provider"])]))}});export{Le as default};
