import{h as U,a1 as A,u as M,a2 as D}from"./layout-CUzOT8aY.js";import{g as b}from"./useStationQuery-ClAZEJp_.js";import{i as $,k as B,g as I}from"./getSymbolsIn-Bpzy0hqO.js";import{b as z,u as J,v as L}from"./estoolkit-DCzBkaPJ.js";import{i as O}from"./isArrayLike-DknTMkCU.js";import{i as R}from"./iteratee-DJRL6CbS.js";import{G as F,r as w,z as G,B as C,q as v,a2 as H}from"./vue-BsfewpWM.js";function K(a,d){if(a==null)return{};const m={},s=R(d??$),e=O(a)?z(0,a.length):[...B(a),...I(a)];for(let i=0;i<e.length;i++){const o=J(e[i])?e[i]:e[i].toString(),r=a[o];s(r,o,a)||(m[o]=r)}return m}function Q(a){return L(a)}const V={station:{id:1,name:"Station Name",shortcode:"station_name",description:"Station Description.",frontend:"icecast",backend:"liquidsoap",listen_url:"",url:"",playlist_pls_url:"",playlist_m3u_url:"",is_public:!0,requests_enabled:!1,mounts:[],remotes:[],timezone:"UTC",public_player_url:"",hls_enabled:!1,hls_is_default:!1,hls_url:"",hls_listeners:0},listeners:{current:0,unique:0,total:0},live:{is_live:!1,streamer_name:"",broadcast_start:null,art:null},now_playing:{elapsed:0,remaining:0,sh_id:0,played_at:0,duration:0,playlist:"default",streamer:"",is_request:!1,song:{id:"",text:"",artist:"",title:"",album:"",genre:"",lyrics:"",art:"",custom_fields:[]}},playing_next:{cued_at:0,played_at:0,duration:0,playlist:"default",is_request:!1,song:{id:"",text:"",artist:"",title:"",album:"",genre:"",lyrics:"",art:"",custom_fields:[]}},song_history:[],is_online:!1,cache:"station"};function ae(a){const d=F(V),m=w(0),s=w(Math.floor(Date.now()/1e3)),e=w(0),i=w(0),o=t=>{if(t.now_playing){if(d.value=t,m.value=Date.now(),e.value=t.now_playing.duration??0,"mediaSession"in navigator){navigator.mediaSession.metadata=new MediaMetadata(K({title:t.now_playing.song?.title??void 0,artist:t.now_playing.song?.artist??void 0,artwork:[{src:t.now_playing.song?.art??void 0}]},Q));const u=(y,_)=>{_<=y&&navigator.mediaSession.setPositionState({duration:y,position:_})};u(t.now_playing.duration??0,t.now_playing.elapsed??0),navigator.mediaSession.setActionHandler("seekto",()=>{t.now_playing&&u(t.now_playing.duration??0,t.now_playing.elapsed??0)})}document.dispatchEvent(new CustomEvent("now-playing",{detail:t}))}};let r=null;const P=t=>{r!==null&&r.stop(!1),r=H(),r.run(()=>{const{stationShortName:u,useSse:y,useStatic:_}=t;if(y){const f=b("/live/nowplaying/sse"),n=new URLSearchParams({cf_connect:JSON.stringify({subs:{[`station:${u}`]:{recover:!0}}})}),h=f.value+"?"+n.toString(),p=(S,c=!0)=>{const l=S.data;c&&l.current_time&&(s.value=l.current_time),m.value===0?o(l.np):setTimeout(()=>{o(l.np)},3e3)},{data:g}=A(h);C(g,S=>{if(!S)return;const c=JSON.parse(S);if("connect"in c){const l=c.connect;"time"in l&&(s.value=Math.floor(l.time/1e3));for(const E in l.subs){const k=l.subs[E];"publications"in k&&k.publications.length>0&&k.publications.forEach(q=>p(q,!1))}}else"pub"in c&&p(c.pub)})}else{const f=_?b(`/nowplaying_static/${u}.json`):b(`/nowplaying/${u}`),n=b("/time"),{axiosSilent:h}=M(),p={headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}};D(()=>void(async()=>{const{data:g}=await h.get(f.value,p);o(g)})(),v(()=>document.hidden?3e4:15e3),{immediateCallback:!0}),D(()=>void(async()=>{const{data:g}=await h.get(n.value,p);s.value=g.timestamp})(),v(()=>document.hidden?6e5:3e5),{immediateCallback:!0})}D(()=>{const f=d.value?.now_playing?.played_at??0;let n=s.value-f;n<0?n=0:n>=e.value&&(n=e.value),i.value=n,s.value=s.value+1},1e3,{immediateCallback:!0})})};G(a)?C(a,t=>{P(t)},{immediate:!0}):P(a);const N=v(()=>e.value?i.value>e.value?100:i.value/e.value*100:0),T=v(()=>e.value?U(e.value):null),x=v(()=>e.value?i.value<=e.value?U(i.value):T.value:null);return{np:d,currentTime:s,currentTrackDuration:e,currentTrackElapsed:i,currentTrackPercent:N,currentTrackDurationDisplay:T,currentTrackElapsedDisplay:x}}export{V as n,ae as u};
