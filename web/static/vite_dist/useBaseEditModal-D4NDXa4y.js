import{p as q,v as L,a9 as O,aa as D,F as P,I as T,K as N,J as A,f as B,u as I}from"./layout-CUzOT8aY.js";import{b as Q}from"./useStationQuery-ClAZEJp_.js";import{q as S,Q as j,x as k,B as g,Y as J,_ as V,W,a0 as Y,r as y,n as R,$ as _}from"./vue-BsfewpWM.js";var z=class extends q{#s;#i=void 0;#t;#e;constructor(t,s){super(),this.#s=t,this.setOptions(s),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#s.defaultMutationOptions(t),L(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&O(s.mutationKey)!==O(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#a(),this.#n(t)}getCurrentResult(){return this.#i}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#a(),this.#n()}mutate(t,s){return this.#e=s,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(t)}#a(){const t=this.#t?.state??D();this.#i={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){P.batch(()=>{if(this.#e&&this.hasListeners()){const s=this.#i.variables,n=this.#i.context,i={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#e.onSuccess?.(t.data,s,n,i),this.#e.onSettled?.(t.data,null,s,n,i)):t?.type==="error"&&(this.#e.onError?.(t.error,s,n,i),this.#e.onSettled?.(void 0,t.error,s,n,i))}this.listeners.forEach(s=>{s(this.#i)})})}};function F(t,s){const n=Q(),i=S(()=>n.defaultMutationOptions(T(t))),l=new z(n,i.value),u=i.value.shallow?j(l.getCurrentResult()):k(l.getCurrentResult()),r=l.subscribe(e=>{N(u,e)}),v=(e,d)=>{l.mutate(e,d).catch(()=>{})};g(i,()=>{l.setOptions(i.value)}),J(()=>{r()});const h=i.value.shallow?V(u):W(u),c=Y(h);return g(()=>u.error,e=>{if(e&&A(i.value.throwOnError,[e]))throw e}),{...c,mutate:v,mutateAsync:u.mutate,reset:u.reset}}function $(t,s,n,i,l,u,r={},v={}){const h=y(!1),c=y(null),e=y(null),d=S(()=>e.value!==null),f=()=>{i(),h.value=!1,c.value=null,e.value=null},M=()=>{f(),n.value?.show(),R(()=>{i()})},{notifySuccess:E}=B(),{axios:w}=I(),x=async()=>{if(h.value=!0,!e.value)throw new Error("No edit URL!");try{const{data:a}=await w.get(e.value);l(a)}catch{b()}finally{h.value=!1}},C=async a=>{f(),e.value=a,n.value?.show(),await R(),i(),await x()},K=a=>{if(typeof r.buildSubmitRequest=="function")return r.buildSubmitRequest(a);const o=d.value&&e.value?e.value:_(t);if(o===null)throw new Error("No valid URL to submit to!");return{method:d.value?"PUT":"POST",url:o,data:a}},b=()=>{n.value?.hide()},m=F({mutationFn:async a=>{const{data:o}=await w(K(a));return o},onSuccess:(a,o,p)=>{if(typeof r.onSubmitSuccess=="function"){r.onSubmitSuccess(a,o,p);return}E(),s("relist"),b()},onError:(a,o,p)=>{if(typeof r.onSubmitError=="function"){r.onSubmitError(a,o,p);return}c.value=a.response?.data?.message},...v}),U=async()=>{const{valid:a,data:o}=await u(d.value);!a||!o||(c.value=null,m.mutate(o))};return{loading:S(()=>h.value||m.isPending.value),error:c,editUrl:e,isEditMode:d,mutation:m,clearContents:f,create:M,edit:C,doSubmit:U,close:b}}export{$ as u};
